<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Kuantara – FedWatch 10 Dec 2025</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- ECharts -->
  <script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>
  <!-- PapaParse -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

  <!-- Fira Code (opsional) -->
  <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500;700&display=swap"/>

  <style>
    :root{
      --bg-root:#000000;
      --bg-main:#111111;
      --text-main:#f5f5f5;
      --text-muted:#9b9b9b;
      --accent:#ffbf00;
    }

    *{
      box-sizing:border-box;
      margin:0;
      padding:0;
      font-family:"Fira Code",monospace;
    }

    html, body{
      width:100%;
      height:100%;
      background:var(--bg-root);
      color:var(--text-main);
    }

    /* wrapper full screen */
    .wrapper{
      width:100%;
      height:100%;
      display:flex;
      flex-direction:column;
    }

    /* panel penuh layar */
    .shell{
      flex:1;
      width:100%;
      height:100%;
      background:var(--bg-main);
      border-radius:0;
      border:1px solid #2b2b2b;
      padding:16px 20px 22px;
      display:flex;
      flex-direction:column;
    }

    .title{
      font-size:14px;
      margin-bottom:4px;
    }
    .subtitle{
      font-size:11px;
      color:var(--text-muted);
      margin-bottom:10px;
    }

    /* chart isi hampir seluruh sisa tinggi layar */
    #fedwatch-chart{
      width:100%;
      flex:1;
      min-height:260px;
      /* kira-kira 70% tinggi viewport di desktop */
      height:70vh;
    }

    /* mobile tuning */
    @media (max-width:768px){
      .shell{
        padding:10px 10px 14px;
      }
      .title{
        font-size:13px;
      }
      .subtitle{
        font-size:10px;
      }
      #fedwatch-chart{
        height:65vh;
      }
    }
  </style>
</head>
<body>
  <div class="wrapper">
    <div class="shell">
      <div class="title">Target Rate Probabilities – 10 Dec 2025 FOMC</div>
      <div class="subtitle">Current target: 375–400 bps</div>
      <div id="fedwatch-chart"></div>
    </div>
  </div>

  <script>
    const CSV_URL =
      "https://docs.google.com/spreadsheets/d/e/2PACX-1vTb_-TORbnFMMPc7ijE1oFv8kgUsiO3SNFfgcLxMKitzpKT0lPlKTHvCxPgY1TNO61PkkCm5gevTTTw/pub?gid=0&single=true&output=csv";

    function toNumber(str) {
      if (str == null) return NaN;
      const cleaned = String(str).trim().replace(',', '.');
      const val = parseFloat(cleaned);
      return isNaN(val) ? NaN : val;
    }

    async function initChart(){
      const res  = await fetch(CSV_URL);
      const text = await res.text();
      console.log('RAW CSV:\n', text);

      const parsed = Papa.parse(text, {
        header: true,
        skipEmptyLines: true,
        dynamicTyping: false
      });

      console.log('PapaParse result:', parsed);

      const rows = parsed.data;

      const data = rows.map(r => {
        const low   = toNumber(r.target_low_bp);
        const high  = toNumber(r.target_hi_bp);
        const pRaw  = toNumber(r.probability);   // 0,8414 → 0.8414
        const probPct = pRaw <= 1 ? pRaw * 100 : pRaw;

        return {
          meetingDate: r.meeting_date,
          low,
          high,
          prob: probPct
        };
      });

      console.log('Mapped data:', data);

      const meetingDate = "2025-12-10";
      const filtered = data.filter(d => d.meetingDate === meetingDate);

      const xLabels = filtered.map(d => `${d.low}-${d.high}`);
      const probs   = filtered.map(d => d.prob);

      console.log('xLabels:', xLabels);
      console.log('probs:', probs);

      const chartDom = document.getElementById('fedwatch-chart');
      const chart = echarts.init(chartDom);

      const option = {
        backgroundColor: 'transparent',
        grid: { left: 40, right: 20, top: 30, bottom: 40 },
        xAxis: {
          type: 'category',
          data: xLabels,
          axisLine: { lineStyle:{ color:'#666' } },
          axisLabel:{ color:'#f5f5f5' }
        },
        yAxis: {
          type: 'value',
          min: 0,
          max: 100,
          axisLabel: {
            formatter: '{value}%',
            color:'#f5f5f5'
          },
          splitLine: { lineStyle:{ color:'#333' } },
          axisLine: { lineStyle:{ color:'#666' } }
        },
        tooltip: {
          trigger: 'axis',
          axisPointer:{ type:'shadow' },
          formatter: params => {
            const p = params[0];
            const val = typeof p.data === 'number' ? p.data.toFixed(2) : 'NaN';
            return `${p.axisValue} bps<br/>Probability: ${val}%`;
          }
        },
        series: [{
          type: 'bar',
          data: probs,
          barWidth: '40%',
          itemStyle:{ color:'#ffbf00' },
          label:{
            show:true,
            position:'top',
            formatter: p =>
              typeof p.data === 'number' ? p.data.toFixed(1) + '%' : '–',
            color:'#f5f5f5',
            fontSize:11
          }
        }]
      };

      chart.setOption(option);

      // responsive resize
      window.addEventListener('resize', () => {
        chart.resize();
      });
    }

    initChart().catch(console.error);
  </script>
</body>
</html>
