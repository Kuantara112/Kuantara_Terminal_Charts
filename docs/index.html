<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Kuantara Terminal</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Fira Code -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500;700&display=swap"/>

  <style>
    :root {
      --amber:#ffbf00; --bg-root:#000; --bg-main:#111; --border-soft:#2b2b2b;
      --text-main:#f5f5f5; --text-muted:#9b9b9b; --overlay:rgba(0,0,0,0.6);
    }
    *{box-sizing:border-box;margin:0;padding:0;font-family:"Fira Code",monospace!important}
    html,body{height:100%}
    body{background-color:var(--bg-root);color:var(--text-main);overflow:hidden}

    .kt-root{display:flex;flex-direction:column;height:100vh;position:relative}

    /* ===== FULLSCREEN IFRAME UNDERLAY ===== */
    .kt-iframe-layer{position:fixed;inset:0;z-index:1;background:#0b0b0b}
    .kt-iframe-layer iframe{width:100%;height:100%;border:0;display:block;background:#0b0b0b}

    /* ===== TOPMOST BAR (NO AUTOHIDE) ===== */
    .kt-topbar{
      position:fixed;top:0;left:0;right:0;display:flex;align-items:center;justify-content:center;
      background:#070707;border-bottom:2px solid var(--amber);padding:8px 12px;font-size:10px;z-index:3000 /* setara AI */
    }
    .kt-topbar-left{display:flex;align-items:center;justify-content:center;gap:8px;min-width:0;flex-wrap:wrap}
    .kt-logo{font-weight:700;letter-spacing:.06em;text-transform:uppercase;font-size:14px;color:var(--amber);white-space:nowrap}
    .kt-session-clock{display:flex;flex-wrap:wrap;gap:4px;align-items:center;font-size:9px;color:var(--text-muted)}
    .kt-session-item{display:inline-flex;gap:2px;align-items:baseline;white-space:nowrap;padding:1px 4px;border-radius:2px;background:#101010;border:1px solid #151515}
    .kt-session-label{color:var(--amber);font-size:9px}.kt-session-time{font-size:9px}

    /* ===== UI CHROME (AUTOHIDE) — dibuat mirip AI floating: z-index tinggi + selalu clickable ===== */
    .kt-main{flex:1;display:flex;flex-direction:column;background:transparent;min-height:0;position:relative;z-index:5}

    .kt-mainmenu-strip,
    .kt-content-header,
    .kt-statusbar,
    .kt-submenu-strip,
    .kt-bottom-nav{
      transition:transform 220ms ease,opacity 180ms ease;
      will-change:transform,opacity;
      pointer-events:auto;                /* selalu menerima klik */
      z-index:2800;                        /* di atas iframe & mendekati AI */
      position:fixed;
    }

    /* MAIN MENU */
    .kt-mainmenu-strip{
      top:38px;left:0;right:0;display:flex;gap:4px;padding:6px 8px;background:#050505cf;
      border-bottom:1px solid var(--border-soft);overflow-x:auto;scrollbar-width:thin;backdrop-filter:blur(4px)
    }
    .kt-hide-top{transform:translateY(-100%);opacity:.02;pointer-events:none}

    .kt-mainmenu-btn{
      flex:0 0 auto;padding:4px 8px;border-radius:3px;border:1px solid var(--border-soft);
      background:#101010;color:var(--text-muted);font-size:11px;display:inline-flex;align-items:center;gap:4px;
      cursor:pointer;white-space:nowrap;touch-action:manipulation
    }
    .kt-mainmenu-btn span:first-child{color:var(--amber);font-weight:500}
    .kt-mainmenu-btn.active{background:var(--amber);color:#000;border-color:#f0f0f0}
    .kt-mainmenu-btn.active span:first-child{color:#000}

    /* CONTENT HEADER */
    .kt-content-header{
      top:78px;left:0;right:0;border-bottom:1px solid var(--border-soft);padding:6px 10px;display:flex;
      justify-content:space-between;align-items:center;font-size:11px;gap:8px;flex-wrap:wrap;background:#0a0a0acc;backdrop-filter:blur(4px)
    }
    .kt-breadcrumb{display:flex;gap:6px;align-items:baseline;min-width:0}
    .kt-breadcrumb-main{color:var(--amber);font-weight:500;white-space:nowrap}
    .kt-breadcrumb-sub{color:var(--text-muted);overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:160px}

    /* STATUS BAR */
    .kt-statusbar{
      left:0;right:0;bottom:46px;border-top:1px solid var(--border-soft);padding:4px 10px 6px;font-size:10px;display:flex;align-items:center;
      background:#050505cc;color:var(--text-muted);backdrop-filter:blur(4px)
    }
    .kt-hide-bottom{transform:translateY(100%);opacity:.02;pointer-events:none}
    .kt-status-msg{font-size:10px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:100%}

    /* SUB MENU */
    .kt-submenu-strip{
      left:0;right:0;bottom:46px;border-top:1px solid var(--border-soft);background:#090909cc;padding:4px 6px 4px 8px;min-height:32px;backdrop-filter:blur(4px)
    }
    .kt-submenu-group{display:none;gap:4px;overflow-x:auto;padding-bottom:2px}
    .kt-submenu-group.active{display:flex}
    .kt-submenu-btn{
      flex:0 0 auto;padding:3px 8px;border-radius:3px;border:1px solid var(--border-soft);background:#101010;color:var(--text-muted);
      font-size:10px;cursor:pointer;white-space:nowrap;touch-action:manipulation
    }
    .kt-submenu-btn.active{background:var(--amber);color:#000;border-color:#f0f0f0}

    /* BOTTOM NAV */
    .kt-bottom-nav{
      left:0;right:0;bottom:0;height:46px;background:#050505e6;border-top:1px solid var(--border-soft);
      display:flex;justify-content:space-around;align-items:stretch;font-size:10px;backdrop-filter:blur(4px)
    }
    .kt-bottom-item{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;color:var(--text-muted);cursor:pointer;gap:1px;touch-action:manipulation}
    .kt-bottom-item span:first-child{font-size:9px;color:var(--amber)}
    .kt-bottom-item.active{background:#151515;color:var(--amber)}

    /* AI FAB & PANEL */
    .kt-ai-fab{
      position:fixed;right:16px;bottom:90px;width:48px;height:48px;border-radius:50%;
      background:var(--amber);color:#000;display:flex;align-items:center;justify-content:center;
      font-size:15px;font-weight:700;box-shadow:0 6px 14px rgba(0,0,0,.6);cursor:pointer;z-index:3000;border:1px solid #f0f0f0;user-select:none
    }
    .kt-ai-panel{
      position:fixed;right:16px;bottom:140px;width:min(360px,92vw);max-height:60vh;background:#111;border-radius:10px;border:1px solid var(--border-soft);
      box-shadow:0 10px 26px rgba(0,0,0,.8);display:none;flex-direction:column;overflow:hidden;z-index:3000
    }
    .kt-ai-panel-header{padding:8px 10px;border-bottom:1px solid var(--border-soft);display:flex;align-items:center;justify-content:space-between;font-size:11px}
    .kt-ai-panel-title{display:flex;flex-direction:column;gap:2px}
    .kt-ai-panel-title span:first-child{color:var(--amber);font-weight:500;font-size:11px}
    .kt-ai-panel-title span:last-child{color:var(--text-muted);font-size:10px}
    .kt-ai-panel-close{cursor:pointer;font-size:12px;color:var(--text-muted);padding:2px 6px;border-radius:3px}
    .kt-ai-panel-body{padding:8px 10px;font-size:11px;color:var(--text-muted);display:flex;flex-direction:column;gap:6px}
    .kt-ai-footer{padding:6px 10px 8px;border-top:1px solid var(--border-soft);display:flex;justify-content:flex-end;gap:6px}
    .kt-ai-btn{padding:4px 10px;border-radius:3px;font-size:11px;border:1px solid var(--border-soft);background:#181818;color:var(--text-muted);cursor:pointer}
    .kt-ai-btn.primary{background:var(--amber);color:#000;border-color:#f0f0f0}

    /* Overlays */
    .kt-overlay{position:fixed;inset:0;background:var(--overlay);display:none;align-items:center;justify-content:center;z-index:4000}
    .kt-card{background:#0e0e0e;border:1px solid var(--border-soft);border-radius:10px;padding:12px;width:min(560px,92vw);box-shadow:0 10px 26px rgba(0,0,0,.8)}
    .kt-card-title{color:var(--amber);font-size:12px;margin-bottom:8px}
    .kt-search-input{width:100%;padding:10px;border-radius:6px;border:1px solid var(--border-soft);background:#111;color:var(--text-main);outline:none}
    .kt-close-btn{margin-top:10px;padding:6px 10px;font-size:11px;border-radius:4px;border:1px solid var(--border-soft);background:#181818;color:var(--text-muted);cursor:pointer}

    .kt-cheatsheet{position:fixed;left:50%;bottom:70px;transform:translateX(-50%);background:#0e0e0e;border:1px solid var(--border-soft);border-radius:8px;padding:8px 10px;z-index:3500;display:none;font-size:10px;color:var(--text-muted)}
    .kt-cheatsheet b{color:var(--amber)}

    /* Desktop center submenu */
    @media (min-width:900px){
      .kt-submenu-strip{display:flex;justify-content:center;padding-left:0;padding-right:0}
      .kt-submenu-group{max-width:980px}
      .kt-submenu-group.active{justify-content:center}
    }
    /* Mobile compact topbar */
    @media (max-width:600px){
      .kt-topbar{padding:4px 8px}
      .kt-logo{font-size:12px}
      .kt-session-clock{gap:2px;font-size:8px}
      .kt-session-item{padding:0 3px}
      .kt-session-label,.kt-session-time{font-size:8px}
    }
  </style>
</head>
<body>
  <div class="kt-root">
    <!-- IFRAME -->
    <div class="kt-iframe-layer" id="kt-iframe-layer"></div>

    <!-- TOP BAR -->
    <header class="kt-topbar">
      <div class="kt-topbar-left">
        <div class="kt-logo">KUANTARA TERMINAL</div>
        <div class="kt-session-clock" id="kt-session-clock">
          <div class="kt-session-item"><span class="kt-session-label">SYD</span><span class="kt-session-time" data-tz="10"></span></div>
          <div class="kt-session-item"><span class="kt-session-label">TYO</span><span class="kt-session-time" data-tz="9"></span></div>
          <div class="kt-session-item"><span class="kt-session-label">LDN</span><span class="kt-session-time" data-tz="0"></span></div>
          <div class="kt-session-item"><span class="kt-session-label">NYC</span><span class="kt-session-time" data-tz="-5"></span></div>
        </div>
      </div>
    </header>

    <!-- MAIN MENU -->
    <nav class="kt-mainmenu-strip kt-hide-top" id="kt-mainmenu-strip">
      <button class="kt-mainmenu-btn active" data-menu="0"><span>0</span><span>Markets</span></button>
      <button class="kt-mainmenu-btn" data-menu="1"><span>1</span><span>News</span></button>
      <button class="kt-mainmenu-btn" data-menu="2"><span>2</span><span>Macroeconomic</span></button>
      <button class="kt-mainmenu-btn" data-menu="3"><span>3</span><span>Geo-Economic</span></button>
      <button class="kt-mainmenu-btn" data-menu="4"><span>4</span><span>Metrics</span></button>
      <button class="kt-mainmenu-btn" data-menu="5"><span>5</span><span>Companies</span></button>
      <button class="kt-mainmenu-btn" data-menu="6"><span>6</span><span>Charts</span></button>
      <button class="kt-mainmenu-btn" data-menu="7"><span>7</span><span>Screener</span></button>
      <button class="kt-mainmenu-btn" data-menu="8"><span>8</span><span>Research</span></button>
      <button class="kt-mainmenu-btn" data-menu="9"><span>9</span><span>Tools</span></button>
    </nav>

    <!-- BREADCRUMB -->
    <section class="kt-content">
      <div class="kt-content-header kt-hide-top" id="kt-content-header">
        <div class="kt-breadcrumb">
          <span class="kt-breadcrumb-main" id="breadcrumb-main">0 · Markets</span>
          <span class="kt-breadcrumb-sub" id="breadcrumb-sub">Overview</span>
        </div>
      </div>
    </section>

    <!-- STATUS -->
    <div class="kt-statusbar kt-hide-bottom" id="kt-statusbar">
      <div class="kt-status-msg" id="kt-status-msg">READY</div>
    </div>
  </div>

  <!-- SUB MENU -->
  <nav class="kt-submenu-strip kt-hide-bottom" id="kt-submenu-strip">
    <!-- 0. Markets -->
    <div class="kt-submenu-group active" data-menu-sub="0">
      <button class="kt-submenu-btn active" data-menu="0" data-sub-index="0">Overview</button>
      <button class="kt-submenu-btn" data-menu="0" data-sub-index="1">Indices</button>
      <button class="kt-submenu-btn" data-menu="0" data-sub-index="2">Forex</button>
      <button class="kt-submenu-btn" data-menu="0" data-sub-index="3">Commodities</button>
      <button class="kt-submenu-btn" data-menu="0" data-sub-index="4">Bonds</button>
      <button class="kt-submenu-btn" data-menu="0" data-sub-index="5">Stocks</button>
      <button class="kt-submenu-btn" data-menu="0" data-sub-index="6">Crypto</button>
      <button class="kt-submenu-btn" data-menu="0" data-sub-index="7">ETF</button>
    </div>

    <!-- 1. News -->
    <div class="kt-submenu-group" data-menu-sub="1">
      <button class="kt-submenu-btn" data-menu="1" data-sub-index="0">24/7 Feed</button>
      <button class="kt-submenu-btn" data-menu="1" data-sub-index="1">Global</button>
      <button class="kt-submenu-btn" data-menu="1" data-sub-index="2">Indonesia</button>
      <button class="kt-submenu-btn" data-menu="1" data-sub-index="3">Insights</button>
    </div>

    <!-- 2. Macroeconomic -->
    <div class="kt-submenu-group" data-menu-sub="2">
      <button class="kt-submenu-btn" data-menu="2" data-sub-index="0">US Macro</button>
      <button class="kt-submenu-btn" data-menu="2" data-sub-index="1">Central Bank</button>
      <button class="kt-submenu-btn" data-menu="2" data-sub-index="2">Details</button>
    </div>

    <!-- 3. Geo-Economic -->
    <div class="kt-submenu-group" data-menu-sub="3">
      <button class="kt-submenu-btn" data-menu="3" data-sub-index="0">Trade &amp; Shipping</button>
      <button class="kt-submenu-btn" data-menu="3" data-sub-index="1">Supply Chain</button>
      <button class="kt-submenu-btn" data-menu="3" data-sub-index="2">Demographics</button>
      <button class="kt-submenu-btn" data-menu="3" data-sub-index="3">Resources</button>
      <button class="kt-submenu-btn" data-menu="3" data-sub-index="4">Satellite</button>
    </div>

    <!-- 4. Metrics -->
    <div class="kt-submenu-group" data-menu-sub="4">
      <button class="kt-submenu-btn" data-menu="4" data-sub-index="0">Macro</button>
      <button class="kt-submenu-btn" data-menu="4" data-sub-index="1">Liquidity</button>
      <button class="kt-submenu-btn" data-menu="4" data-sub-index="2">Sentiment</button>
      <button class="kt-submenu-btn" data-menu="4" data-sub-index="3">Seasonality</button>
      <button class="kt-submenu-btn" data-menu="4" data-sub-index="4">COT</button>
      <button class="kt-submenu-btn" data-menu="4" data-sub-index="5">FI</button>
      <button class="kt-submenu-btn" data-menu="4" data-sub-index="6">Breadth</button>
      <button class="kt-submenu-btn" data-menu="4" data-sub-index="7">Flows</button>
      <button class="kt-submenu-btn" data-menu="4" data-sub-index="8">Volatility</button>
    </div>

    <!-- 5. Companies -->
    <div class="kt-submenu-group" data-menu-sub="5">
      <button class="kt-submenu-btn" data-menu="5" data-sub-index="0">United States</button>
      <button class="kt-submenu-btn" data-menu="5" data-sub-index="1">Indonesia</button>
      <button class="kt-submenu-btn" data-menu="5" data-sub-index="2">Blockchain Projects</button>
    </div>

    <!-- 6. Charts -->
    <div class="kt-submenu-group" data-menu-sub="6">
      <button class="kt-submenu-btn" data-menu="6" data-sub-index="0">Technical</button>
      <button class="kt-submenu-btn" data-menu="6" data-sub-index="1">Fundamental</button>
      <button class="kt-submenu-btn" data-menu="6" data-sub-index="2">Economy</button>
    </div>

    <!-- 7. Screener -->
    <div class="kt-submenu-group" data-menu-sub="7">
      <button class="kt-submenu-btn" data-menu="7" data-sub-index="0">US Stocks</button>
      <button class="kt-submenu-btn" data-menu="7" data-sub-index="1">ID Stocks</button>
      <button class="kt-submenu-btn" data-menu="7" data-sub-index="2">Crypto</button>
      <button class="kt-submenu-btn" data-menu="7" data-sub-index="3">Forex</button>
      <button class="kt-submenu-btn" data-menu="7" data-sub-index="4">Commodities</button>
    </div>

    <!-- 8. Research -->
    <div class="kt-submenu-group" data-menu-sub="8">
      <button class="kt-submenu-btn" data-menu="8" data-sub-index="0">Internal</button>
      <button class="kt-submenu-btn" data-menu="8" data-sub-index="1">Institutions</button>
      <button class="kt-submenu-btn" data-menu="8" data-sub-index="2">Articles</button>
      <button class="kt-submenu-btn" data-menu="8" data-sub-index="3">Reports</button>
    </div>

    <!-- 9. Tools -->
    <div class="kt-submenu-group" data-menu-sub="9">
      <button class="kt-submenu-btn" data-menu="9" data-sub-index="0">Journal</button>
      <button class="kt-submenu-btn" data-menu="9" data-sub-index="1">Education</button>
      <button class="kt-submenu-btn" data-menu="9" data-sub-index="2">Notes</button>
      <button class="kt-submenu-btn" data-menu="9" data-sub-index="3">Others</button>
    </div>
  </nav>

  <!-- BOTTOM NAV -->
  <nav class="kt-bottom-nav kt-hide-bottom" id="kt-bottom-nav">
    <div class="kt-bottom-item active" data-menu-bottom="0"><span>0</span><span>Markets</span></div>
    <div class="kt-bottom-item" data-menu-bottom="1"><span>1</span><span>News</span></div>
    <div class="kt-bottom-item" data-menu-bottom="2"><span>2</span><span>Macro</span></div>
    <div class="kt-bottom-item" data-menu-bottom="3"><span>3</span><span>Geo</span></div>
    <div class="kt-bottom-item" data-menu-bottom="4"><span>4</span><span>Metrics</span></div>
  </nav>

  <!-- AI FLOAT -->
  <div class="kt-ai-fab" id="kt-ai-fab">AI</div>
  <div class="kt-ai-panel" id="kt-ai-panel">
    <div class="kt-ai-panel-header">
      <div class="kt-ai-panel-title">
        <span>Kuantara AI Assistant</span>
        <span>Prototype UI (belum backend).</span>
      </div>
      <div class="kt-ai-panel-close" id="kt-ai-close">✕</div>
    </div>
    <div class="kt-ai-panel-body">
      <div>Panel AI akan jelaskan data dari iframe nanti.</div>
    </div>
    <div class="kt-ai-footer">
      <button class="kt-ai-btn" disabled>History</button>
      <button class="kt-ai-btn primary" disabled>Ask AI</button>
    </div>
  </div>

  <!-- SEARCH -->
  <div class="kt-overlay" id="kt-search-ovl" aria-hidden="true">
    <div class="kt-card">
      <div class="kt-card-title">Search</div>
      <input id="kt-search-input" class="kt-search-input" type="text" placeholder="Cari menu/sub… (Enter untuk lompat, Esc tutup)" />
      <button class="kt-close-btn" id="kt-search-close">Close</button>
    </div>
  </div>

  <!-- PROFILE -->
  <div class="kt-overlay" id="kt-profile-ovl" aria-hidden="true">
    <div class="kt-card">
      <div class="kt-card-title">Profile</div>
      <div style="font-size:11px;color:var(--text-muted);line-height:1.5;">
        User: <span style="color:var(--amber);">Guest</span><br/>
        Status: <span style="color:var(--text-main);">Signed-out</span>
      </div>
      <button class="kt-close-btn" id="kt-profile-close">Close</button>
    </div>
  </div>

  <!-- CHEATSHEET -->
  <div class="kt-cheatsheet" id="kt-cheatsheet">
    <div><b>Alt+0–9</b> Menu · <b>Ctrl+1–9</b> Sub · <b>Esc</b>=Alt+0 · <b>Ctrl+F</b> Search · <b>Tab</b> Profile</div>
  </div>

  <script>
    (function(){
      const mainButtons = document.querySelectorAll(".kt-mainmenu-btn");
      const bottomItems = document.querySelectorAll(".kt-bottom-item");
      const submenuGroups = document.querySelectorAll(".kt-submenu-group");
      const submenuButtons = document.querySelectorAll(".kt-submenu-btn");

      const breadcrumbMain = document.getElementById("breadcrumb-main");
      const breadcrumbSub  = document.getElementById("breadcrumb-sub");
      const statusMsg      = document.getElementById("kt-status-msg");
      const sessionTimes   = document.querySelectorAll(".kt-session-time");

      const aiFab  = document.getElementById("kt-ai-fab");
      const aiPanel= document.getElementById("kt-ai-panel");
      const aiClose= document.getElementById("kt-ai-close");

      const searchOvl   = document.getElementById("kt-search-ovl");
      const searchInput = document.getElementById("kt-search-input");
      const searchClose = document.getElementById("kt-search-close");
      const profileOvl  = document.getElementById("kt-profile-ovl");
      const profileClose = document.getElementById("kt-profile-close");

      const iframeLayer   = document.getElementById("kt-iframe-layer");
      const mainmenuStrip = document.getElementById("kt-mainmenu-strip");
      const contentHeader = document.getElementById("kt-content-header");
      const statusbar     = document.getElementById("kt-statusbar");
      const submenuStrip  = document.getElementById("kt-submenu-strip");
      const bottomNav     = document.getElementById("kt-bottom-nav");

      const TOP_TRIGGER_ZONE = 60;    // Area di atas untuk trigger top bars
      const BOTTOM_TRIGGER_ZONE = 120; // Area di bawah untuk trigger bottom bars
      const HIDE_DELAY = 1800;
      const CLICK_GRACE = 450;
      let hideTimer=null, graceTimer=null;

      let activeMenu=0;

      /* Map menu:sub -> iframe URL */
      const IFRAME_MAP = {
        "1:1":"https://44e53ad6-8cf6-4090-9e60-c9e985282fe0.filesusr.com/html/5e69ae_59c85b29326635aadaac1f2286d8f292.html",
      };

      function injectIframe(url){
        if(!url){ iframeLayer.innerHTML=""; return; }
        iframeLayer.innerHTML = '<iframe title="embedded" loading="lazy" src="'+url+'"></iframe>';
        updateIframeInteractivity(); // respect current bar visibility
      }

      /* ====== KUNCI: bikin iframe non-klik saat bar kelihatan (mirip AI FAB) ====== */
      function barsAreVisible(){
        const topHidden    = mainmenuStrip.classList.contains("kt-hide-top") && contentHeader.classList.contains("kt-hide-top");
        const bottomHidden = submenuStrip.classList.contains("kt-hide-bottom") && statusbar.classList.contains("kt-hide-bottom") && bottomNav.classList.contains("kt-hide-bottom");
        return !(topHidden && bottomHidden);
      }
      function updateIframeInteractivity(){
        iframeLayer.style.pointerEvents = barsAreVisible() ? "none" : "auto";
      }

      function renderContent(menuIndex, subIndex){
        const key = menuIndex+":"+subIndex;
        injectIframe(IFRAME_MAP[key]);
        statusMsg.textContent = IFRAME_MAP[key] ? "EMBED: "+IFRAME_MAP[key] : "READY";
      }

      function setActiveMenu(menuIndex){
        activeMenu = menuIndex;
        document.querySelectorAll(".kt-mainmenu-btn").forEach(btn=>{
          btn.classList.toggle("active", Number(btn.getAttribute("data-menu"))===menuIndex);
        });
        bottomItems.forEach(item=>{
          item.classList.toggle("active", Number(item.getAttribute("data-menu-bottom"))===menuIndex);
        });
        submenuGroups.forEach(group=>{
          group.classList.toggle("active", Number(group.getAttribute("data-menu-sub"))===menuIndex);
        });
        const activeMain = document.querySelector('.kt-mainmenu-btn[data-menu="'+menuIndex+'"] span:nth-child(2)');
        if(activeMain) breadcrumbMain.textContent = menuIndex+" · "+activeMain.textContent.trim();

        const firstSub = document.querySelector('.kt-submenu-btn[data-menu="'+menuIndex+'"][data-sub-index="0"]');
        if(firstSub){ setActiveSub(menuIndex,0); } else { breadcrumbSub.textContent=""; renderContent(menuIndex,-1); }

        statusMsg.textContent = "ACTIVE MENU: "+menuIndex;
      }

      function setActiveSub(menuIndex, subIndex){
        submenuButtons.forEach(btn=>{
          const m=Number(btn.getAttribute("data-menu"));
          const s=Number(btn.getAttribute("data-sub-index"));
          btn.classList.toggle("active", m===menuIndex && s===subIndex);
        });
        const sub = document.querySelector('.kt-submenu-btn[data-menu="'+menuIndex+'"][data-sub-index="'+subIndex+'"]');
        if(sub){ breadcrumbSub.textContent=sub.textContent.trim(); statusMsg.textContent="ACTIVE: "+menuIndex+" · "+breadcrumbSub.textContent; }
        else   { breadcrumbSub.textContent=""; statusMsg.textContent="ACTIVE MENU: "+menuIndex+" · (no sub)"; }

        renderContent(menuIndex, subIndex);
      }

      /* ===== EVENT LISTENERS UNTUK MENU DAN SUBMENU ===== */
      function setupEventListeners() {
        // Main menu buttons
        mainButtons.forEach(btn => {
          btn.addEventListener('click', (e) => {
            e.stopPropagation();
            const menuIndex = Number(btn.getAttribute("data-menu"));
            setActiveMenu(menuIndex);
            showAllBars();
            scheduleHide();
          });
        });

        // Bottom nav items
        bottomItems.forEach(item => {
          item.addEventListener('click', (e) => {
            e.stopPropagation();
            const menuIndex = Number(item.getAttribute("data-menu-bottom"));
            setActiveMenu(menuIndex);
            showAllBars();
            scheduleHide();
          });
        });

        // Submenu buttons
        submenuButtons.forEach(btn => {
          btn.addEventListener('click', (e) => {
            e.stopPropagation();
            const menuIndex = Number(btn.getAttribute("data-menu"));
            const subIndex = Number(btn.getAttribute("data-sub-index"));
            setActiveSub(menuIndex, subIndex);
            showAllBars();
            scheduleHide();
          });
        });
      }

      /* ===== SEARCH ke menu/sub ===== */
      function buildSearchIndex(){
        const idx=[];
        document.querySelectorAll(".kt-mainmenu-btn").forEach(btn=>{
          const menuIdx=Number(btn.getAttribute("data-menu"));
          const name=btn.querySelector("span:nth-child(2)")?.textContent?.trim()||"";
          idx.push({label:name,menu:menuIdx,sub:null,type:"menu"});
        });
        document.querySelectorAll(".kt-submenu-btn").forEach(btn=>{
          const menuIdx=Number(btn.getAttribute("data-menu"));
          const subIdx=Number(btn.getAttribute("data-sub-index"));
          const name=btn.textContent.trim();
          idx.push({label:name,menu:menuIdx,sub:subIdx,type:"sub"});
        });
        return idx;
      }
      function findBestMatch(index,qRaw){
        const q=qRaw.toLowerCase();
        return index.find(it=>it.label.toLowerCase()===q)
            || index.find(it=>it.label.toLowerCase().startsWith(q))
            || index.find(it=>it.label.toLowerCase().includes(q))
            || null;
      }

      let searchIndex=buildSearchIndex();
      function openOverlay(el){ el.style.display="flex"; updateIframeInteractivity(); }
      function closeOverlay(el){ el.style.display="none"; updateIframeInteractivity(); }

      function openSearch(){
        searchIndex=buildSearchIndex();
        openOverlay(searchOvl);
        setTimeout(()=>searchInput.focus(),10);
        statusMsg.textContent="SEARCH: active";
        showAllBars();
      }
      function closeSearch(){ closeOverlay(searchOvl); statusMsg.textContent="SEARCH: closed"; scheduleHide(); }

      searchClose.addEventListener("click", closeSearch);
      searchOvl.addEventListener("click",(e)=>{ if(e.target===searchOvl) closeSearch(); });
      searchInput.addEventListener("keydown",(e)=>{
        if(e.key==="Escape"){ e.preventDefault(); closeSearch(); return; }
        if(e.key==="Enter"){
          e.preventDefault();
          const q=(searchInput.value||"").trim();
          if(!q){ statusMsg.textContent="SEARCH: empty"; closeSearch(); return; }
          const match=findBestMatch(searchIndex,q);
          if(match){ setActiveMenu(match.menu); if(match.sub!==null) setActiveSub(match.menu,match.sub); statusMsg.textContent=`SEARCH goto: ${match.label} (${match.type})`; }
          else     { statusMsg.textContent=`SEARCH: "${q}" not found`; }
          closeSearch();
        }
      });

      /* ===== AUTOHIDE YANG TIDAK SENSITIF ===== */
      function showTopBars(){ 
        mainmenuStrip.classList.remove("kt-hide-top"); 
        contentHeader.classList.remove("kt-hide-top"); 
        clearTimeout(graceTimer); 
        graceTimer=setTimeout(()=>{},CLICK_GRACE); 
        updateIframeInteractivity(); 
      }
      
      function hideTopBars(){ 
        mainmenuStrip.classList.add("kt-hide-top"); 
        contentHeader.classList.add("kt-hide-top"); 
        updateIframeInteractivity(); 
      }
      
      function showBottomBars(){ 
        submenuStrip.classList.remove("kt-hide-bottom"); 
        statusbar.classList.remove("kt-hide-bottom"); 
        bottomNav.classList.remove("kt-hide-bottom"); 
        clearTimeout(graceTimer); 
        graceTimer=setTimeout(()=>{},CLICK_GRACE); 
        updateIframeInteractivity(); 
      }
      
      function hideBottomBars(){ 
        submenuStrip.classList.add("kt-hide-bottom"); 
        statusbar.classList.add("kt-hide-bottom"); 
        bottomNav.classList.add("kt-hide-bottom"); 
        updateIframeInteractivity(); 
      }
      
      function showAllBars(){ 
        showTopBars(); 
        showBottomBars(); 
      }
      
      function hideAllBars(){ 
        hideTopBars(); 
        hideBottomBars(); 
      }

      function scheduleHide(){ 
        clearTimeout(hideTimer); 
        hideTimer=setTimeout(()=>{ hideAllBars(); }, HIDE_DELAY); 
      }

      function handleMouseMove(e){
        const y = e.clientY;
        const h = window.innerHeight;
        
        // Hanya trigger show bars ketika cursor mendekati area bar
        const nearTop = y <= TOP_TRIGGER_ZONE;
        const nearBottom = y >= (h - BOTTOM_TRIGGER_ZONE);
        
        if (nearTop) {
          showTopBars();
          scheduleHide();
        } else if (nearBottom) {
          showBottomBars();
          scheduleHide();
        }
        // Jika cursor di tengah-tengah (jauh dari bar), biarkan hide timer berjalan
      }

      window.addEventListener("mousemove", handleMouseMove, {passive:true});

      window.addEventListener("touchstart",(e)=>{
        const y=e.touches[0]?.clientY??0, h=window.innerHeight;
        const nearTop = y <= TOP_TRIGGER_ZONE;
        const nearBottom = y >= (h - BOTTOM_TRIGGER_ZONE);
        
        if(nearTop) showTopBars();
        if(nearBottom) showBottomBars();
        scheduleHide();
      },{passive:true});

      /* ===== "mirip AI floating": cegah klik tembus ===== */
      // Saat berinteraksi di area bar, jangan sampai iframe aktif.
      [mainmenuStrip, contentHeader, submenuStrip, statusbar, bottomNav].forEach(el=>{
        el.addEventListener("mouseenter", ()=>{ 
          clearTimeout(hideTimer); 
          // Tampilkan bars yang sesuai berdasarkan elemen yang di-hover
          if (el === mainmenuStrip || el === contentHeader) {
            showTopBars();
          } else {
            showBottomBars();
          }
        });
        el.addEventListener("mouseleave", scheduleHide);
        el.addEventListener("pointerdown", ()=>{ clearTimeout(hideTimer); });
        el.addEventListener("click", (e)=>{ e.stopPropagation(); }); // klik pasti nempel ke bar
      });

      // Tombol menu/sub: stop propagation supaya tidak pernah "tembus" ke iframe
      document.querySelectorAll('.kt-mainmenu-btn, .kt-submenu-btn, .kt-bottom-item').forEach(btn=>{
        btn.addEventListener('pointerdown', (e)=>{ 
          e.stopPropagation(); 
          showAllBars(); 
          updateIframeInteractivity(); 
        });
        btn.addEventListener('click', (e)=>{ e.stopPropagation(); });
      });

      /* ===== Keyboard ===== */
      window.addEventListener("keydown",(e)=>{
        if(e.ctrlKey && (e.key==="f"||e.key==="F")){ e.preventDefault(); openSearch(); return; }
        if(e.altKey && !e.ctrlKey && !e.shiftKey){
          const k=e.key; if(k>="0"&&k<="9"){ e.preventDefault(); setActiveMenu(Number(k)); showAllBars(); scheduleHide(); return; }
        }
        if(e.ctrlKey && !e.altKey){
          const k=e.key; if(k>="1"&&k<="9"){ e.preventDefault(); setActiveSub(activeMenu, Number(k)-1); showAllBars(); scheduleHide(); return; }
        }
        if(e.key==="Escape"){ e.preventDefault(); setActiveMenu(0); showAllBars(); scheduleHide(); return; }
        if(e.key==="Tab"){ e.preventDefault(); profileOvl.style.display="flex"; showAllBars(); updateIframeInteractivity(); return; }
        if(e.key==="Shift" && !e.repeat && !e.ctrlKey && !e.altKey){
          const cheats=document.getElementById("kt-cheatsheet");
          cheats.style.display="block"; setTimeout(()=>{cheats.style.display="none";},2000);
          showAllBars(); scheduleHide(); return;
        }
      });

      /* ===== AI panel ===== */
      function toggleAiPanel(force){
        const isOpen=aiPanel.style.display==="flex";
        const next=(typeof force==="boolean")?force:!isOpen;
        aiPanel.style.display = next?"flex":"none";
      }
      aiFab.addEventListener("click", ()=>toggleAiPanel());
      aiClose.addEventListener("click", ()=>toggleAiPanel(false));

      /* ===== Profile overlay ===== */
      profileClose.addEventListener("click", ()=>{ profileOvl.style.display="none"; updateIframeInteractivity(); });
      profileOvl.addEventListener("click",(e)=>{ if(e.target===profileOvl) profileOvl.style.display="none"; updateIframeInteractivity(); });

      /* ===== Clocks ===== */
      function pad2(n){return n<10?"0"+n:""+n}
      function updateSessions(){
        const now=new Date();
        const utc=Date.UTC(now.getUTCFullYear(),now.getUTCMonth(),now.getUTCDate(),now.getUTCHours(),now.getUTCMinutes(),now.getUTCSeconds());
        sessionTimes.forEach(el=>{
          const offset=Number(el.getAttribute("data-tz"))||0;
          const d=new Date(utc+offset*3600*1000);
          el.textContent=pad2(d.getUTCHours())+":"+pad2(d.getUTCMinutes());
        });
      }
      updateSessions(); setInterval(updateSessions,1000);

      /* ===== Init ===== */
      setupEventListeners(); // Setup event listeners untuk menu dan submenu
      setActiveMenu(0);
      showAllBars();            // tampil dulu biar user lihat
      setTimeout(()=>{ hideAllBars(); }, 1000); // lalu auto-hide
      updateIframeInteractivity();
    })();
  </script>
</body>
</html>
