<!DOCTYPE html>  
<html lang="en">  
<head>  
  <meta charset="UTF-8" />  
  <title>Kuantara Terminal</title>  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />  

  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500;700&display=swap"/>  

  <style>  
    :root {  
      --amber: #ffbf00; 
      --amber-glow: rgba(255, 191, 0, 0.25);
      --bg-root: #000000; 
      --bg-glass: rgba(10, 10, 10, 0.75);
      --bg-panel: rgba(18, 18, 18, 0.95);
      
      /* Border yang lebih halus untuk efek modern */
      --border-soft: rgba(255, 255, 255, 0.08);
      --border-highlight: rgba(255, 255, 255, 0.15);
      
      --text-main: #f5f5f5; 
      --text-muted: #9b9b9b; 
      --overlay: rgba(0, 0, 0, 0.75);
      
      /* Shadow presets */
      --shadow-depth: 0 8px 30px rgba(0, 0, 0, 0.8);
      --shadow-tactile: 0 1px 2px rgba(0,0,0,0.5), inset 0 1px 0 rgba(255,255,255,0.07);
      --shadow-active: inset 0 2px 4px rgba(0,0,0,0.6);
    }  
  
    /* GLOBAL RESET */  
    *{  
      box-sizing: border-box;  
      margin: 0;  
      padding: 0;  
      font-family: "Fira Code", monospace !important;  
      scrollbar-width: thin;  
      scrollbar-color: #333 #000;  
      -webkit-tap-highlight-color: transparent;  
    }  
  
    /* RESET BUTTON & FOCUS */  
    button, .kt-mainmenu-btn, .kt-submenu-btn, .kt-bottom-item,  
    .kt-profile-menu-btn, .kt-workspace-btn, .kt-ai-menu-btn,  
    .kt-ai-panel-close, .kt-ai-btn {  
      outline: none;  
      border: none;
    }  
    
    button:focus-visible, .kt-mainmenu-btn:focus-visible {
      box-shadow: 0 0 0 1px var(--amber);
    }
  
    /* SCROLLBAR REFINEMENT */  
    ::-webkit-scrollbar { width: 6px; height: 6px; }  
    ::-webkit-scrollbar-track { background: #000; }  
    ::-webkit-scrollbar-thumb { background: #333; border-radius: 4px; }  
    ::-webkit-scrollbar-thumb:hover { background: #444; }  
  
    html,body{ height: 100%; }  
  
    body{  
      background-color: var(--bg-root);  
      color: var(--text-main);  
      overflow: hidden;  
    }  
    @media (max-width: 768px){  
      body{ overflow: auto; -webkit-overflow-scrolling: touch; }  
    }  
  
    .kt-root{ display: flex; flex-direction: column; height: 100vh; position: relative; }  
  
    /* ===== IFRAME LAYER ===== */  
    .kt-iframe-layer{  
      position: fixed; left: 0; right: 0; top: 38px; bottom: 46px;  
      z-index: 1;  
      background: #050505;  
      transition: top 0.3s cubic-bezier(0.2, 0.8, 0.2, 1), bottom 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);  
      overflow: hidden;  
    }  
    .kt-iframe-layer iframe{  
      width: 100%; height: 100%; border: 0; display: block; background: #050505;  
    }  

    /* LOADING WITH GLOW */  
    .kt-iframe-loading{  
      position: absolute; inset: 0; display: flex; flex-direction: column;  
      align-items: center; justify-content: center;  
      background: radial-gradient(circle at center, rgba(20,20,20,1) 0%, rgba(0,0,0,1) 100%);
      font-size: 11px; color: var(--text-muted); z-index: 3; pointer-events: none;  
      transition: opacity 0.3s ease;  
    }  
    .kt-iframe-loading-text{  
      margin-top: 6px; letter-spacing: .08em; text-transform: uppercase; font-size: 10px; opacity: 0.7;  
    }  
    .kt-iframe-spinner{  
      width: 26px; height: 26px; border-radius: 50%;  
      border: 2px solid rgba(255, 191, 0, 0.1);  
      border-top-color: var(--amber);  
      animation: kt-spin 0.8s cubic-bezier(0.5, 0.1, 0.5, 0.9) infinite; 
      box-shadow: 0 0 10px var(--amber-glow); 
    }  
    .kt-iframe-loading-done{ opacity: 0; }  
    @keyframes kt-spin{ to{transform: rotate(360deg);} }  
  
    /* ===== PINNED MODE ===== */  
    body.kt-pinned .kt-mainmenu-strip,  
    body.kt-pinned .kt-content-header,  
    body.kt-pinned .kt-statusbar,  
    body.kt-pinned .kt-submenu-strip {  
      transform: translateY(0) !important; opacity: 1 !important; pointer-events: auto !important;  
    }  
    body.kt-pinned .kt-iframe-layer { top: 108px; bottom: 112px; }  
    body.kt-pinned .kt-submenu-strip { bottom: 46px !important; }  
    body.kt-pinned .kt-statusbar { bottom: 80px !important; border-top: 1px solid var(--border-soft); background: #050505; }  
  
    /* ===== TOPMOST BAR ===== */  
    .kt-topbar{  
      position: fixed; top: 0; left: 0; right: 0; display: flex; align-items: center; justify-content: center;  
      background: rgba(5, 5, 5, 0.9);  
      backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--border-soft);  
      padding: 8px 12px; font-size: 10px; z-index: 3000; user-select: none;  
    }  
    .kt-topbar-left{ display: flex; align-items: center; justify-content: center; gap: 8px; min-width: 0; flex-wrap: wrap; }  
    
    .kt-logo{  
      font-weight: 700; letter-spacing: .06em; text-transform: uppercase; font-size: 14px;  
      color: var(--amber); white-space: nowrap; cursor: pointer;  
      text-shadow: 0 0 10px var(--amber-glow);
    }  
  
    .kt-session-clock{ display: flex; flex-wrap: wrap; gap: 4px; align-items: center; font-size: 9px; color: var(--text-muted); cursor: pointer; }  
    
    /* Tactile Session Tag */
    .kt-session-item{  
      display: inline-flex; gap: 2px; align-items: baseline; white-space: nowrap;  
      padding: 1px 4px; border-radius: 2px;  
      background: linear-gradient(180deg, rgba(25,25,25,0.8), rgba(10,10,10,1));
      border: 1px solid var(--border-soft);  
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.05);
      transition: all 0.2s ease;  
    }  
    .kt-session-label{ color: var(--amber); font-size: 9px; opacity: 0.8; }  
    .kt-session-time{ font-size: 9px; }  
  
    .kt-session-item.open{  
      border-color: rgba(255, 191, 0, 0.4);  
      background: linear-gradient(180deg, rgba(30,25,10,0.8), rgba(15,12,0,1));
      box-shadow: 0 0 5px var(--amber-glow), inset 0 1px 0 rgba(255,255,255,0.05);
    }  
  
    /* ===== UI CHROME (GLASS + TRANSITIONS) ===== */  
    .kt-mainmenu-strip, .kt-content-header, .kt-statusbar, .kt-submenu-strip{  
      transition: transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1), opacity 0.25s ease, bottom 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);  
      will-change: transform, opacity; pointer-events: auto; z-index: 2800; position: fixed;  
    }  
  
    /* MAIN MENU (TOP) */  
    .kt-mainmenu-strip{  
      top: 38px; left: 0; right: 0; display: flex; gap: 4px; padding: 6px 8px;  
      background: var(--bg-glass);  
      border-bottom: 1px solid var(--border-soft);  
      overflow-x: auto; scrollbar-width: thin;  
      backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px);
      justify-content: center;  
    }  
    .kt-hide-top{ transform: translateY(-100%); opacity: 0; pointer-events: none; }  
  
    /* MODERN TACTILE BUTTONS */
    .kt-mainmenu-btn{  
      flex: 0 0 auto; padding: 4px 8px; border-radius: 4px;  
      border: 1px solid var(--border-soft);  
      background: linear-gradient(180deg, rgba(30,30,30,0.5) 0%, rgba(10,10,10,0.8) 100%);
      color: var(--text-muted); font-size: 11px; display: inline-flex; align-items: center; gap: 4px;  
      cursor: pointer; white-space: nowrap; touch-action: manipulation;  
      box-shadow: var(--shadow-tactile);
      transition: all 0.15s ease;  
    }  
    .kt-mainmenu-btn span:first-child{ color: var(--amber); font-weight: 500; text-shadow: 0 0 2px rgba(0,0,0,1); }  
    
    .kt-mainmenu-btn:hover{  
      background: linear-gradient(180deg, rgba(40,40,40,0.6) 0%, rgba(20,20,20,0.9) 100%);
      border-color: var(--border-highlight);  
      color: var(--text-main);
    }  
    .kt-mainmenu-btn:active{  
      transform: translateY(1px);  
      box-shadow: var(--shadow-active);
      border-color: transparent;
    }  
    
    .kt-mainmenu-btn.active{  
      background: var(--amber); color: #000; border-color: transparent;  
      box-shadow: 0 0 12px var(--amber-glow), inset 0 1px 0 rgba(255,255,255,0.3);  
      font-weight: 600;
    }  
    .kt-mainmenu-btn.active span:first-child{ color: #000; text-shadow: none; }  
  
    /* CONTENT HEADER */  
    .kt-content-header{  
      top: 78px; left: 0; right: 0;  
      border-bottom: 1px solid var(--border-soft); padding: 6px 10px; display: flex;  
      justify-content: space-between; align-items: center; font-size: 11px; gap: 8px; flex-wrap: wrap;  
      background: rgba(10, 10, 10, 0.85); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
    }  
    .kt-breadcrumb{ display: flex; gap: 6px; align-items: baseline; min-width: 0; }  
    .kt-breadcrumb-main{ color: var(--amber); font-weight: 500; white-space: nowrap; text-shadow: 0 0 8px rgba(255,191,0,0.15); }  
    .kt-breadcrumb-sub{ color: var(--text-muted); overflow: hidden; text-overflow: ellipsis; white-space: nowrap; max-width: 160px; }  
  
    /* STATUS BAR */  
    .kt-statusbar{  
      left: 0; right: 0; bottom: 46px; border-top: 1px solid var(--border-soft); padding: 4px 10px 6px; font-size: 10px; display: flex; align-items: center;  
      background: rgba(5, 5, 5, 0.85); color: var(--text-muted); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
    }  
    .kt-hide-bottom{ transform: translateY(100%); opacity: 0; pointer-events: none; }  
    .kt-status-msg{ font-size: 10px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 100%; opacity: 0.8; }  
  
    /* SUB MENU (BOTTOM STRIP) */  
    .kt-submenu-strip{  
      left: 0; right: 0; bottom: 46px; border-top: 1px solid var(--border-soft);  
      background: rgba(10, 10, 10, 0.9); padding: 4px 6px 4px 8px; min-height: 32px;  
      backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px);
    }  
    .kt-submenu-group{ display: none; gap: 4px; overflow-x: auto; padding-bottom: 2px; }  
    .kt-submenu-group.active{ display: flex; }  
    
    .kt-submenu-btn{  
      flex: 0 0 auto; padding: 3px 8px; border-radius: 4px;  
      border: 1px solid var(--border-soft);  
      background: linear-gradient(180deg, rgba(30,30,30,0.5), rgba(10,10,10,0.8));
      color: var(--text-muted);  
      font-size: 10px; cursor: pointer; white-space: nowrap; touch-action: manipulation;  
      box-shadow: var(--shadow-tactile);
      transition: all 0.15s ease;  
    }  
    .kt-submenu-btn:hover{  
      background: linear-gradient(180deg, rgba(40,40,40,0.6), rgba(20,20,20,0.9));
      border-color: var(--border-highlight);
      color: var(--text-main);
    }  
    .kt-submenu-btn:active{  
      transform: translateY(1px);  
      box-shadow: var(--shadow-active);  
      border-color: transparent;
    }  
    .kt-submenu-btn.active{  
      background: var(--amber); color: #000; border-color: transparent;  
      box-shadow: 0 0 8px var(--amber-glow), inset 0 1px 0 rgba(255,255,255,0.3);  
      font-weight: 600;
    }  
  
    /* BOTTOM NAV */  
    .kt-bottom-nav{  
      position: fixed; left: 0; right: 0; bottom: 0; height: 46px;  
      background: rgba(5, 5, 5, 0.95);  
      border-top: 1px solid var(--border-soft);  
      display: flex; justify-content: space-around; align-items: stretch; font-size: 10px;  
      backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); 
      z-index: 2800;  
    }  
    .kt-bottom-item{  
      flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center;  
      color: var(--text-muted); cursor: pointer; gap: 2px; touch-action: manipulation; font-size: 11px;  
      transition: all 0.2s ease;  
      position: relative;
    }  
    .kt-bottom-item::before {
      content: ''; position: absolute; top: 0; left: 50%; transform: translateX(-50%);
      width: 40px; height: 1px; background: var(--amber); opacity: 0; transition: opacity 0.2s;
      box-shadow: 0 0 5px var(--amber);
    }
    .kt-bottom-item:hover{ background: rgba(255,255,255,0.03); color: var(--text-main); }  
    .kt-bottom-item:active{ transform: translateY(1px); }  
    
    .kt-bottom-item.active{  
      background: linear-gradient(180deg, rgba(255,191,0,0.05) 0%, transparent 100%);
      color: var(--amber);  
      text-shadow: 0 0 8px var(--amber-glow);
    }  
    .kt-bottom-item.active::before { opacity: 1; }
  
    /* PROFILE PAGE (MINIMAL) */  
    .kt-profile-page{  
      position: fixed; left: 0; right: 0; top: 38px; bottom: 46px; padding: 0; z-index: 2; display: none;  
      overflow: auto; background: #050505; box-sizing: border-box;  
    }  
    .kt-profile-inner{  
      width: 100%; height: 100%; max-width: none; margin: 0;  
      background: #0e0e0e; border-top: 1px solid var(--border-soft);  
      padding: 16px 18px; box-shadow: none; font-size: 11px; color: var(--text-muted); box-sizing: border-box;  
    }  
    .kt-profile-header{ display: flex; justify-content: space-between; align-items: flex-start; gap: 12px; margin-bottom: 12px; }  
    .kt-profile-title{ font-size: 12px; color: var(--amber); font-weight: 600; text-shadow: 0 0 5px var(--amber-glow); }  
    .kt-profile-name{ font-size: 13px; color: var(--text-main); font-weight: 600; margin-top: 4px; }  
    .kt-profile-meta{ font-size: 10px; color: var(--text-muted); margin-top: 4px; }  
      
    .kt-badge{  
      display: inline-flex; align-items: center; padding: 3px 8px; border-radius: 999px;  
      border: 1px solid var(--amber); background: rgba(255,191,0,0.1);  
      font-size: 10px; color: var(--amber); gap: 4px; box-shadow: 0 0 5px var(--amber-glow);
    }  
    .kt-profile-grid{ display: grid; grid-template-columns: repeat(auto-fit,minmax(180px,1fr)); gap: 10px; margin-top: 8px; }  
      
    .kt-profile-card{  
      border-radius: 8px; border: 1px solid var(--border-soft);  
      background: linear-gradient(145deg, rgba(20,20,20,1), rgba(10,10,10,1));
      padding: 8px 10px;  
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.03), 0 2px 5px rgba(0,0,0,0.3);
    }  
    .kt-profile-card-title{ font-size: 10px; color: var(--amber); margin-bottom: 4px; opacity: 0.9; }  
    .kt-profile-card-body{ font-size: 10px; line-height: 1.5; color: #ccc; }  
  
    .kt-profile-menu{ margin-top: 14px; display: none; }  
    .kt-profile-menu-btn{  
      padding: 6px 12px; border-radius: 999px; border: 1px solid var(--border-soft);  
      background: linear-gradient(180deg, rgba(30,30,30,0.5), rgba(15,15,15,0.8));
      color: var(--text-main); font-size: 10px; cursor: pointer;  
      box-shadow: var(--shadow-tactile);
      transition: all 0.15s ease;  
    }  
    .kt-profile-menu-btn:hover{ background: rgba(50,50,50,0.5); border-color: var(--border-highlight); }  
    .kt-profile-menu-btn:active{ transform: translateY(1px); box-shadow: var(--shadow-active); border-color: transparent;}  
      
    .kt-profile-footer{ margin-top: 14px; padding-top: 8px; border-top: 1px solid var(--border-soft); font-size: 9px; color: var(--text-muted); line-height: 1.4; opacity: 0.7; }  
  
    /* WORKSPACE */  
    .kt-workspace-page{  
      position: fixed; left: 0; right: 0; top: 38px; bottom: 46px; z-index: 2;  
      display: none; background: #050505; overflow: hidden; box-sizing: border-box;  
    }  
    .kt-workspace-toolbar{ position: absolute; top: 10px; left: 10px; display: flex; flex-wrap: wrap; gap: 6px; z-index: 3; }  
      
    .kt-workspace-btn{  
      padding: 5px 10px; border-radius: 999px; border: 1px solid var(--border-soft);  
      background: linear-gradient(180deg, rgba(30,30,30,0.8), rgba(10,10,10,0.9));
      color: var(--text-main); font-size: 10px; cursor: pointer;  
      box-shadow: var(--shadow-tactile);
      transition: all 0.15s ease;  
    }  
    .kt-workspace-btn.secondary{ background: linear-gradient(180deg, rgba(20,20,20,0.8), rgba(5,5,5,0.9)); color: var(--text-muted); }  
    .kt-workspace-btn:hover{ border-color: var(--border-highlight); color: #fff; }  
    .kt-workspace-btn:active{ transform: translateY(1px); box-shadow: var(--shadow-active); }  
      
    .kt-workspace-board{  
      position: absolute; inset: 0; border-radius: 0; border: none; background: #000;  
      overflow: auto; box-sizing: border-box; padding-top: 36px;  
      background-image: radial-gradient(rgba(40, 40, 40, 0.3) 1px, transparent 1px);
      background-size: 20px 20px;
    }  
    .kt-workspace-placeholder{ font-size: 10px; color: var(--text-muted); line-height: 1.5; padding: 12px 14px; text-align: center; opacity: 0.6; }  
  
    .kt-workspace-window{  
      position: absolute; min-width: 220px; min-height: 140px; width: 360px; height: 220px;  
      background: #0d0d0d; border: 1px solid var(--border-soft); border-radius: 8px;  
      box-shadow: var(--shadow-depth), 0 0 0 1px rgba(255,255,255,0.05) inset; 
      overflow: hidden; max-width: 100%; touch-action: none;  
      transition: box-shadow 0.15s ease, border-color 0.15s ease;  
    }  
    .kt-workspace-window:hover{ border-color: var(--border-highlight); }
      
    .kt-workspace-window-header{  
      height: 28px; display: flex; align-items: center; justify-content: space-between; padding: 0 8px;  
      font-size: 10px; background: linear-gradient(to right, rgba(20,20,20,0.95), rgba(10,10,10,0.95)); 
      border-bottom: 1px solid var(--border-soft);
      color: var(--text-main); cursor: move; touch-action: none; user-select: none; -webkit-user-select: none;  
    }  
    .kt-workspace-window-title{ white-space: nowrap; overflow: hidden; text-overflow: ellipsis; opacity: 0.9; }  
    .kt-workspace-window-close{  
      border: none; background: transparent; color: var(--text-muted); font-size: 11px; cursor: pointer; padding: 0 2px;  
      transition: color 0.15s ease, transform 0.1s ease;  
    }  
    .kt-workspace-window-close:hover{ color: var(--amber); text-shadow: 0 0 5px var(--amber-glow); }  
    .kt-workspace-window-close:active{ transform: scale(0.9); }  
      
    .kt-workspace-window-body{ position: absolute; top: 28px; left: 0; right: 0; bottom: 0; background: #000; }  
    .kt-workspace-window-body iframe{ width: 100%; height: 100%; border: 0; display: block; }  
    .kt-workspace-resizer{  
      position: absolute; right: 0; bottom: 0; width: 18px; height: 18px; cursor: nwse-resize;  
      background: linear-gradient(135deg, transparent 0, transparent 40%, var(--border-soft) 40%, var(--border-soft) 60%, transparent 60%, transparent 100%);  
      opacity: 0.7; touch-action: none;  
    }  
  
    /* FLOATING UI (FAB, MENU, PANEL) */  
    .kt-ai-fab{  
      position: fixed; right: 16px; bottom: 90px; width: 48px; height: 48px; border-radius: 50%;  
      background: linear-gradient(135deg, #ffbf00, #d9a300);
      color: #000; display: flex; align-items: center; justify-content: center;  
      font-size: 15px; font-weight: 700; cursor: pointer; z-index: 3000;  
      border: 1px solid rgba(255,255,255,0.4); user-select: none;  
      box-shadow: 0 8px 16px rgba(0,0,0,0.6), inset 0 2px 4px rgba(255,255,255,0.4);
      transition: transform 0.2s cubic-bezier(0.3,1.5,0.5,1), box-shadow 0.2s ease;  
    }  
    .kt-ai-fab:hover{ box-shadow: 0 10px 24px rgba(255,191,0,0.4), inset 0 2px 4px rgba(255,255,255,0.5); transform: translateY(-2px); }  
    .kt-ai-fab:active{ transform: translateY(1px) scale(0.95); box-shadow: 0 4px 10px rgba(0,0,0,0.5); }  
  
    .kt-ai-menu{ position: fixed; right: 16px; bottom: 150px; display: none; flex-direction: column; gap: 6px; z-index: 3000; }  
      
    .kt-ai-menu-btn{  
      padding: 6px 10px; border-radius: 999px; border: 1px solid var(--border-soft);  
      background: rgba(18, 18, 18, 0.9); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
      color: #9b9b9b; font-size: 11px; display: flex; align-items: center; gap: 6px; cursor: pointer;  
      box-shadow: var(--shadow-depth), 0 0 0 1px rgba(255,255,255,0.05) inset;
      transition: all 0.2s ease;  
    }  
    .kt-ai-menu-btn span:first-child{ width: 22px; text-align: center; color: var(--amber); font-weight: 500; font-size: 11px; }  
    .kt-ai-menu-btn:hover{ background: rgba(30, 30, 30, 0.95); color: var(--text-main); transform: translateX(-4px); border-color: var(--border-highlight); }  
    .kt-ai-menu-btn:active{ transform: translateX(0); }  
  
    .kt-ai-panel{  
      position: fixed; right: 16px; bottom: 140px; width: min(400px, 92vw); height: min(440px, 78vh); max-height: 78vh;  
      background: rgba(18, 18, 18, 0.96); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
      border-radius: 12px; border: 1px solid var(--border-soft);  
      box-shadow: var(--shadow-depth), inset 0 1px 0 rgba(255,255,255,0.08);  
      display: none; flex-direction: column; overflow: hidden; z-index: 3000;  
    }  
  
    .kt-ai-panel-header{ position: relative; padding: 0; border: none; height: 0; overflow: visible; flex: 0 0 auto; }  
    .kt-ai-panel-title{ display: none; }  
    .kt-ai-panel-close{  
      position: absolute; top: 8px; right: 8px; cursor: pointer; font-size: 12px; color: var(--text-main);  
      padding: 2px 7px; border-radius: 999px; background: rgba(0,0,0,0.5); border: 1px solid var(--border-soft);  
      transition: all 0.2s ease; z-index: 5;  
    }  
    .kt-ai-panel-close:hover{ background: rgba(255,191,0,0.2); border-color: var(--amber); color: var(--amber); }  
    .kt-ai-panel-close:active{ transform: scale(0.9); }  
  
    .kt-ai-panel-body{ padding: 0; font-size: 11px; color: var(--text-muted); display: flex; flex-direction: column; gap: 0; flex: 1; min-height: 0; overflow: hidden; }  
  
    .kt-ai-footer{ padding: 0; border-top: none; display: none; justify-content: flex-end; gap: 6px; flex: 0 0 auto; }  
      
    .kt-ai-btn{  
      padding: 4px 10px; border-radius: 3px; font-size: 11px; border: 1px solid var(--border-soft);  
      background: linear-gradient(180deg, #222, #111); color: var(--text-muted); cursor: pointer;  
      box-shadow: var(--shadow-tactile); transition: all 0.15s ease;  
    }  
    .kt-ai-btn.primary{ background: var(--amber); color: #000; border-color: transparent; box-shadow: 0 2px 6px rgba(255,191,0,0.3); }  
  
    /* SEARCH OVERLAY */  
    .kt-overlay{  
      position: fixed; inset: 0; background: rgba(0,0,0,0.85); backdrop-filter: blur(4px); -webkit-backdrop-filter: blur(4px);
      display: none; align-items: center; justify-content: center; z-index: 4000;  
    }  
    .kt-card{  
      background: rgba(18, 18, 18, 0.95); border: 1px solid var(--border-soft); border-radius: 12px;  
      padding: 12px; width: min(560px, 92vw);  
      box-shadow: var(--shadow-depth), inset 0 1px 0 rgba(255,255,255,0.05);  
    }  
    .kt-card-title{ color: var(--amber); font-size: 12px; margin-bottom: 8px; text-shadow: 0 0 8px rgba(255,191,0,0.2); }  
      
    .kt-search-input{  
      width: 100%; padding: 10px; border-radius: 6px;  
      border: 1px solid var(--border-soft); background: rgba(0,0,0,0.6);  
      color: var(--text-main); outline: none;  
      box-shadow: inset 0 2px 5px rgba(0,0,0,0.5);  
      transition: border-color 0.2s ease, box-shadow 0.2s ease;  
    }  
    .kt-search-input:focus{ border-color: var(--amber); box-shadow: inset 0 2px 5px rgba(0,0,0,0.5), 0 0 5px rgba(255,191,0,0.2); }  

    /* SEARCH QUICK CHIPS */
    .kt-search-chips{
      margin-top: 6px;
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
    }
    .kt-search-chip{
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid var(--border-soft);
      background: linear-gradient(180deg, rgba(35,35,35,0.9), rgba(10,10,10,0.95));
      font-size: 10px;
      color: var(--text-muted);
      cursor: pointer;
      box-shadow: var(--shadow-tactile);
      white-space: nowrap;
      transition: all 0.15s ease;
    }
    .kt-search-chip:hover{
      border-color: var(--border-highlight);
      color: var(--text-main);
      background: linear-gradient(180deg, rgba(45,45,45,0.95), rgba(15,15,15,1));
    }
    .kt-search-chip:active{
      transform: translateY(1px);
      box-shadow: var(--shadow-active);
      border-color: transparent;
    }
      
    .kt-close-btn{  
      margin-top: 10px; padding: 6px 10px; font-size: 11px; border-radius: 4px;  
      border: 1px solid var(--border-soft); background: linear-gradient(180deg, #222, #111);  
      color: var(--text-muted); cursor: pointer;  
      box-shadow: var(--shadow-tactile);  
      transition: all 0.15s ease;  
    }  
    .kt-close-btn:hover{ color: var(--text-main); border-color: var(--border-highlight); }  
    .kt-close-btn:active{ transform: translateY(1px); box-shadow: var(--shadow-active); }  
  
    /* SEARCH SUGGESTIONS */  
    .kt-search-suggestions{  
      margin-top: 8px; max-height: 220px; overflow: auto; border-radius: 6px;  
      border: 1px solid var(--border-soft); background: rgba(5,5,5,0.5); padding: 4px 0; font-size: 11px;  
    }  
    .kt-search-suggestions.hidden{ display: none; }  
      
    .kt-search-suggestion-item{ padding: 4px 8px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; gap: 6px; transition: background 0.1s ease; }  
    .kt-search-suggestion-item:hover{ background: rgba(255,255,255,0.06); }  
    .kt-search-suggestion-main{ color: var(--text-main); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 240px; }  
    .kt-search-suggestion-meta{ color: var(--text-muted); font-size: 9px; flex-shrink: 0; opacity: 0.7; }  
  
    .kt-cheatsheet{  
      position: fixed; left: 50%; bottom: 70px; transform: translateX(-50%);  
      background: rgba(14,14,14,0.9); border: 1px solid var(--border-soft);  
      border-radius: 8px; padding: 8px 10px; z-index: 3500; display: none;  
      font-size: 10px; color: var(--text-muted); backdrop-filter: blur(8px);  
      box-shadow: 0 4px 12px rgba(0,0,0,0.6);  
    }  
    .kt-cheatsheet b{ color: var(--amber); }  
  
    @media (min-width: 900px){  
      .kt-submenu-strip{ display: flex; justify-content: center; padding-left: 0; padding-right: 0; }  
      .kt-submenu-group{ max-width: 980px; }  
      .kt-submenu-group.active{ justify-content: center; }  
    }  
  
    @media (max-width: 600px){  
      .kt-topbar{ padding: 4px 8px; }  
      .kt-logo{ font-size: 12px; }  
      .kt-session-clock{ gap: 2px; font-size: 8px; }  
      .kt-session-item{ padding: 0 3px; }  
      .kt-session-label, .kt-session-time{ font-size: 8px; }  
      .kt-mainmenu-strip{ justify-content: flex-start; top: 32px; }  
      .kt-profile-inner{ padding: 12px 12px; }  
      .kt-workspace-window{ width: 88vw; height: 45vh; }  
    }  

    /* Desktop: smaller bottom bar & adjusted offsets */
    @media (min-width: 900px){
      .kt-bottom-nav{ height: 36px; }
      .kt-iframe-layer{ bottom: 36px; }
      .kt-statusbar{ bottom: 36px; }
      .kt-submenu-strip{ bottom: 36px; }
      body.kt-pinned .kt-iframe-layer{ bottom: 102px; }
      body.kt-pinned .kt-statusbar{ bottom: 68px !important; }
      body.kt-pinned .kt-submenu-strip{ bottom: 36px !important; }
    }
  </style>  
</head>  
<body>  
  <div class="kt-root">  
    <div class="kt-iframe-layer" id="kt-iframe-layer"></div>  

    <header class="kt-topbar" id="kt-topbar" title="Double click to Pin/Unpin interface">  
      <div class="kt-topbar-left">  
        <div class="kt-logo">KUANTARA TERMINAL</div>  
        <div class="kt-session-clock" id="kt-session-clock">  
          <div class="kt-session-item" data-market="SYD">  
            <span class="kt-session-label">SYD</span>  
            <span class="kt-session-time" data-tzid="Australia/Sydney"></span>  
          </div>  
          <div class="kt-session-item" data-market="TYO">  
            <span class="kt-session-label">TYO</span>  
            <span class="kt-session-time" data-tzid="Asia/Tokyo"></span>  
          </div>  
          <div class="kt-session-item" data-market="LDN">  
            <span class="kt-session-label">LDN</span>  
            <span class="kt-session-time" data-tzid="Europe/London"></span>  
          </div>  
          <div class="kt-session-item" data-market="NYC">  
            <span class="kt-session-label">NYC</span>  
            <span class="kt-session-time" data-tzid="America/New_York"></span>  
          </div>  
        </div>  
      </div>  
    </header>  

    <nav class="kt-mainmenu-strip kt-hide-top" id="kt-mainmenu-strip">  
      <button class="kt-mainmenu-btn active" data-menu="0"><span>0</span><span>Markets</span></button>  
      <button class="kt-mainmenu-btn" data-menu="1"><span>1</span><span>News</span></button>  
      <button class="kt-mainmenu-btn" data-menu="2"><span>2</span><span>Macroeconomic</span></button>  
      <button class="kt-mainmenu-btn" data-menu="3"><span>3</span><span>Geo-Economic</span></button>  
      <button class="kt-mainmenu-btn" data-menu="4"><span>4</span><span>Metrics</span></button>  
      <button class="kt-mainmenu-btn" data-menu="5"><span>5</span><span>Companies</span></button>  
      <button class="kt-mainmenu-btn" data-menu="6"><span>6</span><span>Charts</span></button>  
      <button class="kt-mainmenu-btn" data-menu="7"><span>7</span><span>Screener</span></button>  
      <button class="kt-mainmenu-btn" data-menu="8"><span>8</span><span>Research</span></button>  
      <button class="kt-mainmenu-btn" data-menu="9"><span>9</span><span>Tools</span></button>  
    </nav>  

    <section class="kt-content">  
      <div class="kt-content-header kt-hide-top" id="kt-content-header">  
        <div class="kt-breadcrumb">  
          <span class="kt-breadcrumb-main" id="breadcrumb-main">0 · Markets</span>  
          <span class="kt-breadcrumb-sub" id="breadcrumb-sub">Overview</span>  
        </div>  
      </div>  
    </section>  

    <div class="kt-statusbar kt-hide-bottom" id="kt-statusbar">  
      <div class="kt-status-msg" id="kt-status-msg">READY</div>  
    </div>  
  </div>  

  <nav class="kt-submenu-strip kt-hide-bottom" id="kt-submenu-strip">  
    <div class="kt-submenu-group active" data-menu-sub="0">  
      <button class="kt-submenu-btn active" data-menu="0" data-sub-index="0">Overview</button>  
      <button class="kt-submenu-btn" data-menu="0" data-sub-index="1">Forex</button>  
      <button class="kt-submenu-btn" data-menu="0" data-sub-index="2">Fixed</button>  
      <button class="kt-submenu-btn" data-menu="0" data-sub-index="3">Commodities</button>  
      <button class="kt-submenu-btn" data-menu="0" data-sub-index="4">Equities</button>  
      <button class="kt-submenu-btn" data-menu="0" data-sub-index="5">Crypto</button>  
    </div>  

    <div class="kt-submenu-group" data-menu-sub="1">  
      <button class="kt-submenu-btn" data-menu="1" data-sub-index="0">24/7</button>  
      <button class="kt-submenu-btn" data-menu="1" data-sub-index="1">Insights</button>  
      <button class="kt-submenu-btn" data-menu="1" data-sub-index="2">Calendar</button>  
      <button class="kt-submenu-btn" data-menu="1" data-sub-index="3">Global</button>  
      <button class="kt-submenu-btn" data-menu="1" data-sub-index="4">Channel</button>  
      <button class="kt-submenu-btn" data-menu="1" data-sub-index="5">Indonesia</button>  
    </div>  

    <!-- Macroeconomic: US Macro removed, order: Central Bank - Major - All Countries -->
    <div class="kt-submenu-group" data-menu-sub="2">  
      <button class="kt-submenu-btn" data-menu="2" data-sub-index="0">Central Bank</button>  
      <button class="kt-submenu-btn" data-menu="2" data-sub-index="1">Major</button>  
      <button class="kt-submenu-btn" data-menu="2" data-sub-index="2">All Countries</button>  
    </div>  

    <div class="kt-submenu-group" data-menu-sub="3">  
      <button class="kt-submenu-btn" data-menu="3" data-sub-index="0">Geo Risk</button>  
      <button class="kt-submenu-btn" data-menu="3" data-sub-index="1">Trade &amp; Shipping</button>  
      <button class="kt-submenu-btn" data-menu="3" data-sub-index="2">Resources</button>  
    </div>  

    <!-- Metrics Labs submenu -->
    <div class="kt-submenu-group" data-menu-sub="4">  
      <button class="kt-submenu-btn" data-menu="4" data-sub-index="0">Macro Lab</button>  
      <button class="kt-submenu-btn" data-menu="4" data-sub-index="1">Market Lab</button>  
      <button class="kt-submenu-btn" data-menu="4" data-sub-index="2">Sentiment Lab</button>  
    </div>  

    <!-- Companies menu updated: NASDAQ100, DJI30, JKSE, FOREIGN -->
    <div class="kt-submenu-group" data-menu-sub="5">  
      <button class="kt-submenu-btn" data-menu="5" data-sub-index="0">S&amp;P500</button>  
      <button class="kt-submenu-btn" data-menu="5" data-sub-index="1">NASDAQ100</button>  
      <button class="kt-submenu-btn" data-menu="5" data-sub-index="2">DJI30</button>  
      <button class="kt-submenu-btn" data-menu="5" data-sub-index="3">JKSE</button>  
      <button class="kt-submenu-btn" data-menu="5" data-sub-index="4">FOREIGN</button>  
      <button class="kt-submenu-btn" data-menu="5" data-sub-index="5">Blockchain Projects</button>  
    </div>  

    <!-- Charts: Fundamental removed, indexes realigned -->
    <div class="kt-submenu-group" data-menu-sub="6">  
      <button class="kt-submenu-btn" data-menu="6" data-sub-index="0">Technical</button>  
      <button class="kt-submenu-btn" data-menu="6" data-sub-index="1">Economy</button>  
      <button class="kt-submenu-btn" data-menu="6" data-sub-index="2">Real-Time</button>  
    </div>  

    <!-- Screener: Stocks -> IDX Stocks, Custom -> Flows -->
    <div class="kt-submenu-group" data-menu-sub="7">  
      <button class="kt-submenu-btn" data-menu="7" data-sub-index="0">IDX Stocks</button>  
      <button class="kt-submenu-btn" data-menu="7" data-sub-index="1">Crypto</button>  
      <button class="kt-submenu-btn" data-menu="7" data-sub-index="2">Flows</button>  
    </div>  

    <!-- Research: swap Reports & Quantitative -->
    <div class="kt-submenu-group" data-menu-sub="8">  
      <button class="kt-submenu-btn" data-menu="8" data-sub-index="0">Institutions</button>  
      <button class="kt-submenu-btn" data-menu="8" data-sub-index="1">Quantitative</button>  
      <button class="kt-submenu-btn" data-menu="8" data-sub-index="2">Reports</button>  
    </div>  

    <!-- Tools: swap Education & Calculator -->
    <div class="kt-submenu-group" data-menu-sub="9">  
      <button class="kt-submenu-btn" data-menu="9" data-sub-index="0">Trading Journal</button>  
      <button class="kt-submenu-btn" data-menu="9" data-sub-index="1">Calculator</button>  
      <button class="kt-submenu-btn" data-menu="9" data-sub-index="2">Education</button>  
      <button class="kt-submenu-btn" data-menu="9" data-sub-index="3">Others</button>  
    </div>  
  </nav>  

  <div class="kt-profile-page" id="kt-profile-page">  
    <div class="kt-profile-inner">  
      <div class="kt-profile-header">  
        <div>  
          <div class="kt-profile-title">Profile</div>  
          <div class="kt-profile-name">Guest User</div>  
          <div class="kt-profile-meta">  
            Kuantara Terminal · Standard Plan<br/>  
            Single-seat license  
          </div>  
        </div>  
      </div>  

      <div class="kt-profile-grid">  
        <div class="kt-profile-card">  
          <div class="kt-profile-card-title">Account</div>  
          <div class="kt-profile-card-body">  
            Name  : Guest User<br/>  
            Role  : Trader / Analyst<br/>  
            Status: Trial  
          </div>  
        </div>  
      </div>  

      <div class="kt-profile-footer">  
        Developed by Kuantara Analytics · Informasi di dalam terminal ini bersifat edukatif dan bukan merupakan saran investasi atau ajakan untuk melakukan transaksi finansial.  
      </div>  
    </div>  
  </div>  

  <div class="kt-workspace-page" id="kt-workspace-page">  
    <div class="kt-workspace-toolbar">  
      <button class="kt-workspace-btn" id="kt-workspace-add-current">Add current view</button>  
      <button class="kt-workspace-btn secondary" id="kt-workspace-clear">Clear workspace</button>  
    </div>  
    <div class="kt-workspace-board" id="kt-workspace-board">  
      <div class="kt-workspace-placeholder">  
        Belum ada window di Workspace.<br>  
        Pergi ke Home, pilih view yang kamu suka, lalu klik <b>Add current view</b>.  
      </div>  
    </div>  
  </div>  

  <nav class="kt-bottom-nav" id="kt-bottom-nav">  
    <div class="kt-bottom-item active" data-bottom-role="home">  
      <span>Home</span>  
    </div>  
    <div class="kt-bottom-item" data-bottom-role="search">  
      <span>Search</span>  
    </div>  
    <div class="kt-bottom-item" data-bottom-role="workspace">  
      <span>Workspace</span>  
    </div>  
  </nav>  

  <div class="kt-ai-fab" id="kt-ai-fab">≡</div>  

  <div class="kt-ai-menu" id="kt-ai-menu">  
    <button class="kt-ai-menu-btn" data-pane="ai"><span>AI</span><span>Kuantara AI</span></button>  
    <button class="kt-ai-menu-btn" data-pane="mini"><span>MC</span><span>Mini Chart</span></button>  
    <button class="kt-ai-menu-btn" data-pane="notes"><span>NT</span><span>Notes</span></button>  
    <button class="kt-ai-menu-btn" data-pane="signals"><span>AL</span><span>Alerts</span></button>  
    <button class="kt-ai-menu-btn" data-pane="group"><span>GC</span><span>Group Chat</span></button>  
    <button class="kt-ai-menu-btn" data-pane="profile"><span>PR</span><span>Profile</span></button>  
  </div>  

  <div class="kt-ai-panel" id="kt-ai-panel">  
    <div class="kt-ai-panel-header">  
      <div class="kt-ai-panel-title">  
        <span id="kt-ai-title">Kuantara Panel</span>  
        <span id="kt-ai-subtitle">Floating utility for AI, chart & notes.</span>  
      </div>  
      <div class="kt-ai-panel-close" id="kt-ai-close">✕</div>  
    </div>  
    <div class="kt-ai-panel-body" id="kt-ai-body"></div>  
    <div class="kt-ai-footer" id="kt-ai-footer"></div>  
  </div>  

  <div class="kt-overlay" id="kt-search-ovl" aria-hidden="true">  
    <div class="kt-card">  
      <div class="kt-card-title">Search</div>  
      <input id="kt-search-input" class="kt-search-input" type="text" placeholder="Cari menu/sub… (Enter untuk lompat, Esc tutup)" />  
      <div class="kt-search-chips" id="kt-search-chips"></div>
      <div class="kt-search-suggestions hidden" id="kt-search-suggestions"></div>  
      <button class="kt-close-btn" id="kt-search-close">Close</button>  
    </div>  
  </div>  

  <div class="kt-cheatsheet" id="kt-cheatsheet">  
    <div><b>Alt+0–9</b> Menu · <b>Ctrl+1–9</b> Sub · <b>Esc</b>=Alt+0 · <b>Ctrl+F</b> Search · <b>Tab</b> Profile</div>  
  </div>  

  <script>  
    (function(){  
      const mainButtons = document.querySelectorAll(".kt-mainmenu-btn");  
      const bottomItems = document.querySelectorAll(".kt-bottom-item");  
      const submenuGroups = document.querySelectorAll(".kt-submenu-group");  
      const submenuButtons = document.querySelectorAll(".kt-submenu-btn");  
  
      const breadcrumbMain = document.getElementById("breadcrumb-main");  
      const breadcrumbSub  = document.getElementById("breadcrumb-sub");  
      const statusMsg      = document.getElementById("kt-status-msg");  
      const sessionTimes   = document.querySelectorAll(".kt-session-time");  
  
      const aiFab    = document.getElementById("kt-ai-fab");  
      const aiMenu   = document.getElementById("kt-ai-menu");  
      const aiPanel  = document.getElementById("kt-ai-panel");  
      const aiClose  = document.getElementById("kt-ai-close");  
      const aiTitle  = document.getElementById("kt-ai-title");  
      const aiSubtitle = document.getElementById("kt-ai-subtitle");  
      const aiBody   = document.getElementById("kt-ai-body");  
      const aiFooter = document.getElementById("kt-ai-footer");  
      const aiMenuButtons = document.querySelectorAll(".kt-ai-menu-btn");  
  
      const searchOvl   = document.getElementById("kt-search-ovl");  
      const searchInput = document.getElementById("kt-search-input");  
      const searchClose = document.getElementById("kt-search-close");  
      const searchSuggestions = document.getElementById("kt-search-suggestions");  
      const searchChips = document.getElementById("kt-search-chips");
  
      const iframeLayer   = document.getElementById("kt-iframe-layer");  
      const topbar        = document.getElementById("kt-topbar");  
      const mainmenuStrip = document.getElementById("kt-mainmenu-strip");  
      const contentHeader = document.getElementById("kt-content-header");  
      const statusbar     = document.getElementById("kt-statusbar");  
      const submenuStrip  = document.getElementById("kt-submenu-strip");  
      const bottomNav     = document.getElementById("kt-bottom-nav");  
      const profilePage   = document.getElementById("kt-profile-page");  
      const workspacePage = document.getElementById("kt-workspace-page");  
      const workspaceBoard = document.getElementById("kt-workspace-board");  
      const workspaceAddBtn = document.getElementById("kt-workspace-add-current");  
      const workspaceClearBtn = document.getElementById("kt-workspace-clear");  
  
      const TOP_TRIGGER_ZONE = 60;  
      const BOTTOM_TRIGGER_ZONE = 120;  
      const HIDE_DELAY = 1800;  
      const CLICK_GRACE = 450;  
      let hideTimer=null, graceTimer=null;  
        
      /* Pin State */  
      let isPinned = false;  
  
      let activeMenu=0;  
      let activeBottom="home";  
  
      /* track view for workspace */  
      let currentViewUrl = "";  
      let currentViewTitleMain = "";  
      let currentViewTitleSub  = "";  
  
      /* Map menu:sub -> iframe URL */  
      const FEED_247_URL    = "https://kuantara112.github.io/Kuantara_Terminal_Charts/news_feeds_247.html";  
      const MINI_CHART_URL  = "https://kuantara112.github.io/Kuantara_Terminal_Charts/xauusd_tradingview.html";  
      const KUANTARA_AI_URL = "https://kuantara112.github.io/Kuantara_Terminal_Charts/kuantara_ai.html";  
  
      const IFRAME_MAP = {  
        // Markets  
        "0:0":"https://kuantara112.github.io/Kuantara_Terminal_Charts/overview_markets.html",  
        "0:1":"https://kuantara112.github.io/Kuantara_Terminal_Charts/markets_forex.html",  
        "0:2":"https://kuantara112.github.io/Kuantara_Terminal_Charts/markets_fixed.html",  
        "0:3":"https://kuantara112.github.io/Kuantara_Terminal_Charts/markets_commodities.html",  
        "0:4":"https://kuantara112.github.io/Kuantara_Terminal_Charts/markets_equities.html",  
        "0:5":"https://kuantara112.github.io/Kuantara_Terminal_Charts/markets_crypto.html",  
  
        // News  
        "1:0":FEED_247_URL,  
        "1:1":"https://kuantara112.github.io/Kuantara_Terminal_Charts/news_insights.html",  
        "1:2":"https://kuantara112.github.io/Kuantara_Terminal_Charts/news_calendar.html",  
        "1:3":"https://kuantara112.github.io/Kuantara_Terminal_Charts/news_global.html",  
        "1:4":"https://kuantara112.github.io/Kuantara_Terminal_Charts/news_channel.html",  
        "1:5":"https://kuantara112.github.io/Kuantara_Terminal_Charts/news_indonesia.html",  
  
        // Macroeconomic (US Macro removed, indices realigned)
        "2:0":"https://kuantara112.github.io/Kuantara_Terminal_Charts/macroeconomic_centralbank.html",  
        "2:1":"https://kuantara112.github.io/Kuantara_Terminal_Charts/macroeconomic_majorcountry.html",  
        "2:2":"https://kuantara112.github.io/Kuantara_Terminal_Charts/macroeconomic_countries.html",  
  
        // Geo-Economic  
        "3:0":"https://kuantara112.github.io/Kuantara_Terminal_Charts/geoecon_georisk.html",  
        "3:1":"https://kuantara112.github.io/Kuantara_Terminal_Charts/geoecon_tradeshipping.html",  
        "3:2":"https://kuantara112.github.io/Kuantara_Terminal_Charts/geoecon_resources.html",  
  
        // Metrics Labs
        "4:0":"https://kuantara112.github.io/Kuantara_Terminal_Charts/metrics_macro.html",  
        "4:1":"https://kuantara112.github.io/Kuantara_Terminal_Charts/metrics_liquidity.html",  
        "4:2":"https://kuantara112.github.io/Kuantara_Terminal_Charts/metrics_sentiment.html",  
  
        // Companies (updated)
        "5:0":"https://kuantara112.github.io/Kuantara_Terminal_Charts/companies_us.html",  
        "5:1":"https://kuantara112.github.io/Kuantara_Terminal_Charts/companies_us2.html",   // NASDAQ100
        "5:2":"https://kuantara112.github.io/Kuantara_Terminal_Charts/companies_us3.html",   // DJI30
        "5:3":"https://kuantara112.github.io/Kuantara_Terminal_Charts/companies_indo.html",  // JKSE
        "5:4":"https://kuantara112.github.io/Kuantara_Terminal_Charts/companies_foreign.html", // FOREIGN
        "5:5":"https://kuantara112.github.io/Kuantara_Terminal_Charts/companies_blockchain.html",  
  
        // Charts (Fundamental removed, realigned)
        "6:0":"https://kuantara112.github.io/Kuantara_Terminal_Charts/technical_charts.html",  
        "6:1":"https://kuantara112.github.io/Kuantara_Terminal_Charts/charts_economy.html",  
        "6:2":"https://kuantara112.github.io/Kuantara_Terminal_Charts/charts_realtime.html",  
  
        // Screener (IDX Stocks + Crypto + Flows)
        "7:0":"https://kuantara112.github.io/Kuantara_Terminal_Charts/screener_stocks.html",  
        "7:1":"https://kuantara112.github.io/Kuantara_Terminal_Charts/screener_crypto.html",  
        "7:2":"https://kuantara112.github.io/Kuantara_Terminal_Charts/screener_flows.html",  
  
        // Research (Reports and Quant swapped)
        "8:0":"https://kuantara112.github.io/Kuantara_Terminal_Charts/research_institutions.html",  
        "8:1":"https://kuantara112.github.io/Kuantara_Terminal_Charts/research_quant.html",  
        "8:2":"https://kuantara112.github.io/Kuantara_Terminal_Charts/research_reports.html",  
  
        // Tools (Education and Calculator swapped)
        "9:0":"https://kuantara112.github.io/Kuantara_Terminal_Charts/tools_journal.html",  
        "9:1":"https://kuantara112.github.io/Kuantara_Terminal_Charts/tools_calc.html",  
        "9:2":"https://kuantara112.github.io/Kuantara_Terminal_Charts/tools_edu.html",  
        "9:3":"https://kuantara112.github.io/Kuantara_Terminal_Charts/tools_others.html"  
      };  
  
      function injectIframe(url){  
        if(!url){  
          iframeLayer.innerHTML="";  
          return;  
        }  

        iframeLayer.innerHTML = `  
          <div class="kt-iframe-loading" id="kt-iframe-loading">  
            <div class="kt-iframe-spinner"></div>  
            <div class="kt-iframe-loading-text">Loading view…</div>  
          </div>  
          <iframe title="embedded" loading="lazy" src="${url}"></iframe>  
        `;  

        const iframe = iframeLayer.querySelector("iframe");  
        const loader = iframeLayer.querySelector(".kt-iframe-loading");  

        if(iframe){  
          iframe.addEventListener("load", ()=>{  
            if(loader){  
              loader.classList.add("kt-iframe-loading-done");  
              setTimeout(()=>{  
                if(loader && loader.parentNode){  
                  loader.parentNode.removeChild(loader);  
                }  
              }, 350);  
            }  
            if(!isPinned){  
              statusMsg.textContent = url ? "EMBED: "+url : "READY (No content)";  
            }  
          });  
        }  

        updateIframeInteractivity();  
      }  
  
      function updateIframeInteractivity(){  
        iframeLayer.style.pointerEvents = "auto";  
      }  
  
      function renderContent(menuIndex, subIndex){  
        const key = menuIndex+":"+subIndex;  
        const url = IFRAME_MAP[key] || "";  

        if(!isPinned){  
          statusMsg.textContent = url ? "LOADING: "+url : "READY (No content)";  
        }  

        injectIframe(url);  
        currentViewUrl = url;  
        currentViewTitleMain = breadcrumbMain.textContent || "";  
        currentViewTitleSub  = breadcrumbSub.textContent || "";  
      }  
  
      function setActiveMenu(menuIndex){  
        activeMenu = menuIndex;  
        document.querySelectorAll(".kt-mainmenu-btn").forEach(btn=>{  
          btn.classList.toggle("active", Number(btn.getAttribute("data-menu"))===menuIndex);  
        });  
        submenuGroups.forEach(group=>{  
          group.classList.toggle("active", Number(group.getAttribute("data-menu-sub"))===menuIndex);  
        });  
        const activeMain = document.querySelector('.kt-mainmenu-btn[data-menu="'+menuIndex+'"] span:nth-child(2)');  
        if(activeMain) breadcrumbMain.textContent = menuIndex+" · "+activeMain.textContent.trim();  
  
        const firstSub = document.querySelector('.kt-submenu-btn[data-menu="'+menuIndex+'"][data-sub-index="0"]');  
        if(firstSub){ setActiveSub(menuIndex,0); } else { breadcrumbSub.textContent=""; renderContent(menuIndex,-1); }  
  
        if(!isPinned) statusMsg.textContent = "ACTIVE MENU: "+menuIndex;  
      }  
  
      function setActiveSub(menuIndex, subIndex){  
        submenuButtons.forEach(btn=>{  
          const m=Number(btn.getAttribute("data-menu"));  
          const s=Number(btn.getAttribute("data-sub-index"));  
          btn.classList.toggle("active", m===menuIndex && s===subIndex);  
        });  
        const sub = document.querySelector('.kt-submenu-btn[data-menu="'+menuIndex+'"][data-sub-index="'+subIndex+'"]');  
        if(sub){   
          breadcrumbSub.textContent=sub.textContent.trim();   
          if(!isPinned) statusMsg.textContent="ACTIVE: "+menuIndex+" · "+breadcrumbSub.textContent;   
        }  
        else {   
          breadcrumbSub.textContent="";   
          if(!isPinned) statusMsg.textContent="ACTIVE MENU: "+menuIndex+" · (no sub)";   
        }  
  
        renderContent(menuIndex, subIndex);  
      }  
  
      function setBottomActive(role){  
        activeBottom = role;  
        bottomItems.forEach(item=>{  
          item.classList.toggle("active", item.getAttribute("data-bottom-role")===role);  
        });  
      }  
  
      function showProfilePage(){  
        profilePage.style.display="block";  
      }  
      function hideProfilePage(){  
        profilePage.style.display="none";  
      }  
  
      function showWorkspacePage(){  
        workspacePage.style.display="block";  
      }  
      function hideWorkspacePage(){  
        workspacePage.style.display="none";  
      }  
  
      function setupEventListeners() {  
        /* Main menu */  
        mainButtons.forEach(btn => {  
          btn.addEventListener('click', (e) => {  
            e.stopPropagation();  
            if(activeBottom!=="home"){  
              setBottomActive("home");  
              hideProfilePage();  
              hideWorkspacePage();  
            }  
            setActiveMenu(Number(btn.getAttribute("data-menu")));  
            if(!isPinned) { showAllBars(); scheduleHide(); }  
          });  
        });  
  
        /* Submenu */  
        submenuButtons.forEach(btn => {  
          btn.addEventListener('click', (e) => {  
            e.stopPropagation();  
            if(activeBottom!=="home"){  
              setBottomActive("home");  
              hideProfilePage();  
              hideWorkspacePage();  
            }  
            const menuIndex = Number(btn.getAttribute("data-menu"));  
            const subIndex = Number(btn.getAttribute("data-sub-index"));  
            setActiveSub(menuIndex, subIndex);  
            if(!isPinned) { showAllBars(); scheduleHide(); }  
          });  
        });  
  
        /* Bottom bar behaviour */  
        bottomItems.forEach(item=>{  
          item.addEventListener("click",(e)=>{  
            e.stopPropagation();  
            const role = item.getAttribute("data-bottom-role");  
  
            if(role==="home"){  
              setBottomActive("home");  
              hideProfilePage();  
              hideWorkspacePage();  
              setActiveMenu(0);  
              setActiveSub(0,0);  
              if(!isPinned) { showAllBars(); scheduleHide(); }  
            }  
            else if(role==="workspace"){  
              setBottomActive("workspace");  
              hideProfilePage();  
              hideAllBars();  
              injectIframe("");  
              showWorkspacePage();  
            }  
            else if(role==="search"){  
              // Search is an action button (center), tidak mengubah mode "home/workspace"
              if(activeBottom!=="home"){  
                setBottomActive("home");  
                hideProfilePage();  
                hideWorkspacePage();  
                setActiveMenu(0);  
                setActiveSub(0,0);  
              }  
              openSearch();  
              showAllBars();  
            }  
          });  
        });  
  
        /* Workspace buttons */  
        if(workspaceAddBtn){  
          workspaceAddBtn.addEventListener("click",(e)=>{  
            e.stopPropagation();  
            addCurrentViewToWorkspace();  
          });  
        }  
        if(workspaceClearBtn){  
          workspaceClearBtn.addEventListener("click",(e)=>{  
            e.stopPropagation();  
            clearWorkspace();  
          });  
        }  
  
        /* Pin/Unpin Double Click on Topbar */  
        topbar.addEventListener("dblclick", (e) => {  
          isPinned = !isPinned;  
          document.body.classList.toggle("kt-pinned", isPinned);  
            
          if(isPinned){  
            clearTimeout(hideTimer);  
            statusMsg.textContent = "Autohide disabled";  
            showAllBars();  
          } else {  
            statusMsg.textContent = currentViewUrl ? "EMBED: "+currentViewUrl : "READY";  
            if(activeBottom==="home") scheduleHide();  
          }  
        });  
      }  
  
      /* SEARCH INDEX + FIND */  
      function buildSearchIndex(){  
        const idx=[];  
        document.querySelectorAll(".kt-mainmenu-btn").forEach(btn=>{  
          const menuIdx=Number(btn.getAttribute("data-menu"));  
          const name=btn.querySelector("span:nth-child(2)")?.textContent?.trim()||"";  
          idx.push({label:name,menu:menuIdx,sub:null,type:"menu"});  
        });  
        document.querySelectorAll(".kt-submenu-btn").forEach(btn=>{  
          const menuIdx=Number(btn.getAttribute("data-menu"));  
          const subIdx=Number(btn.getAttribute("data-sub-index"));  
          const name=btn.textContent.trim();  
          idx.push({label:name,menu:menuIdx,sub:subIdx,type:"sub"});  
        });  
        return idx;  
      }  
      function findBestMatch(index,qRaw){  
        const q=qRaw.toLowerCase();  
        return index.find(it=>it.label.toLowerCase()===q)  
            || index.find(it=>it.label.toLowerCase().startsWith(q))  
            || index.find(it=>it.label.toLowerCase().includes(q))  
            || null;  
      }  
  
      let searchIndex=buildSearchIndex();  
  
      function openOverlay(el){ el.style.display="flex"; updateIframeInteractivity(); }  
      function closeOverlay(el){ el.style.display="none"; updateIframeInteractivity(); }  
  
      function clearSearchSuggestions(){  
        if(!searchSuggestions) return;  
        searchSuggestions.innerHTML = "";  
        searchSuggestions.classList.add("hidden");  
      }  

      function clearSearchChips(){
        if(!searchChips) return;
        searchChips.innerHTML = "";
      }

      function jumpToTarget(match){
        if(!match) return;
        if(activeBottom!=="home"){  
          setBottomActive("home");  
          hideProfilePage();  
          hideWorkspacePage();  
        }  
        setActiveMenu(match.menu);  
        if(match.sub!==null && match.sub!==undefined) setActiveSub(match.menu,match.sub);  
        if(!isPinned) statusMsg.textContent=`SEARCH goto: ${match.label} (${match.type})`;  
      }
  
      function updateSearchSuggestions(qRaw){  
        if(!searchSuggestions) return;  
        const q = (qRaw || "").trim();  
        if(!q){  
          clearSearchSuggestions();  
          return;  
        }  
        const qLower = q.toLowerCase();  
        const matches = searchIndex  
          .filter(it => it.label.toLowerCase().includes(qLower))  
          .slice(0, 10);  
  
        if(matches.length===0){  
          clearSearchSuggestions();  
          return;  
        }  
  
        searchSuggestions.innerHTML = "";  
  
        matches.forEach(match => {  
          const item = document.createElement("div");  
          item.className = "kt-search-suggestion-item";  
  
          const mainSpan = document.createElement("span");  
          mainSpan.className = "kt-search-suggestion-main";  
          mainSpan.textContent = match.label;  
  
          const metaSpan = document.createElement("span");  
          metaSpan.className = "kt-search-suggestion-meta";  
          metaSpan.textContent = match.type==="menu"  
            ? `Menu ${match.menu}`  
            : `Sub ${match.menu}:${match.sub}`;  
  
          item.appendChild(mainSpan);  
          item.appendChild(metaSpan);  
  
          item.addEventListener("click", () => {  
            jumpToTarget(match);
            closeSearch();  
          });  
  
          searchSuggestions.appendChild(item);  
        });  
  
        searchSuggestions.classList.remove("hidden");  
      }  

      /* RANDOM CHIPS BAWAH INPUT SEARCH */
      function renderRandomChips(){
        if(!searchChips) return;
        clearSearchChips();
        if(!searchIndex || !searchIndex.length) return;

        const candidates = searchIndex.slice(); // menu + sub
        if(!candidates.length) return;

        // shuffle sederhana
        for(let i = candidates.length - 1; i > 0; i--){
          const j = Math.floor(Math.random() * (i + 1));
          const tmp = candidates[i];
          candidates[i] = candidates[j];
          candidates[j] = tmp;
        }

        const maxCount = Math.min(3, candidates.length);
        const minCount = Math.min(2, maxCount);
        const count = maxCount <= 2 ? maxCount : (minCount + Math.floor(Math.random() * (maxCount - minCount + 1)));
        const picks = candidates.slice(0, count);

        picks.forEach(match => {
          const chip = document.createElement("button");
          chip.type = "button";
          chip.className = "kt-search-chip";
          chip.textContent = match.label;
          chip.addEventListener("click", () => {
            jumpToTarget(match);
            closeSearch();
          });
          searchChips.appendChild(chip);
        });
      }
  
      function openSearch(){  
        searchIndex=buildSearchIndex();  
        openOverlay(searchOvl);  
        setTimeout(()=>searchInput.focus(),10);  
        if(!isPinned) statusMsg.textContent="SEARCH: active";  
        if(activeBottom==="home"){  
          showAllBars();  
        }  
        renderRandomChips();
        updateSearchSuggestions(searchInput.value || "");  
      }  
      function closeSearch(){   
        closeOverlay(searchOvl);   
        clearSearchSuggestions();  
        clearSearchChips();
        if(!isPinned) statusMsg.textContent="SEARCH: closed";   
        if(activeBottom==="home" && !isPinned) scheduleHide();   
      }  
  
      searchClose.addEventListener("click", closeSearch);  
      searchOvl.addEventListener("click",(e)=>{ if(e.target===searchOvl) closeSearch(); });  
  
      searchInput.addEventListener("input",(e)=>{  
        const v = e.target.value || "";  
        updateSearchSuggestions(v);  
      });  
  
      searchInput.addEventListener("keydown",(e)=>{  
        if(e.key==="Escape"){ e.preventDefault(); closeSearch(); return; }  
        if(e.key==="Enter"){  
          e.preventDefault();  
          const q=(searchInput.value||"").trim();  
          if(!q){   
            if(!isPinned) statusMsg.textContent="SEARCH: empty";   
            closeSearch();   
            return;   
          }  
          const match=findBestMatch(searchIndex,q);  
          if(match){  
            jumpToTarget(match);
          }  
          else{  
            if(!isPinned) statusMsg.textContent=`SEARCH: "${q}" not found`;  
          }  
          closeSearch();  
        }  
      });  
  
      /* AUTOHIDE BARS – hanya aktif di HOME */  
      function showTopBars(){  
        if(activeBottom!=="home") return;  
        mainmenuStrip.classList.remove("kt-hide-top");  
        contentHeader.classList.remove("kt-hide-top");  
        clearTimeout(graceTimer);  
        graceTimer=setTimeout(()=>{},CLICK_GRACE);  
        updateIframeInteractivity();  
      }  
  
      function hideTopBars(){  
        if(isPinned) return;  
        mainmenuStrip.classList.add("kt-hide-top");  
        contentHeader.classList.add("kt-hide-top");  
        updateIframeInteractivity();  
      }  
  
      function showBottomBars(){  
        if(activeBottom!=="home") return;  
        submenuStrip.classList.remove("kt-hide-bottom");  
        statusbar.classList.remove("kt-hide-bottom");  
        clearTimeout(graceTimer);  
        graceTimer=setTimeout(()=>{},CLICK_GRACE);  
        updateIframeInteractivity();  
      }  
  
      function hideBottomBars(){  
        if(isPinned) return;  
        submenuStrip.classList.add("kt-hide-bottom");  
        statusbar.classList.add("kt-hide-bottom");  
        updateIframeInteractivity();  
      }  
  
      function showAllBars(){  
        if(activeBottom!=="home") return;  
        mainmenuStrip.classList.remove("kt-hide-top");  
        contentHeader.classList.remove("kt-hide-top");  
        submenuStrip.classList.remove("kt-hide-bottom");  
        statusbar.classList.remove("kt-hide-bottom");  
        clearTimeout(graceTimer);  
        graceTimer=setTimeout(()=>{},CLICK_GRACE);  
        updateIframeInteractivity();  
      }  
  
      function hideAllBars(){  
        if(isPinned) return;  
        mainmenuStrip.classList.add("kt-hide-top");  
        contentHeader.classList.add("kt-hide-top");  
        submenuStrip.classList.add("kt-hide-bottom");  
        statusbar.classList.add("kt-hide-bottom");  
        updateIframeInteractivity();  
      }  
  
      function scheduleHide(){  
        if(activeBottom!=="home" || isPinned) return;  
        clearTimeout(hideTimer);  
        hideTimer=setTimeout(()=>{ hideAllBars(); }, HIDE_DELAY);  
      }  
  
      function handleMouseMove(e){  
        if(activeBottom!=="home" || isPinned) return;  
        const y = e.clientY;  
        const h = window.innerHeight;  
        const nearTop = y <= TOP_TRIGGER_ZONE;  
        const nearBottom = y >= (h - BOTTOM_TRIGGER_ZONE);  
  
        if (nearTop) {  
          showTopBars();  
          scheduleHide();  
        } else if (nearBottom) {  
          showBottomBars();  
          scheduleHide();  
        }  
      }  
  
      window.addEventListener("mousemove", handleMouseMove, {passive:true});  
  
      window.addEventListener("touchstart",(e)=>{  
        if(activeBottom!=="home" || isPinned) return;  
        const y=e.touches[0]?.clientY??0, h=window.innerHeight;  
        const nearTop = y <= TOP_TRIGGER_ZONE;  
        const nearBottom = y >= (h - BOTTOM_TRIGGER_ZONE);  
  
        if(nearTop) showTopBars();  
        if(nearBottom) showBottomBars();  
        scheduleHide();  
      },{passive:true});  
  
      [mainmenuStrip, contentHeader, submenuStrip, statusbar, bottomNav].forEach(el=>{  
        el.addEventListener("mouseenter", ()=>{  
          if(activeBottom!=="home" && el!==bottomNav) return;  
          clearTimeout(hideTimer);  
          if (el === mainmenuStrip || el === contentHeader) {  
            showTopBars();  
          } else if (el !== bottomNav) {  
            showBottomBars();  
          }  
        });  
        el.addEventListener("mouseleave", ()=>{  
          if(el===bottomNav) return;  
          scheduleHide();  
        });  
        el.addEventListener("pointerdown", ()=>{ clearTimeout(hideTimer); });  
        el.addEventListener("click", (e)=>{ e.stopPropagation(); });  
      });  
  
      document.querySelectorAll('.kt-mainmenu-btn, .kt-submenu-btn').forEach(btn=>{  
        btn.addEventListener('pointerdown', (e)=>{  
          e.stopPropagation();  
          showAllBars();  
          updateIframeInteractivity();  
        });  
        btn.addEventListener('click', (e)=>{ e.stopPropagation(); });  
      });  
  
      /* FLOATING MENU LOGIC */  
      function toggleAiMenu(force){  
        const isOpen = aiMenu.style.display==="flex";  
        const next = typeof force==="boolean" ? force : !isOpen;  
        aiMenu.style.display = next ? "flex" : "none";  
      }  
  
      function openAiPane(mode){  
        if(mode==="ai"){  
          aiTitle.textContent = "Kuantara AI Assistant";  
          aiSubtitle.textContent = "Kuantara AI terintegrasi langsung di dalam panel ini.";  
          aiBody.innerHTML =  
            '<iframe src="'+KUANTARA_AI_URL+'" ' +  
            'title="Kuantara AI" loading="lazy" ' +  
            'style="width:100%;height:100%;border:0;display:block;"></iframe>';  
          aiFooter.innerHTML = '';  
          aiPanel.style.display="flex";  
          if(activeBottom==="home") showAllBars();  
        }else if(mode==="mini"){  
          aiTitle.textContent = "Mini Chart";  
          aiSubtitle.textContent = "Chart kecil untuk quick view XAUUSD.";  
          aiBody.innerHTML =  
            '<iframe src="'+MINI_CHART_URL+'" ' +  
            'title="Mini Chart" loading="lazy" ' +  
            'style="width:100%;height:100%;border:0;display:block;"></iframe>';  
          aiFooter.innerHTML = '';  
          aiPanel.style.display="flex";  
          if(activeBottom==="home") showAllBars();  
        }else if(mode==="notes"){  
          aiTitle.textContent = "Notes";  
          aiSubtitle.textContent = "Catatan cepat untuk ide trade dan macro view.";  
          aiBody.innerHTML =  
            '<textarea id="kt-notes-area" ' +  
            'style="width:100%;height:100%;background:#111;border:none;border-radius:0;' +  
            'color:var(--text-main);padding:6px;font-size:11px;resize:none;box-sizing:border-box;outline:none;overflow:auto;" ' +  
            'placeholder="Tulis catatan di sini..."></textarea>';  
          aiFooter.innerHTML = '';  
  
          const notesArea = document.getElementById("kt-notes-area");  
          if(window.localStorage){  
            const saved = localStorage.getItem("kuantara_notes");  
            if(saved) notesArea.value = saved;  
            notesArea.addEventListener("input", ()=>localStorage.setItem("kuantara_notes", notesArea.value));  
          }  
          aiPanel.style.display="flex";  
          if(activeBottom==="home") showAllBars();  
        }else if(mode==="signals"){  
          aiTitle.textContent = "Alerts";  
          aiSubtitle.textContent = "Ringkasan alert trading & notifikasi utama.";  
          aiBody.innerHTML =  
            '<div style="width:100%;height:100%;padding:8px 10px;box-sizing:border-box;font-size:10px;line-height:1.5;color:var(--text-muted);overflow:auto;">' +  
            'Panel ini akan menampilkan alert dari sistem Kuantara (algo, screener, atau alert eksternal). ' +  
            'Integrasi backend bisa diarahkan untuk push alert terbaru ke area ini secara realtime.' +  
            '</div>';  
          aiFooter.innerHTML = '';  
          aiPanel.style.display="flex";  
          if(activeBottom==="home") showAllBars();  
        }else if(mode==="group"){  
          aiTitle.textContent = "Group Chat";  
          aiSubtitle.textContent = "Chat antar user Kuantara Terminal (prototype).";  
          aiBody.innerHTML =  
            '<div style="width:100%;height:100%;padding:8px 10px;box-sizing:border-box;font-size:10px;line-height:1.5;color:var(--text-muted);overflow:auto;">' +  
              'Fitur ini didesain sebagai ruang obrolan realtime antar pengguna Kuantara Terminal. ' +  
              'Integrasi backend (Telegram/Discord/WebSocket) bisa dihubungkan ke panel ini di tahap berikutnya.' +  
              '<div style="margin-top:8px;padding:6px 8px;border-radius:6px;border:1px dashed var(--border-soft);font-size:10px;color:var(--text-muted);">' +  
              'Prototype: belum terhubung ke server chat. Di versi production, area ini akan menampilkan pesan, daftar user online, dan input box untuk mengirim chat.' +  
              '</div>' +  
            '</div>';  
          aiFooter.innerHTML = '';  
          aiPanel.style.display="flex";  
          if(activeBottom==="home") showAllBars();  
        }else if(mode==="profile"){  
          aiPanel.style.display="none";  
          toggleAiMenu(false);  
          setBottomActive("home");  
          hideWorkspacePage();  
          hideAllBars();  
          injectIframe("");  
          showProfilePage();  
        }  
      }  
  
      aiFab.addEventListener("click", (e)=>{  
        e.stopPropagation();  
        toggleAiMenu();  
        if(activeBottom==="home") showAllBars();  
      });  
  
      aiMenuButtons.forEach(btn=>{  
        btn.addEventListener("click",(e)=>{  
          e.stopPropagation();  
          const pane = btn.getAttribute("data-pane");  
          toggleAiMenu(false);  
          openAiPane(pane);  
        });  
      });  
  
      aiClose.addEventListener("click", ()=>{  
        aiPanel.style.display="none";  
      });  
  
      window.addEventListener("click",(e)=>{  
        if(!aiFab.contains(e.target) && !aiMenu.contains(e.target) && !aiPanel.contains(e.target)){  
          toggleAiMenu(false);  
        }  
      });  
  
      aiPanel.addEventListener("click",(e)=>{ e.stopPropagation(); });  
  
      /* WORKSPACE LOGIC */  
      function ensureWorkspacePlaceholder(){  
        if(!workspaceBoard) return;  
        if(!workspaceBoard.querySelector(".kt-workspace-window")){  
          workspaceBoard.innerHTML =  
            '<div class="kt-workspace-placeholder">' +  
            'Belum ada window di Workspace.<br>' +  
            'Pergi ke Home, pilih view yang kamu suka, lalu klik <b>Add current view</b>.' +  
            '</div>';  
        }  
      }  
  
      function createWorkspaceWindow(url, titleMain, titleSub){  
        if(!workspaceBoard || !url) return;  
        const placeholder = workspaceBoard.querySelector(".kt-workspace-placeholder");  
        if(placeholder) placeholder.remove();  
  
        const win = document.createElement("div");  
        win.className = "kt-workspace-window";  
        const count = workspaceBoard.querySelectorAll(".kt-workspace-window").length;  
        const offset = count * 24;  
  
        win.style.left = (20 + offset) + "px";  
        win.style.top  = (20 + offset) + "px";  
        win.style.width = "380px";  
        win.style.height = "240px";  
  
        const title = (titleMain || "View") + (titleSub ? " · " + titleSub : "");  
  
        win.innerHTML = `  
          <div class="kt-workspace-window-header">  
            <span class="kt-workspace-window-title">${title}</span>  
            <button class="kt-workspace-window-close" title="Close">✕</button>  
          </div>  
          <div class="kt-workspace-window-body">  
            <iframe src="${url}" loading="lazy" title="Workspace view" frameborder="0"></iframe>  
          </div>  
          <div class="kt-workspace-resizer" title="Drag to resize"></div>  
        `;  
  
        workspaceBoard.appendChild(win);  
  
        const closeBtn = win.querySelector(".kt-workspace-window-close");  
        if(closeBtn){  
          closeBtn.addEventListener("click", ()=>{  
            win.remove();  
            ensureWorkspacePlaceholder();  
          });  
        }  
  
        attachDragHandlers(win);  
        attachResizeHandlers(win);  
      }  
  
      function addCurrentViewToWorkspace(){  
        if(!currentViewUrl){  
          if(!isPinned) statusMsg.textContent = "WORKSPACE: no active view to add";  
          return;  
        }  
        createWorkspaceWindow(currentViewUrl, currentViewTitleMain, currentViewTitleSub);  
        if(!isPinned) statusMsg.textContent = "WORKSPACE: view added";  
      }  
  
      function clearWorkspace(){  
        if(!workspaceBoard) return;  
        workspaceBoard.innerHTML = "";  
        ensureWorkspacePlaceholder();  
        if(!isPinned) statusMsg.textContent = "WORKSPACE: cleared";  
      }  
  
      function attachDragHandlers(win){  
        const header = win.querySelector(".kt-workspace-window-header");  
        if(!header || !workspaceBoard) return;  
        let isDragging=false, startX=0,startY=0,startLeft=0,startTop=0;  
  
        header.addEventListener("pointerdown",(e)=>{  
          const isClose = e.target.closest(".kt-workspace-window-close");  
          if(isClose) return;  
          e.preventDefault();  
          isDragging=true;  
          const rect = win.getBoundingClientRect();  
          const boardRect = workspaceBoard.getBoundingClientRect();  
          startX = e.clientX;  
          startY = e.clientY;  
          startLeft = rect.left - boardRect.left;  
          startTop  = rect.top  - boardRect.top;  
  
          win.setPointerCapture(e.pointerId);  
  
          const onMove = (ev)=>{  
            if(!isDragging) return;  
            const dx = ev.clientX - startX;  
            const dy = ev.clientY - startY;  
  
            let newLeft = startLeft + dx;  
            let newTop  = startTop + dy;  
  
            const maxLeft = workspaceBoard.clientWidth - win.offsetWidth;  
            const maxTop  = workspaceBoard.clientHeight - 40;  
  
            if(newLeft < 0) newLeft = 0;  
            if(newTop  < 0) newTop  = 0;  
            if(newLeft > maxLeft) newLeft = maxLeft;  
            if(newTop  > maxTop)  newTop  = maxTop;  
  
            win.style.left = newLeft + "px";  
            win.style.top  = newTop  + "px";  
          };  
  
          const onUp = (ev)=>{  
            isDragging=false;  
            try { win.releasePointerCapture(ev.pointerId); } catch(e){}  
            window.removeEventListener("pointermove", onMove);  
            window.removeEventListener("pointerup", onUp);  
          };  
  
          window.addEventListener("pointermove", onMove);  
          window.addEventListener("pointerup", onUp);  
        });  
      }  
  
      function attachResizeHandlers(win){  
        const handle = win.querySelector(".kt-workspace-resizer");  
        if(!handle || !workspaceBoard) return;  
  
        let isResizing=false, startX=0,startY=0,startW=0,startH=0;  
  
        handle.addEventListener("pointerdown",(e)=>{  
          e.preventDefault();  
          e.stopPropagation();  
          isResizing=true;  
          const rect = win.getBoundingClientRect();  
          startX = e.clientX;  
          startY = e.clientY;  
          startW = rect.width;  
          startH = rect.height;  
  
          win.setPointerCapture(e.pointerId);  
  
          const onMove = (ev)=>{  
            if(!isResizing) return;  
            const dx = ev.clientX - startX;  
            const dy = ev.clientY - startY;  
            let newW = startW + dx;  
            let newH = startH + dy;  
  
            const minW = 220;  
            const minH = 140;  
            const boardRect = workspaceBoard.getBoundingClientRect();  
            const winRect = win.getBoundingClientRect();  
  
            if(newW < minW) newW = minW;  
            if(newH < minH) newH = minH;  
            if(winRect.left + newW > boardRect.right) newW = boardRect.right - winRect.left;  
            if(winRect.top + newH > boardRect.bottom) newH = boardRect.bottom - winRect.top;  
  
            win.style.width  = newW + "px";  
            win.style.height = newH + "px";  
          };  
  
          const onUp = (ev)=>{  
            isResizing=false;  
            try { win.releasePointerCapture(ev.pointerId); } catch(e){}  
            window.removeEventListener("pointermove", onMove);  
            window.removeEventListener("pointerup", onUp);  
          };  
  
          window.addEventListener("pointermove", onMove);  
          window.addEventListener("pointerup", onUp);  
        });  
      }  
  
      /* Keyboard */  
      window.addEventListener("keydown",(e)=>{  
        if(e.ctrlKey && (e.key==="f"||e.key==="F")){ e.preventDefault(); openSearch(); return; }  
        if(e.altKey && !e.ctrlKey && !e.shiftKey){  
          const k=e.key; if(k>="0"&&k<="9"){  
            e.preventDefault();  
            if(activeBottom!=="home"){  
              setBottomActive("home");  
              hideProfilePage();  
              hideWorkspacePage();  
            }  
            setActiveMenu(Number(k));  
            if(!isPinned) { showAllBars(); scheduleHide(); }  
            return;  
          }  
        }  
        if(e.ctrlKey && !e.altKey){  
          const k=e.key; if(k>="1"&&k<="9"){  
            e.preventDefault();  
            if(activeBottom!=="home"){  
              setBottomActive("home");  
              hideProfilePage();  
              hideWorkspacePage();  
            }  
            setActiveSub(activeMenu, Number(k)-1);  
            if(!isPinned) { showAllBars(); scheduleHide(); }  
            return;  
          }  
        }  
        if(e.key==="Escape"){  
          e.preventDefault();  
          setBottomActive("home");  
          hideProfilePage();  
          hideWorkspacePage();  
          setActiveMenu(0);  
          setActiveSub(0,0);  
          if(!isPinned) { showAllBars(); scheduleHide(); }  
          return;  
        }  
        if(e.key==="Tab"){  
          e.preventDefault();  
          setBottomActive("home");  
          hideWorkspacePage();  
          hideAllBars();  
          injectIframe("");  
          showProfilePage();  
          return;  
        }  
        if(e.key==="Shift" && !e.repeat && !e.ctrlKey && !e.altKey){  
          const cheats=document.getElementById("kt-cheatsheet");  
          cheats.style.display="block"; setTimeout(()=>{cheats.style.display="none";},2000);  
          if(activeBottom==="home" && !isPinned){ showAllBars(); scheduleHide(); }  
          return;  
        }  
      });  
  
      /* HELPER: apakah market buka antara 08.00–17.00 waktu lokal */  
      function isMarketOpen(label, hour, minute){  
        const mins = hour*60 + minute;  
        return mins >= 8*60 && mins < 17*60;  
      }  
  
      /* Clocks pakai timezone asli (akurasi DST) */  
      function updateSessions(){  
        const now = new Date();  
        sessionTimes.forEach(el=>{  
          const tzid = el.getAttribute("data-tzid");  
          if(!tzid){  
            el.textContent="--:--";  
            return;  
          }  
  
          const parts = new Intl.DateTimeFormat('en-GB',{  
            hour:'2-digit',  
            minute:'2-digit',  
            hour12:false,  
            timeZone: tzid  
          }).formatToParts(now);  
  
          const hourStr = (parts.find(p=>p.type==="hour")?.value) || "00";  
          const minStr  = (parts.find(p=>p.type==="minute")?.value) || "00";  
  
          el.textContent = hourStr+":"+minStr;  
  
          const hour = parseInt(hourStr,10);  
          const minute = parseInt(minStr,10);  
  
          const parent = el.closest(".kt-session-item");  
          if(!parent) return;  
          const labelEl = parent.querySelector(".kt-session-label");  
          const label = (labelEl?.textContent || "").trim();  
  
          if(isMarketOpen(label,hour,minute)){  
            parent.classList.add("open");  
          } else {  
            parent.classList.remove("open");  
          }  
        });  
      }  
      updateSessions();  
      setInterval(updateSessions,1000);  
  
      /* Init */  
      setupEventListeners();  
      setActiveMenu(0);  
      setBottomActive("home");  
      hideProfilePage();  
      hideWorkspacePage();  
      ensureWorkspacePlaceholder();  
      showAllBars();  
      setTimeout(()=>{ hideAllBars(); }, 1000);  
      updateIframeInteractivity();  
    })();  
  </script>  
</body>  
</html>
