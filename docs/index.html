<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Kuantara Terminal</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Fira Code -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500;700&display=swap"/>

  <style>
    :root {
      --amber: #ffbf00;
      --bg-root: #000000;
      --bg-main: #111111;
      --border-soft: #2b2b2b;
      --text-main: #f5f5f5;
      --text-muted: #9b9b9b;
      --overlay: rgba(0,0,0,0.6);
    }

    * { box-sizing: border-box; margin: 0; padding: 0; font-family: "Fira Code", monospace !important; }

    html, body { height: 100%; }
    body { background-color: var(--bg-root); color: var(--text-main); overflow: hidden; }

    .kt-root { display: flex; flex-direction: column; height: 100vh; }

    /* TOP BAR */
    .kt-topbar {
      display: flex; align-items: center; justify-content: center;
      position: relative; background: #070707;
      border-bottom: 2px solid var(--amber);
      padding: 8px 12px; font-size: 10px; z-index: 10;
    }
    .kt-topbar-left { display: flex; align-items: center; justify-content: center; gap: 8px; min-width: 0; flex-wrap: wrap; }
    .kt-logo { font-weight: 700; letter-spacing: 0.06em; text-transform: uppercase; font-size: 14px; color: var(--amber); white-space: nowrap; }
    .kt-session-clock { display: flex; flex-wrap: wrap; gap: 4px; align-items: center; font-size: 9px; color: var(--text-muted); }
    .kt-session-item { display: inline-flex; gap: 2px; align-items: baseline; white-space: nowrap; padding: 1px 4px; border-radius: 2px; background: #101010; border: 1px solid #151515; }
    .kt-session-label { color: var(--amber); font-size: 9px; }
    .kt-session-time { font-size: 9px; }

    /* MAIN */
    .kt-main { flex: 1; display: flex; flex-direction: column; background: var(--bg-main); min-height: 0; }

    /* MAIN MENU (0–9) */
    .kt-mainmenu-strip {
      display: flex; gap: 4px; padding: 6px 8px; background: #050505;
      border-bottom: 1px solid var(--border-soft); overflow-x: auto; scrollbar-width: thin;
    }
    .kt-mainmenu-btn {
      flex: 0 0 auto; padding: 4px 8px; border-radius: 3px; border: 1px solid var(--border-soft);
      background: #101010; color: var(--text-muted); font-size: 11px; display: inline-flex; align-items: center; gap: 4px;
      cursor: pointer; white-space: nowrap;
    }
    .kt-mainmenu-btn span:first-child { color: var(--amber); font-weight: 500; }
    .kt-mainmenu-btn.active { background: var(--amber); color: #000; border-color: #f0f0f0; }
    .kt-mainmenu-btn.active span:first-child { color: #000; }

    /* CONTENT */
    .kt-content { display: flex; flex-direction: column; flex: 1; min-height: 0; }
    .kt-content-header {
      border-bottom: 1px solid var(--border-soft); padding: 6px 10px; display: flex;
      justify-content: space-between; align-items: center; font-size: 11px; gap: 8px; flex-wrap: wrap;
    }
    .kt-breadcrumb { display: flex; gap: 6px; align-items: baseline; min-width: 0; }
    .kt-breadcrumb-main { color: var(--amber); font-weight: 500; white-space: nowrap; }
    .kt-breadcrumb-sub { color: var(--text-muted); overflow: hidden; text-overflow: ellipsis; white-space: nowrap; max-width: 160px; }
    .kt-content-body { flex: 1; padding: 8px 10px; overflow: hidden; background: #111111; padding-bottom: 110px; position: relative; }

    /* IFRAME */
    .kt-embed-wrap { position: absolute; inset: 8px 10px 120px 10px; display: flex; flex-direction: column; }
    .kt-embed { width: 100%; height: 100%; border: none; background: #0b0b0b; }

    /* STATUS BAR */
    .kt-statusbar { border-top: 1px solid var(--border-soft); padding: 4px 10px 6px; font-size: 10px; display: flex; align-items: center; background: #050505; color: var(--text-muted); }
    .kt-status-msg { font-size: 10px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 100%; }

    /* SUB MENU – fixed above bottom nav */
    .kt-submenu-strip {
      position: fixed; left: 0; right: 0; bottom: 46px; border-top: 1px solid var(--border-soft);
      background: #090909; padding: 4px 6px 4px 8px; min-height: 32px; z-index: 14;
    }
    .kt-submenu-group { display: none; gap: 4px; overflow-x: auto; padding-bottom: 2px; }
    .kt-submenu-group.active { display: flex; }
    .kt-submenu-btn {
      flex: 0 0 auto; padding: 3px 8px; border-radius: 3px; border: 1px solid var(--border-soft);
      background: #101010; color: var(--text-muted); font-size: 10px; cursor: pointer; white-space: nowrap;
    }
    .kt-submenu-btn.active { background: var(--amber); color: #000; border-color: #f0f0f0; }

    /* BOTTOM NAV */
    .kt-bottom-nav {
      position: fixed; left: 0; right: 0; bottom: 0; height: 46px; background: #050505;
      border-top: 1px solid var(--border-soft); display: flex; justify-content: space-around; align-items: stretch; font-size: 10px; z-index: 15;
    }
    .kt-bottom-item { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; color: var(--text-muted); cursor: pointer; gap: 1px; }
    .kt-bottom-item span:first-child { font-size: 9px; color: var(--amber); }
    .kt-bottom-item.active { background: #151515; color: var(--amber); }

    /* AI FAB */
    .kt-ai-fab {
      position: fixed; right: 16px; bottom: 90px; width: 48px; height: 48px; border-radius: 50%;
      background: var(--amber); color: #000000; display: flex; align-items: center; justify-content: center;
      font-size: 15px; font-weight: 700; box-shadow: 0 6px 14px rgba(0, 0, 0, 0.6); cursor: pointer; z-index: 30; border: 1px solid #f0f0f0; user-select: none;
    }
    .kt-ai-panel {
      position: fixed; right: 16px; bottom: 140px; width: min(360px, 92vw); max-height: 60vh; background: #111111;
      border-radius: 10px; border: 1px solid var(--border-soft); box-shadow: 0 10px 26px rgba(0,0,0,0.8);
      display: none; flex-direction: column; overflow: hidden; z-index: 29;
    }
    .kt-ai-panel-header { padding: 8px 10px; border-bottom: 1px solid var(--border-soft); display: flex; align-items: center; justify-content: space-between; font-size: 11px; }
    .kt-ai-panel-title { display: flex; flex-direction: column; gap: 2px; }
    .kt-ai-panel-title span:first-child { color: var(--amber); font-weight: 500; font-size: 11px; }
    .kt-ai-panel-title span:last-child { color: var(--text-muted); font-size: 10px; }
    .kt-ai-panel-close { cursor: pointer; font-size: 12px; color: var(--text-muted); padding: 2px 6px; border-radius: 3px; }
    .kt-ai-panel-body { padding: 8px 10px; font-size: 11px; color: var(--text-muted); display: flex; flex-direction: column; gap: 6px; }
    .kt-ai-footer { padding: 6px 10px 8px; border-top: 1px solid var(--border-soft); display: flex; justify-content: flex-end; gap: 6px; }
    .kt-ai-btn { padding: 4px 10px; border-radius: 3px; font-size: 11px; border: 1px solid var(--border-soft); background: #181818; color: var(--text-muted); cursor: pointer; }
    .kt-ai-btn.primary { background: var(--amber); color: #000; border-color: #f0f0f0; }

    /* Overlays */
    .kt-overlay { position: fixed; inset: 0; background: var(--overlay); display: none; align-items: center; justify-content: center; z-index: 40; }
    .kt-card { background: #0e0e0e; border: 1px solid var(--border-soft); border-radius: 10px; padding: 12px; width: min(560px, 92vw); box-shadow: 0 10px 26px rgba(0,0,0,0.8); }
    .kt-card-title { color: var(--amber); font-size: 12px; margin-bottom: 8px; }
    .kt-search-input { width: 100%; padding: 10px; border-radius: 6px; border: 1px solid var(--border-soft); background: #111; color: var(--text-main); outline: none; }
    .kt-close-btn { margin-top: 10px; padding: 6px 10px; font-size: 11px; border-radius: 4px; border: 1px solid var(--border-soft); background: #181818; color: var(--text-muted); cursor: pointer; }

    .kt-cheatsheet { position: fixed; left: 50%; bottom: 70px; transform: translateX(-50%); background: #0e0e0e; border: 1px solid var(--border-soft); border-radius: 8px; padding: 8px 10px; z-index: 35; display: none; font-size: 10px; color: var(--text-muted); }
    .kt-cheatsheet b { color: var(--amber); }

    /* Desktop */
    @media (min-width: 900px) {
      .kt-mainmenu-strip { justify-content: center; }
      .kt-submenu-strip { display: flex; justify-content: center; padding-left: 0; padding-right: 0; }
      .kt-submenu-group { max-width: 980px; }
      .kt-submenu-group.active { justify-content: center; }
    }

    /* Mobile */
    @media (max-width: 600px) {
      .kt-topbar { padding: 4px 8px; }
      .kt-logo { font-size: 12px; }
      .kt-session-clock { gap: 2px; font-size: 8px; }
      .kt-session-item { padding: 0 3px; }
      .kt-session-label, .kt-session-time { font-size: 8px; }
    }
  </style>
</head>
<body>
  <div class="kt-root">
    <!-- TOP BAR -->
    <header class="kt-topbar">
      <div class="kt-topbar-left">
        <div class="kt-logo">KUANTARA TERMINAL</div>
        <div class="kt-session-clock" id="kt-session-clock">
          <div class="kt-session-item"><span class="kt-session-label">SYD</span><span class="kt-session-time" data-tz="10"></span></div>
          <div class="kt-session-item"><span class="kt-session-label">TYO</span><span class="kt-session-time" data-tz="9"></span></div>
          <div class="kt-session-item"><span class="kt-session-label">LDN</span><span class="kt-session-time" data-tz="0"></span></div>
          <div class="kt-session-item"><span class="kt-session-label">NYC</span><span class="kt-session-time" data-tz="-5"></span></div>
        </div>
      </div>
    </header>

    <!-- MAIN -->
    <div class="kt-main">
      <!-- MAIN MENU -->
      <nav class="kt-mainmenu-strip" id="kt-mainmenu-strip">
        <button class="kt-mainmenu-btn active" data-menu="0"><span>0</span><span>Markets</span></button>
        <button class="kt-mainmenu-btn" data-menu="1"><span>1</span><span>News</span></button>
        <button class="kt-mainmenu-btn" data-menu="2"><span>2</span><span>Macroeconomic</span></button>
        <button class="kt-mainmenu-btn" data-menu="3"><span>3</span><span>Geo-Economic</span></button>
        <button class="kt-mainmenu-btn" data-menu="4"><span>4</span><span>Metrics</span></button>
        <button class="kt-mainmenu-btn" data-menu="5"><span>5</span><span>Companies</span></button>
        <button class="kt-mainmenu-btn" data-menu="6"><span>6</span><span>Charts</span></button>
        <button class="kt-mainmenu-btn" data-menu="7"><span>7</span><span>Screener</span></button>
        <button class="kt-mainmenu-btn" data-menu="8"><span>8</span><span>Research</span></button>
        <button class="kt-mainmenu-btn" data-menu="9"><span>9</span><span>Tools</span></button>
      </nav>

      <!-- CONTENT -->
      <section class="kt-content">
        <div class="kt-content-header">
          <div class="kt-breadcrumb">
            <span class="kt-breadcrumb-main" id="breadcrumb-main">0 · Markets</span>
            <span class="kt-breadcrumb-sub" id="breadcrumb-sub">Overview</span>
          </div>
        </div>
        <div class="kt-content-body" id="kt-content-body">
          <div class="kt-embed-wrap" id="kt-embed-wrap" style="display:none;"></div>
          <p id="kt-placeholder">Area konten (iframe) di sini.</p>
        </div>
      </section>

      <!-- STATUS -->
      <div class="kt-statusbar">
        <div class="kt-status-msg" id="kt-status-msg">READY</div>
      </div>
    </div>
  </div>

  <!-- SUB MENU: fixed above bottom nav -->
  <nav class="kt-submenu-strip">
    <!-- 0. Markets (Indices dipindah ke samping Overview) -->
    <div class="kt-submenu-group active" data-menu-sub="0">
      <button class="kt-submenu-btn active" data-menu="0" data-sub-index="0">Overview</button>
      <button class="kt-submenu-btn" data-menu="0" data-sub-index="1">Indices</button>
      <button class="kt-submenu-btn" data-menu="0" data-sub-index="2">Forex</button>
      <button class="kt-submenu-btn" data-menu="0" data-sub-index="3">Commodities</button>
      <button class="kt-submenu-btn" data-menu="0" data-sub-index="4">Bonds</button>
      <button class="kt-submenu-btn" data-menu="0" data-sub-index="5">Stocks</button>
      <button class="kt-submenu-btn" data-menu="0" data-sub-index="6">Crypto</button>
      <button class="kt-submenu-btn" data-menu="0" data-sub-index="7">ETF</button>
    </div>

    <!-- 1. News (tambah Insights) -->
    <div class="kt-submenu-group" data-menu-sub="1">
      <button class="kt-submenu-btn" data-menu="1" data-sub-index="0">24/7 Feed</button>
      <button class="kt-submenu-btn" data-menu="1" data-sub-index="1">Global</button>
      <button class="kt-submenu-btn" data-menu="1" data-sub-index="2">Indonesia</button>
      <button class="kt-submenu-btn" data-menu="1" data-sub-index="3">Insights</button>
    </div>

    <!-- 2. Macroeconomic (Core Macro -> US Macro) -->
    <div class="kt-submenu-group" data-menu-sub="2">
      <button class="kt-submenu-btn" data-menu="2" data-sub-index="0">US Macro</button>
      <button class="kt-submenu-btn" data-menu="2" data-sub-index="1">Central Bank</button>
      <button class="kt-submenu-btn" data-menu="2" data-sub-index="2">Details</button>
    </div>

    <!-- 3. Geo-Economic (+Satellite, Sources -> Resources) -->
    <div class="kt-submenu-group" data-menu-sub="3">
      <button class="kt-submenu-btn" data-menu="3" data-sub-index="0">Trade &amp; Shipping</button>
      <button class="kt-submenu-btn" data-menu="3" data-sub-index="1">Supply Chain</button>
      <button class="kt-submenu-btn" data-menu="3" data-sub-index="2">Demographics</button>
      <button class="kt-submenu-btn" data-menu="3" data-sub-index="3">Resources</button>
      <button class="kt-submenu-btn" data-menu="3" data-sub-index="4">Satellite</button>
    </div>

    <!-- 4. Metrics (ordered) -->
    <div class="kt-submenu-group" data-menu-sub="4">
      <button class="kt-submenu-btn" data-menu="4" data-sub-index="0">Macro</button>
      <button class="kt-submenu-btn" data-menu="4" data-sub-index="1">Liquidity</button>
      <button class="kt-submenu-btn" data-menu="4" data-sub-index="2">Sentiment</button>
      <button class="kt-submenu-btn" data-menu="4" data-sub-index="3">Seasonality</button>
      <button class="kt-submenu-btn" data-menu="4" data-sub-index="4">COT</button>
      <button class="kt-submenu-btn" data-menu="4" data-sub-index="5">FI</button>
      <button class="kt-submenu-btn" data-menu="4" data-sub-index="6">Breadth</button>
      <button class="kt-submenu-btn" data-menu="4" data-sub-index="7">Flows</button>
      <button class="kt-submenu-btn" data-menu="4" data-sub-index="8">Volatility</button>
    </div>

    <!-- 5. Companies -->
    <div class="kt-submenu-group" data-menu-sub="5">
      <button class="kt-submenu-btn" data-menu="5" data-sub-index="0">United States</button>
      <button class="kt-submenu-btn" data-menu="5" data-sub-index="1">Indonesia</button>
      <button class="kt-submenu-btn" data-menu="5" data-sub-index="2">Blockchain Projects</button>
    </div>

    <!-- 6. Charts (Metric -> Economy) -->
    <div class="kt-submenu-group" data-menu-sub="6">
      <button class="kt-submenu-btn" data-menu="6" data-sub-index="0">Technical</button>
      <button class="kt-submenu-btn" data-menu="6" data-sub-index="1">Fundamental</button>
      <button class="kt-submenu-btn" data-menu="6" data-sub-index="2">Economy</button>
    </div>

    <!-- 7. Screener (Stocks -> US Stocks + ID Stocks) -->
    <div class="kt-submenu-group" data-menu-sub="7">
      <button class="kt-submenu-btn" data-menu="7" data-sub-index="0">US Stocks</button>
      <button class="kt-submenu-btn" data-menu="7" data-sub-index="1">ID Stocks</button>
      <button class="kt-submenu-btn" data-menu="7" data-sub-index="2">Crypto</button>
      <button class="kt-submenu-btn" data-menu="7" data-sub-index="3">Forex</button>
      <button class="kt-submenu-btn" data-menu="7" data-sub-index="4">Commodities</button>
    </div>

    <!-- 8. Research -->
    <div class="kt-submenu-group" data-menu-sub="8">
      <button class="kt-submenu-btn" data-menu="8" data-sub-index="0">Internal</button>
      <button class="kt-submenu-btn" data-menu="8" data-sub-index="1">Institutions</button>
      <button class="kt-submenu-btn" data-menu="8" data-sub-index="2">Articles</button>
      <button class="kt-submenu-btn" data-menu="8" data-sub-index="3">Reports</button>
    </div>

    <!-- 9. Tools (Journaling -> Journal; Others di kanan Notes) -->
    <div class="kt-submenu-group" data-menu-sub="9">
      <button class="kt-submenu-btn" data-menu="9" data-sub-index="0">Journal</button>
      <button class="kt-submenu-btn" data-menu="9" data-sub-index="1">Education</button>
      <button class="kt-submenu-btn" data-menu="9" data-sub-index="2">Notes</button>
      <button class="kt-submenu-btn" data-menu="9" data-sub-index="3">Others</button>
    </div>
  </nav>

  <!-- BOTTOM NAV -->
  <nav class="kt-bottom-nav">
    <div class="kt-bottom-item active" data-menu-bottom="0"><span>0</span><span>Markets</span></div>
    <div class="kt-bottom-item" data-menu-bottom="1"><span>1</span><span>News</span></div>
    <div class="kt-bottom-item" data-menu-bottom="2"><span>2</span><span>Macro</span></div>
    <div class="kt-bottom-item" data-menu-bottom="3"><span>3</span><span>Geo</span></div>
    <div class="kt-bottom-item" data-menu-bottom="4"><span>4</span><span>Metrics</span></div>
  </nav>

  <!-- AI FAB & PANEL -->
  <div class="kt-ai-fab" id="kt-ai-fab">AI</div>
  <div class="kt-ai-panel" id="kt-ai-panel">
    <div class="kt-ai-panel-header">
      <div class="kt-ai-panel-title">
        <span>Kuantara AI Assistant</span>
        <span>Prototype UI (belum backend).</span>
      </div>
      <div class="kt-ai-panel-close" id="kt-ai-close">✕</div>
    </div>
    <div class="kt-ai-panel-body">
      <div>Panel AI akan jelaskan data dari iframe nanti.</div>
    </div>
    <div class="kt-ai-footer">
      <button class="kt-ai-btn" disabled>History</button>
      <button class="kt-ai-btn primary" disabled>Ask AI</button>
    </div>
  </div>

  <!-- SEARCH OVERLAY -->
  <div class="kt-overlay" id="kt-search-ovl" aria-hidden="true">
    <div class="kt-card">
      <div class="kt-card-title">Search</div>
      <input id="kt-search-input" class="kt-search-input" type="text" placeholder="Cari menu/sub… (Enter untuk lompat, Esc tutup)" />
      <button class="kt-close-btn" id="kt-search-close">Close</button>
    </div>
  </div>

  <!-- PROFILE OVERLAY -->
  <div class="kt-overlay" id="kt-profile-ovl" aria-hidden="true">
    <div class="kt-card">
      <div class="kt-card-title">Profile</div>
      <div style="font-size:11px;color:var(--text-muted);line-height:1.5;">
        User: <span style="color:var(--amber);">Guest</span><br/>
        Status: <span style="color:var(--text-main);">Signed-out</span>
      </div>
      <button class="kt-close-btn" id="kt-profile-close">Close</button>
    </div>
  </div>

  <!-- CHEAT-SHEET TOAST -->
  <div class="kt-cheatsheet" id="kt-cheatsheet">
    <div><b>Alt+0–9</b> Menu · <b>Ctrl+1–9</b> Sub · <b>Esc</b>=Alt+0 · <b>Ctrl+F</b> Search · <b>Tab</b> Profile</div>
  </div>

  <script>
    (function () {
      const mainButtons = document.querySelectorAll(".kt-mainmenu-btn");
      const bottomItems = document.querySelectorAll(".kt-bottom-item");
      const submenuGroups = document.querySelectorAll(".kt-submenu-group");
      const submenuButtons = document.querySelectorAll(".kt-submenu-btn");

      const breadcrumbMain = document.getElementById("breadcrumb-main");
      const breadcrumbSub = document.getElementById("breadcrumb-sub");
      const statusMsg = document.getElementById("kt-status-msg");
      const sessionTimes = document.querySelectorAll(".kt-session-time");

      const aiFab = document.getElementById("kt-ai-fab");
      const aiPanel = document.getElementById("kt-ai-panel");
      const aiClose = document.getElementById("kt-ai-close");

      const searchOvl = document.getElementById("kt-search-ovl");
      const searchInput = document.getElementById("kt-search-input");
      const searchClose = document.getElementById("kt-search-close");

      const profileOvl = document.getElementById("kt-profile-ovl");
      const profileClose = document.getElementById("kt-profile-close");

      const cheats = document.getElementById("kt-cheatsheet");

      const contentBody = document.getElementById("kt-content-body");
      const embedWrap = document.getElementById("kt-embed-wrap");
      const placeholder = document.getElementById("kt-placeholder");

      let activeMenu = 0;

      /* Map menu:sub -> iframe URL */
      const IFRAME_MAP = {
        // News > Global
        "1:1": "https://44e53ad6-8cf6-4090-9e60-c9e985282fe0.filesusr.com/html/5e69ae_59c85b29326635aadaac1f2286d8f292.html",
        // Contoh:
        // "0:1": "https://your-indices-dashboard.example",     // Markets > Indices
        // "1:3": "https://your-news-insights.example",          // News > Insights
        // "2:0": "https://your-us-macro-dash.example",          // Macroeconomic > US Macro
        // "3:4": "https://your-satellite-geo-dash.example",     // Geo-Economic > Satellite
        // "6:2": "https://your-economy-charts.example",         // Charts > Economy
        // "7:1": "https://your-id-stocks-screener.example",     // Screener > ID Stocks
        // "9:2": "https://your-notes-app.example"               // Tools > Notes
      };

      function renderContent(menuIndex, subIndex) {
        const key = menuIndex + ":" + subIndex;
        const url = IFRAME_MAP[key];
        if (url) {
          placeholder.style.display = "none";
          embedWrap.style.display = "flex";
          embedWrap.innerHTML = '<iframe class="kt-embed" loading="lazy" src="' + url + '"></iframe>';
          statusMsg.textContent = "EMBED: " + url;
        } else {
          embedWrap.style.display = "none";
          embedWrap.innerHTML = "";
          placeholder.style.display = "block";
          statusMsg.textContent = "READY";
        }
      }

      function setActiveMenu(menuIndex) {
        activeMenu = menuIndex;

        // main buttons
        mainButtons.forEach(btn => {
          btn.classList.toggle("active", Number(btn.getAttribute("data-menu")) === menuIndex);
        });

        // bottom nav
        bottomItems.forEach(item => {
          item.classList.toggle("active", Number(item.getAttribute("data-menu-bottom")) === menuIndex);
        });

        // submenu group
        submenuGroups.forEach(group => {
          group.classList.toggle("active", Number(group.getAttribute("data-menu-sub")) === menuIndex);
        });

        // breadcrumb main
        const activeMain = document.querySelector('.kt-mainmenu-btn[data-menu="' + menuIndex + '"] span:nth-child(2)');
        if (activeMain) breadcrumbMain.textContent = menuIndex + " · " + activeMain.textContent.trim();

        // default sub index 0 if exists
        const firstSub = document.querySelector('.kt-submenu-btn[data-menu="' + menuIndex + '"][data-sub-index="0"]');
        if (firstSub) {
          setActiveSub(menuIndex, 0);
        } else {
          breadcrumbSub.textContent = "";
          renderContent(menuIndex, -1);
        }

        statusMsg.textContent = "ACTIVE MENU: " + menuIndex;
      }

      function setActiveSub(menuIndex, subIndex) {
        submenuButtons.forEach(btn => {
          const m = Number(btn.getAttribute("data-menu"));
          const s = Number(btn.getAttribute("data-sub-index"));
          btn.classList.toggle("active", m === menuIndex && s === subIndex);
        });

        const sub = document.querySelector('.kt-submenu-btn[data-menu="' + menuIndex + '"][data-sub-index="' + subIndex + '"]');
        if (sub) {
          breadcrumbSub.textContent = sub.textContent.trim();
          statusMsg.textContent = "ACTIVE: " + menuIndex + " · " + breadcrumbSub.textContent;
        } else {
          breadcrumbSub.textContent = "";
          statusMsg.textContent = "ACTIVE MENU: " + menuIndex + " · (no sub)";
        }

        renderContent(menuIndex, subIndex);
      }

      // Build searchable index from DOM (menu + submenu)
      function buildSearchIndex() {
        const index = [];

        // main menus
        document.querySelectorAll(".kt-mainmenu-btn").forEach(btn => {
          const menuIdx = Number(btn.getAttribute("data-menu"));
          const name = btn.querySelector("span:nth-child(2)")?.textContent?.trim() || "";
          index.push({ label: name, menu: menuIdx, sub: null, type: "menu" });
        });

        // submenus
        document.querySelectorAll(".kt-submenu-btn").forEach(btn => {
          const menuIdx = Number(btn.getAttribute("data-menu"));
          const subIdx  = Number(btn.getAttribute("data-sub-index"));
          const name    = btn.textContent.trim();
          index.push({ label: name, menu: menuIdx, sub: subIdx, type: "sub" });
        });

        return index;
      }

      // Find best match: exact -> startsWith -> includes
      function findBestMatch(index, query) {
        const q = query.toLowerCase();

        const exact = index.find(it => it.label.toLowerCase() === q);
        if (exact) return exact;

        const starts = index.find(it => it.label.toLowerCase().startsWith(q));
        if (starts) return starts;

        return index.find(it => it.label.toLowerCase().includes(q)) || null;
      }

      // Click handlers
      mainButtons.forEach(btn => btn.addEventListener("click", () => setActiveMenu(Number(btn.getAttribute("data-menu")))));
      bottomItems.forEach(item => item.addEventListener("click", () => setActiveMenu(Number(item.getAttribute("data-menu-bottom")))));
      submenuButtons.forEach(btn => btn.addEventListener("click", () => setActiveSub(Number(btn.getAttribute("data-menu")), Number(btn.getAttribute("data-sub-index")))));

      // AI panel
      function toggleAiPanel(force) {
        const isOpen = aiPanel.style.display === "flex";
        const next = typeof force === "boolean" ? force : !isOpen;
        aiPanel.style.display = next ? "flex" : "none";
      }
      aiFab.addEventListener("click", () => toggleAiPanel());
      aiClose.addEventListener("click", () => toggleAiPanel(false));

      // Market clocks
      function pad2(n) { return n < 10 ? "0" + n : "" + n; }
      function updateSessions() {
        const now = new Date();
        const utc = Date.UTC(now.getUTCFullYear(), now.getUTCMonth(), now.getUTCDate(), now.getUTCHours(), now.getUTCMinutes(), now.getUTCSeconds());
        sessionTimes.forEach(el => {
          const offset = Number(el.getAttribute("data-tz")) || 0;
          const localMs = utc + offset * 60 * 60 * 1000;
          const d = new Date(localMs);
          el.textContent = pad2(d.getUTCHours()) + ":" + pad2(d.getUTCMinutes());
        });
      }
      updateSessions();
      setInterval(updateSessions, 1000);

      // Overlays
      function openOverlay(el) { el.style.display = "flex"; }
      function closeOverlay(el) { el.style.display = "none"; }

      // Search (Ctrl+F to open)
      let searchIndex = buildSearchIndex();

      function openSearch() {
        // refresh index setiap buka (kalau ada perubahan dinamis)
        searchIndex = buildSearchIndex();
        openOverlay(searchOvl);
        setTimeout(() => searchInput.focus(), 10);
        statusMsg.textContent = "SEARCH: active";
      }
      function closeSearch() { closeOverlay(searchOvl); statusMsg.textContent = "SEARCH: closed"; }

      searchClose.addEventListener("click", closeSearch);
      searchOvl.addEventListener("click", (e) => { if (e.target === searchOvl) closeSearch(); });

      searchInput.addEventListener("keydown", (e) => {
        if (e.key === "Escape") { e.preventDefault(); closeSearch(); return; }
        if (e.key === "Enter") {
          e.preventDefault();
          const q = (searchInput.value || "").trim();
          if (!q) { statusMsg.textContent = "SEARCH: empty"; closeSearch(); return; }

          const match = findBestMatch(searchIndex, q);
          if (match) {
            if (match.sub === null) {
              setActiveMenu(match.menu);
            } else {
              setActiveMenu(match.menu);
              setActiveSub(match.menu, match.sub);
            }
            statusMsg.textContent = `SEARCH goto: ${match.label} (${match.type === "menu" ? "Menu" : "Sub"})`;
          } else {
            statusMsg.textContent = `SEARCH: "${q}" not found`;
          }
          closeSearch();
        }
      });

      // Keyboard shortcuts
      window.addEventListener("keydown", (e) => {
        // Ctrl + F -> Search
        if (e.ctrlKey && (e.key === "f" || e.key === "F")) { e.preventDefault(); openSearch(); return; }

        // Alt + 0..9 -> Menu
        if (e.altKey && !e.ctrlKey && !e.shiftKey) {
          const k = e.key;
          if (k >= "0" && k <= "9") { e.preventDefault(); setActiveMenu(Number(k)); return; }
        }

        // Ctrl + 1..9 -> Submenu for current menu (maps to subIndex 0..8)
        if (e.ctrlKey && !e.altKey) {
          const k = e.key;
          if (k >= "1" && k <= "9") { e.preventDefault(); setActiveSub(activeMenu, Number(k) - 1); return; }
        }

        // Esc -> go Markets
        if (e.key === "Escape") { e.preventDefault(); setActiveMenu(0); return; }

        // Tab -> Profile
        if (e.key === "Tab") { e.preventDefault(); openOverlay(profileOvl); statusMsg.textContent = "PROFILE: opened"; return; }

        // Shift -> cheat sheet
        if (e.key === "Shift" && !e.repeat && !e.ctrlKey && !e.altKey) {
          cheats.style.display = "block";
          setTimeout(() => { cheats.style.display = "none"; }, 2000);
          return;
        }
      });

      // Initial state
      setActiveMenu(0);
    })();
  </script>
</body>
</html>
