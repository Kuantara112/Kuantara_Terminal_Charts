<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Kuantara Terminal</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500;600;700&display=swap"/>

  <style>
    :root {
      /* Color Palette - Modern Cyberpunk/Fintech */
      --amber: #ffbf00;
      --amber-glow: rgba(255, 191, 0, 0.3);
      --amber-dim: rgba(255, 191, 0, 0.1);
      
      --bg-root: #050505;
      --bg-glass: rgba(10, 10, 10, 0.65);
      --bg-glass-strong: rgba(5, 5, 5, 0.85);
      --bg-panel: rgba(20, 20, 20, 0.6);
      
      --border-glass: rgba(255, 255, 255, 0.08);
      --border-active: rgba(255, 191, 0, 0.5);
      
      --text-main: #e0e0e0;
      --text-muted: #888888;
      
      --shadow-glass: 0 8px 32px 0 rgba(0, 0, 0, 0.5);
      
      /* Transitions */
      --ease-elastic: cubic-bezier(0.175, 0.885, 0.32, 1.275);
      --ease-smooth: cubic-bezier(0.4, 0, 0.2, 1);
    }

    /* GLOBAL RESET */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: "Fira Code", monospace !important;
      scrollbar-width: thin;
      scrollbar-color: var(--border-glass) transparent;
      -webkit-tap-highlight-color: transparent;
    }

    /* Modern Scrollbar */
    ::-webkit-scrollbar { width: 4px; height: 4px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: #333; border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: var(--amber); }

    html, body { height: 100%; }

    body {
      background-color: var(--bg-root);
      background-image: radial-gradient(circle at 50% 0%, #1a1200 0%, #050505 60%);
      color: var(--text-main);
      overflow: hidden;
    }

    @media (max-width: 768px) {
      body { overflow: auto; -webkit-overflow-scrolling: touch; }
    }

    .kt-root { display: flex; flex-direction: column; height: 100vh; position: relative; }

    /* ===== ANIMATIONS ===== */
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    @keyframes popIn { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }
    @keyframes pulseGlow { 0% { box-shadow: 0 0 0 0 var(--amber-glow); } 70% { box-shadow: 0 0 0 6px rgba(0,0,0,0); } 100% { box-shadow: 0 0 0 0 rgba(0,0,0,0); } }

    /* ===== IFRAME LAYER ===== */
    .kt-iframe-layer {
      position: fixed;
      left: 0; right: 0; top: 38px; bottom: 46px;
      z-index: 1;
      background: #000;
      transition: top 0.4s var(--ease-smooth), bottom 0.4s var(--ease-smooth);
    }
    .kt-iframe-layer iframe { width: 100%; height: 100%; border: 0; display: block; background: #000; }

    /* ===== PINNED MODE ===== */
    body.kt-pinned .kt-mainmenu-strip,
    body.kt-pinned .kt-content-header,
    body.kt-pinned .kt-statusbar,
    body.kt-pinned .kt-submenu-strip {
      transform: translateY(0) !important;
      opacity: 1 !important;
      pointer-events: auto !important;
    }
    body.kt-pinned .kt-iframe-layer { top: 108px; bottom: 112px; }
    body.kt-pinned .kt-submenu-strip { bottom: 46px !important; }
    body.kt-pinned .kt-statusbar { bottom: 80px !important; border-top: 1px solid var(--border-glass); background: var(--bg-root); }

    /* ===== GLASS UI COMPONENTS ===== */
    .kt-glass {
      background: var(--bg-glass);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border: 1px solid var(--border-glass);
    }

    /* ===== TOP BAR ===== */
    .kt-topbar {
      position: fixed; top: 0; left: 0; right: 0;
      display: flex; align-items: center; justify-content: center;
      padding: 8px 12px; font-size: 10px; z-index: 3000;
      background: var(--bg-glass-strong);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--border-glass);
      user-select: none;
      box-shadow: 0 2px 10px rgba(0,0,0,0.2);
    }
    .kt-topbar-left { display: flex; align-items: center; gap: 10px; }
    
    .kt-logo {
      font-weight: 700; letter-spacing: 0.1em; text-transform: uppercase;
      font-size: 14px; color: var(--amber); cursor: pointer;
      text-shadow: 0 0 10px var(--amber-glow);
      transition: text-shadow 0.3s ease;
    }
    .kt-logo:hover { text-shadow: 0 0 20px var(--amber); }

    .kt-session-clock { display: flex; gap: 6px; color: var(--text-muted); cursor: pointer; }
    .kt-session-item {
      display: inline-flex; gap: 3px; padding: 2px 6px;
      border-radius: 4px; background: rgba(255,255,255,0.03);
      border: 1px solid transparent;
      transition: all 0.3s ease;
    }
    .kt-session-item:hover { border-color: var(--border-glass); background: rgba(255,255,255,0.07); }
    .kt-session-label { color: var(--amber); font-weight: 600; font-size: 9px; }

    /* ===== MENU STRIPS (Top & Bottom) ===== */
    .kt-mainmenu-strip, .kt-content-header, .kt-statusbar, .kt-submenu-strip {
      position: fixed; z-index: 2800;
      transition: transform 0.4s var(--ease-smooth), opacity 0.3s ease, bottom 0.4s ease;
    }

    /* Main Menu */
    .kt-mainmenu-strip {
      top: 38px; left: 0; right: 0;
      display: flex; gap: 6px; padding: 8px 12px;
      background: var(--bg-glass);
      backdrop-filter: blur(16px);
      border-bottom: 1px solid var(--border-glass);
      overflow-x: auto; justify-content: center;
    }
    .kt-hide-top { transform: translateY(-120%); opacity: 0; pointer-events: none; }

    .kt-mainmenu-btn {
      padding: 6px 12px; border-radius: 6px; border: 1px solid transparent;
      background: rgba(255,255,255,0.03); color: var(--text-muted);
      font-size: 11px; display: inline-flex; align-items: center; gap: 6px;
      cursor: pointer; transition: all 0.2s ease;
    }
    .kt-mainmenu-btn span:first-child { color: var(--amber); font-weight: 600; opacity: 0.8; }
    .kt-mainmenu-btn:hover { background: rgba(255,255,255,0.08); transform: translateY(-1px); box-shadow: 0 2px 8px rgba(0,0,0,0.3); }
    .kt-mainmenu-btn:active { transform: scale(0.96); }
    .kt-mainmenu-btn.active {
      background: var(--amber-dim); border-color: var(--amber-glow);
      color: #fff; box-shadow: 0 0 15px var(--amber-dim);
    }
    .kt-mainmenu-btn.active span:first-child { color: var(--amber); opacity: 1; }

    /* Content Header */
    .kt-content-header {
      top: 82px; left: 0; right: 0;
      border-bottom: 1px solid var(--border-glass);
      padding: 6px 12px; display: flex; align-items: center;
      background: rgba(5, 5, 5, 0.7); backdrop-filter: blur(8px);
    }
    .kt-breadcrumb { display: flex; gap: 8px; align-items: baseline; }
    .kt-breadcrumb-main { color: var(--amber); font-weight: 600; text-shadow: 0 0 5px var(--amber-dim); }
    .kt-breadcrumb-sub { color: var(--text-muted); font-size: 10px; letter-spacing: 0.05em; text-transform: uppercase; }

    /* Sub Menu */
    .kt-submenu-strip {
      bottom: 46px; left: 0; right: 0;
      background: rgba(10, 10, 10, 0.85);
      backdrop-filter: blur(16px);
      border-top: 1px solid var(--border-glass);
      padding: 6px 0; min-height: 36px;
    }
    .kt-submenu-group { display: none; gap: 6px; overflow-x: auto; padding: 0 12px; }
    .kt-submenu-group.active { display: flex; justify-content: center; }
    
    .kt-submenu-btn {
      padding: 4px 10px; border-radius: 4px; border: 1px solid transparent;
      background: transparent; color: var(--text-muted); font-size: 10px;
      cursor: pointer; transition: all 0.2s ease;
    }
    .kt-submenu-btn:hover { color: var(--text-main); background: rgba(255,255,255,0.05); }
    .kt-submenu-btn.active {
      background: var(--amber); color: #000; font-weight: 600;
      box-shadow: 0 0 10px var(--amber-glow);
    }

    /* Status Bar */
    .kt-statusbar {
      bottom: 46px; left: 0; right: 0;
      background: rgba(0,0,0,0.6); backdrop-filter: blur(5px);
      border-top: 1px solid var(--border-glass);
      padding: 4px 12px; color: #666;
    }
    .kt-hide-bottom { transform: translateY(120%); opacity: 0; pointer-events: none; }

    /* ===== BOTTOM NAV ===== */
    .kt-bottom-nav {
      position: fixed; left: 0; right: 0; bottom: 0; height: 46px;
      background: var(--bg-glass-strong); backdrop-filter: blur(20px);
      border-top: 1px solid var(--border-glass);
      display: flex; justify-content: space-around; align-items: center;
      z-index: 2800;
    }
    .kt-bottom-item {
      flex: 1; height: 100%; display: flex; flex-direction: column;
      align-items: center; justify-content: center; gap: 4px;
      color: var(--text-muted); cursor: pointer; transition: all 0.3s ease;
      position: relative; overflow: hidden;
    }
    .kt-bottom-item:hover { color: var(--text-main); background: rgba(255,255,255,0.02); }
    .kt-bottom-item.active { color: var(--amber); }
    .kt-bottom-item.active::after {
      content: ''; position: absolute; bottom: 0; width: 40px; height: 2px;
      background: var(--amber); box-shadow: 0 0 8px var(--amber);
      animation: slideUp 0.3s ease;
    }

    /* ===== PAGES (PROFILE & WORKSPACE) - MODAL STYLE ===== */
    .kt-profile-page, .kt-workspace-page {
      position: fixed; inset: 38px 0 46px 0; z-index: 2000;
      display: none; overflow: auto;
      background: rgba(5, 5, 5, 0.95);
      backdrop-filter: blur(5px);
      animation: fadeIn 0.3s ease;
    }
    
    .kt-profile-inner {
      max-width: 700px; margin: 20px auto;
      background: var(--bg-panel);
      backdrop-filter: blur(20px);
      border: 1px solid var(--border-glass);
      border-radius: 16px; padding: 24px;
      box-shadow: var(--shadow-glass);
      animation: slideUp 0.4s var(--ease-elastic);
    }
    .kt-profile-header { display: flex; justify-content: space-between; margin-bottom: 20px; border-bottom: 1px solid var(--border-glass); padding-bottom: 15px; }
    .kt-profile-title { font-size: 14px; color: var(--amber); letter-spacing: 1px; margin-bottom: 4px; }
    .kt-profile-name { font-size: 18px; font-weight: 700; color: #fff; }
    
    .kt-badge {
      background: rgba(255, 191, 0, 0.1); border: 1px solid var(--amber); color: var(--amber);
      padding: 4px 10px; border-radius: 20px; font-size: 10px; font-weight: 600;
      box-shadow: 0 0 10px var(--amber-dim);
    }

    .kt-profile-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px; }
    .kt-profile-card {
      background: rgba(255,255,255,0.03); border: 1px solid var(--border-glass);
      border-radius: 10px; padding: 12px; transition: transform 0.2s ease;
    }
    .kt-profile-card:hover { transform: translateY(-2px); background: rgba(255,255,255,0.05); border-color: rgba(255,255,255,0.1); }
    .kt-profile-card-title { color: var(--amber); font-size: 11px; margin-bottom: 6px; font-weight: 600; }
    .kt-profile-card-body { font-size: 11px; color: #ccc; line-height: 1.6; }

    .kt-profile-menu-btn {
      padding: 8px 16px; border-radius: 20px; border: 1px solid var(--border-glass);
      background: rgba(0,0,0,0.4); color: #eee; cursor: pointer; transition: 0.2s;
    }
    .kt-profile-menu-btn:hover { background: var(--amber); color: #000; border-color: var(--amber); }

    /* Workspace */
    .kt-workspace-board { background: radial-gradient(circle at center, #111 0%, #000 100%); }
    .kt-workspace-toolbar { padding: 10px; }
    .kt-workspace-btn {
      padding: 6px 14px; border-radius: 20px; border: 1px solid var(--border-glass);
      background: rgba(20,20,20,0.8); color: #fff; cursor: pointer;
      backdrop-filter: blur(4px); transition: 0.2s;
    }
    .kt-workspace-btn:hover { background: var(--amber); color: #000; box-shadow: 0 0 12px var(--amber-glow); border-color: var(--amber); }
    .kt-workspace-btn.secondary:hover { background: #333; color: #fff; box-shadow: none; border-color: #555; }

    .kt-workspace-window {
      background: rgba(15, 15, 15, 0.9);
      border: 1px solid var(--border-active);
      border-radius: 8px; box-shadow: 0 10px 40px rgba(0,0,0,0.8);
      animation: popIn 0.3s var(--ease-elastic);
    }
    .kt-workspace-window-header {
      background: linear-gradient(90deg, rgba(30,30,30,1) 0%, rgba(10,10,10,1) 100%);
      border-bottom: 1px solid #333; padding: 0 10px;
    }
    .kt-workspace-window-title { font-weight: 600; color: var(--amber); }

    /* ===== FLOATING FAB & PANEL ===== */
    .kt-ai-fab {
      position: fixed; right: 20px; bottom: 90px;
      width: 50px; height: 50px; border-radius: 50%;
      background: var(--amber); color: #000;
      display: flex; align-items: center; justify-content: center;
      font-size: 18px; font-weight: bold;
      box-shadow: 0 0 20px var(--amber-glow);
      cursor: pointer; z-index: 3000; border: 2px solid #fff;
      transition: transform 0.3s var(--ease-elastic);
      animation: pulseGlow 3s infinite;
    }
    .kt-ai-fab:hover { transform: scale(1.1) rotate(90deg); }
    .kt-ai-fab:active { transform: scale(0.95); }

    .kt-ai-menu { display: none; flex-direction: column; gap: 10px; animation: slideUp 0.3s var(--ease-elastic); }
    .kt-ai-menu-btn {
      padding: 8px 14px; border-radius: 30px; border: 1px solid var(--border-glass);
      background: rgba(10,10,10,0.8); backdrop-filter: blur(10px);
      color: #ccc; box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      transform-origin: right center; transition: 0.2s;
    }
    .kt-ai-menu-btn:hover { transform: scale(1.05) translateX(-5px); background: #222; border-color: var(--amber); color: #fff; }
    
    .kt-ai-panel {
      background: rgba(15, 15, 15, 0.85);
      backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
      border: 1px solid var(--border-glass);
      box-shadow: var(--shadow-glass);
      border-radius: 16px;
      animation: popIn 0.3s var(--ease-elastic);
    }
    .kt-ai-panel-header { padding: 0; height: 0; }
    .kt-ai-panel-close {
      background: rgba(0,0,0,0.5); border: 1px solid #444; color: #fff;
      transition: 0.2s;
    }
    .kt-ai-panel-close:hover { background: var(--amber); color: #000; border-color: var(--amber); }

    /* ===== OVERLAY / SEARCH ===== */
    .kt-overlay {
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(5px);
      animation: fadeIn 0.2s ease;
    }
    .kt-card {
      background: #111; border: 1px solid var(--border-active);
      box-shadow: 0 0 30px rgba(255, 191, 0, 0.15);
      animation: popIn 0.3s var(--ease-elastic);
    }
    .kt-search-input {
      background: #050505; border: 1px solid #333; color: #fff;
      transition: border 0.3s;
    }
    .kt-search-input:focus { border-color: var(--amber); box-shadow: 0 0 8px var(--amber-dim); }
    .kt-close-btn:hover { background: #333; color: #fff; }

    .kt-cheatsheet {
      background: rgba(0,0,0,0.8); backdrop-filter: blur(8px); border: 1px solid var(--amber-dim);
      border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    }

    /* Desktop Tweaks */
    @media (min-width: 900px) {
      .kt-submenu-strip { justify-content: center; }
      .kt-submenu-group { max-width: 1000px; }
    }
  </style>
</head>
<body>
  <div class="kt-root">
    <div class="kt-iframe-layer" id="kt-iframe-layer"></div>

    <header class="kt-topbar" id="kt-topbar" title="Double click to Pin/Unpin interface">
      <div class="kt-topbar-left">
        <div class="kt-logo">KUANTARA TERMINAL</div>
        <div class="kt-session-clock" id="kt-session-clock">
          <div class="kt-session-item"><span class="kt-session-label">SYD</span><span class="kt-session-time" data-tz="10"></span></div>
          <div class="kt-session-item"><span class="kt-session-label">TYO</span><span class="kt-session-time" data-tz="9"></span></div>
          <div class="kt-session-item"><span class="kt-session-label">LDN</span><span class="kt-session-time" data-tz="0"></span></div>
          <div class="kt-session-item"><span class="kt-session-label">NYC</span><span class="kt-session-time" data-tz="-5"></span></div>
        </div>
      </div>
    </header>

    <nav class="kt-mainmenu-strip kt-hide-top" id="kt-mainmenu-strip">
      <button class="kt-mainmenu-btn active" data-menu="0"><span>0</span><span>Markets</span></button>
      <button class="kt-mainmenu-btn" data-menu="1"><span>1</span><span>News</span></button>
      <button class="kt-mainmenu-btn" data-menu="2"><span>2</span><span>Macroeconomic</span></button>
      <button class="kt-mainmenu-btn" data-menu="3"><span>3</span><span>Geo-Economic</span></button>
      <button class="kt-mainmenu-btn" data-menu="4"><span>4</span><span>Metrics</span></button>
      <button class="kt-mainmenu-btn" data-menu="5"><span>5</span><span>Companies</span></button>
      <button class="kt-mainmenu-btn" data-menu="6"><span>6</span><span>Charts</span></button>
      <button class="kt-mainmenu-btn" data-menu="7"><span>7</span><span>Screener</span></button>
      <button class="kt-mainmenu-btn" data-menu="8"><span>8</span><span>Research</span></button>
      <button class="kt-mainmenu-btn" data-menu="9"><span>9</span><span>Tools</span></button>
    </nav>

    <section class="kt-content">
      <div class="kt-content-header kt-hide-top" id="kt-content-header">
        <div class="kt-breadcrumb">
          <span class="kt-breadcrumb-main" id="breadcrumb-main">0 · Markets</span>
          <span class="kt-breadcrumb-sub" id="breadcrumb-sub">Overview</span>
        </div>
      </div>
    </section>

    <div class="kt-statusbar kt-hide-bottom" id="kt-statusbar">
      <div class="kt-status-msg" id="kt-status-msg">READY</div>
    </div>
  </div>

  <nav class="kt-submenu-strip kt-hide-bottom" id="kt-submenu-strip">
    <div class="kt-submenu-group active" data-menu-sub="0">
      <button class="kt-submenu-btn active" data-menu="0" data-sub-index="0">Overview</button>
      <button class="kt-submenu-btn" data-menu="0" data-sub-index="1">Forex</button>
      <button class="kt-submenu-btn" data-menu="0" data-sub-index="2">Fixed</button>
      <button class="kt-submenu-btn" data-menu="0" data-sub-index="3">Commodities</button>
      <button class="kt-submenu-btn" data-menu="0" data-sub-index="4">Equities</button>
      <button class="kt-submenu-btn" data-menu="0" data-sub-index="5">Crypto</button>
    </div>

    <div class="kt-submenu-group" data-menu-sub="1">
      <button class="kt-submenu-btn" data-menu="1" data-sub-index="0">24/7</button>
      <button class="kt-submenu-btn" data-menu="1" data-sub-index="1">Insights</button>
      <button class="kt-submenu-btn" data-menu="1" data-sub-index="2">Calendar</button>
      <button class="kt-submenu-btn" data-menu="1" data-sub-index="3">Global</button>
      <button class="kt-submenu-btn" data-menu="1" data-sub-index="4">Channel</button>
      <button class="kt-submenu-btn" data-menu="1" data-sub-index="5">Indonesia</button>
    </div>

    <div class="kt-submenu-group" data-menu-sub="2">
      <button class="kt-submenu-btn" data-menu="2" data-sub-index="0">US Macro</button>
      <button class="kt-submenu-btn" data-menu="2" data-sub-index="1">Major Country</button>
      <button class="kt-submenu-btn" data-menu="2" data-sub-index="2">Central Bank</button>
      <button class="kt-submenu-btn" data-menu="2" data-sub-index="3">Details</button>
    </div>

    <div class="kt-submenu-group" data-menu-sub="3">
      <button class="kt-submenu-btn" data-menu="3" data-sub-index="0">Trade &amp; Shipping</button>
      <button class="kt-submenu-btn" data-menu="3" data-sub-index="1">Supply Chain</button>
      <button class="kt-submenu-btn" data-menu="3" data-sub-index="2">Demographics</button>
      <button class="kt-submenu-btn" data-menu="3" data-sub-index="3">Resources</button>
      <button class="kt-submenu-btn" data-menu="3" data-sub-index="4">Satellite</button>
    </div>

    <div class="kt-submenu-group" data-menu-sub="4">
      <button class="kt-submenu-btn" data-menu="4" data-sub-index="0">Macro</button>
      <button class="kt-submenu-btn" data-menu="4" data-sub-index="1">Liquidity</button>
      <button class="kt-submenu-btn" data-menu="4" data-sub-index="2">Sentiment</button>
      <button class="kt-submenu-btn" data-menu="4" data-sub-index="3">Seasonality</button>
      <button class="kt-submenu-btn" data-menu="4" data-sub-index="4">COT</button>
      <button class="kt-submenu-btn" data-menu="4" data-sub-index="5">Curve</button>
      <button class="kt-submenu-btn" data-menu="4" data-sub-index="6">Breadth</button>
      <button class="kt-submenu-btn" data-menu="4" data-sub-index="7">Flows</button>
      <button class="kt-submenu-btn" data-menu="4" data-sub-index="8">Volatility</button>
    </div>

    <div class="kt-submenu-group" data-menu-sub="5">
      <button class="kt-submenu-btn" data-menu="5" data-sub-index="0">United States</button>
      <button class="kt-submenu-btn" data-menu="5" data-sub-index="1">Indonesia</button>
      <button class="kt-submenu-btn" data-menu="5" data-sub-index="2">Blockchain Projects</button>
    </div>

    <div class="kt-submenu-group" data-menu-sub="6">
      <button class="kt-submenu-btn" data-menu="6" data-sub-index="0">Technical</button>
      <button class="kt-submenu-btn" data-menu="6" data-sub-index="1">Fundamental</button>
      <button class="kt-submenu-btn" data-menu="6" data-sub-index="2">Economy</button>
    </div>

    <div class="kt-submenu-group" data-menu-sub="7">
      <button class="kt-submenu-btn" data-menu="7" data-sub-index="0">US Stocks</button>
      <button class="kt-submenu-btn" data-menu="7" data-sub-index="1">ID Stocks</button>
      <button class="kt-submenu-btn" data-menu="7" data-sub-index="2">Crypto</button>
      <button class="kt-submenu-btn" data-menu="7" data-sub-index="3">Custom</button>
    </div>

    <div class="kt-submenu-group" data-menu-sub="8">
      <button class="kt-submenu-btn" data-menu="8" data-sub-index="0">Internal</button>
      <button class="kt-submenu-btn" data-menu="8" data-sub-index="1">Institutions</button>
      <button class="kt-submenu-btn" data-menu="8" data-sub-index="2">Reports</button>
    </div>

    <div class="kt-submenu-group" data-menu-sub="9">
      <button class="kt-submenu-btn" data-menu="9" data-sub-index="0">Journal</button>
      <button class="kt-submenu-btn" data-menu="9" data-sub-index="1">Education</button>
      <button class="kt-submenu-btn" data-menu="9" data-sub-index="2">Notes</button>
      <button class="kt-submenu-btn" data-menu="9" data-sub-index="3">Quantitative</button>
      <button class="kt-submenu-btn" data-menu="9" data-sub-index="4">Calculator</button>
      <button class="kt-submenu-btn" data-menu="9" data-sub-index="5">Others</button>
    </div>
  </nav>

  <div class="kt-profile-page" id="kt-profile-page">
    <div class="kt-profile-inner">
      <div class="kt-profile-header">
        <div>
          <div class="kt-profile-title">User Profile</div>
          <div class="kt-profile-name">Guest User</div>
          <div class="kt-profile-meta">
            Kuantara Terminal · Single-seat license<br/>
            Last login: —
          </div>
        </div>
        <div>
          <span class="kt-badge">ACTIVE PLAN</span>
        </div>
      </div>

      <div class="kt-profile-grid">
        <div class="kt-profile-card">
          <div class="kt-profile-card-title">Account</div>
          <div class="kt-profile-card-body">
            Name : Guest User<br/>
            Email: guest@example.com<br/>
            Role : Retail Trader / Analyst
          </div>
        </div>

        <div class="kt-profile-card">
          <div class="kt-profile-card-title">Subscription</div>
          <div class="kt-profile-card-body">
            Plan          : Kuantara Terminal Standard<br/>
            Status        : Trial<br/>
            Time Left     : 7 days<br/>
            Renewal Mode  : Manual
          </div>
        </div>

        <div class="kt-profile-card">
          <div class="kt-profile-card-title">Contact & Support</div>
          <div class="kt-profile-card-body">
            Telegram : @kuantara<br/>
            Email    : support@kuantara.com<br/>
            Priority : Standard
          </div>
        </div>

        <div class="kt-profile-card">
          <div class="kt-profile-card-title">Usage Snapshot</div>
          <div class="kt-profile-card-body">
            Terminals Active : 1 / 2<br/>
            Last 24h Logins : 3<br/>
            Most Used Page  : Markets · Overview
          </div>
        </div>
      </div>

      <div class="kt-profile-menu">
        <button class="kt-profile-menu-btn">Settings</button>
        <button class="kt-profile-menu-btn">Notifications</button>
        <button class="kt-profile-menu-btn">Store</button>
      </div>

      <div class="kt-profile-footer">
        Developed by Kuantara Analytics · Informasi di dalam terminal ini bersifat edukatif dan bukan merupakan saran investasi atau ajakan untuk melakukan transaksi finansial.
      </div>
    </div>
  </div>

  <div class="kt-workspace-page" id="kt-workspace-page">
    <div class="kt-workspace-toolbar">
      <button class="kt-workspace-btn" id="kt-workspace-add-current">Add current view</button>
      <button class="kt-workspace-btn secondary" id="kt-workspace-clear">Clear workspace</button>
    </div>
    <div class="kt-workspace-board" id="kt-workspace-board">
      <div class="kt-workspace-placeholder">
        Belum ada window di Workspace.<br>
        Pergi ke Home, pilih view yang kamu suka, lalu klik <b>Add current view</b>.
      </div>
    </div>
  </div>

  <nav class="kt-bottom-nav" id="kt-bottom-nav">
    <div class="kt-bottom-item active" data-bottom-role="home">
      <span>Home</span>
    </div>
    <div class="kt-bottom-item" data-bottom-role="workspace">
      <span>Workspace</span>
    </div>
    <div class="kt-bottom-item" data-bottom-role="profile">
      <span>Profile</span>
    </div>
  </nav>

  <div class="kt-ai-fab" id="kt-ai-fab">≡</div>

  <div class="kt-ai-menu" id="kt-ai-menu">
    <button class="kt-ai-menu-btn" data-pane="ai"><span>AI</span><span>Kuantara AI</span></button>
    <button class="kt-ai-menu-btn" data-pane="mini"><span>MC</span><span>Mini Chart</span></button>
    <button class="kt-ai-menu-btn" data-pane="notes"><span>NT</span><span>Notes</span></button>
    <button class="kt-ai-menu-btn" data-pane="signals"><span>SG</span><span>Signals</span></button>
    <button class="kt-ai-menu-btn" data-pane="group"><span>GC</span><span>Group Chat</span></button>
  </div>

  <div class="kt-ai-panel" id="kt-ai-panel">
    <div class="kt-ai-panel-header">
      <div class="kt-ai-panel-title">
        <span id="kt-ai-title">Kuantara Panel</span>
        <span id="kt-ai-subtitle">Floating utility for AI, chart & notes.</span>
      </div>
      <div class="kt-ai-panel-close" id="kt-ai-close">✕</div>
    </div>
    <div class="kt-ai-panel-body" id="kt-ai-body"></div>
    <div class="kt-ai-footer" id="kt-ai-footer"></div>
  </div>

  <div class="kt-overlay" id="kt-search-ovl" aria-hidden="true">
    <div class="kt-card">
      <div class="kt-card-title">Search</div>
      <input id="kt-search-input" class="kt-search-input" type="text" placeholder="Cari menu/sub… (Enter untuk lompat, Esc tutup)" />
      <button class="kt-close-btn" id="kt-search-close">Close</button>
    </div>
  </div>

  <div class="kt-cheatsheet" id="kt-cheatsheet">
    <div><b>Alt+0–9</b> Menu · <b>Ctrl+1–9</b> Sub · <b>Esc</b>=Alt+0 · <b>Ctrl+F</b> Search · <b>Tab</b> Profile</div>
  </div>

  <script>
    (function(){
      const mainButtons = document.querySelectorAll(".kt-mainmenu-btn");
      const bottomItems = document.querySelectorAll(".kt-bottom-item");
      const submenuGroups = document.querySelectorAll(".kt-submenu-group");
      const submenuButtons = document.querySelectorAll(".kt-submenu-btn");

      const breadcrumbMain = document.getElementById("breadcrumb-main");
      const breadcrumbSub  = document.getElementById("breadcrumb-sub");
      const statusMsg      = document.getElementById("kt-status-msg");
      const sessionTimes   = document.querySelectorAll(".kt-session-time");

      const aiFab    = document.getElementById("kt-ai-fab");
      const aiMenu   = document.getElementById("kt-ai-menu");
      const aiPanel  = document.getElementById("kt-ai-panel");
      const aiClose  = document.getElementById("kt-ai-close");
      const aiTitle  = document.getElementById("kt-ai-title");
      const aiSubtitle = document.getElementById("kt-ai-subtitle");
      const aiBody   = document.getElementById("kt-ai-body");
      const aiFooter = document.getElementById("kt-ai-footer");
      const aiMenuButtons = document.querySelectorAll(".kt-ai-menu-btn");

      const searchOvl   = document.getElementById("kt-search-ovl");
      const searchInput = document.getElementById("kt-search-input");
      const searchClose = document.getElementById("kt-search-close");

      const iframeLayer   = document.getElementById("kt-iframe-layer");
      const topbar        = document.getElementById("kt-topbar");
      const mainmenuStrip = document.getElementById("kt-mainmenu-strip");
      const contentHeader = document.getElementById("kt-content-header");
      const statusbar     = document.getElementById("kt-statusbar");
      const submenuStrip  = document.getElementById("kt-submenu-strip");
      const bottomNav     = document.getElementById("kt-bottom-nav");
      const profilePage   = document.getElementById("kt-profile-page");
      const workspacePage = document.getElementById("kt-workspace-page");
      const workspaceBoard = document.getElementById("kt-workspace-board");
      const workspaceAddBtn = document.getElementById("kt-workspace-add-current");
      const workspaceClearBtn = document.getElementById("kt-workspace-clear");

      const TOP_TRIGGER_ZONE = 60;
      const BOTTOM_TRIGGER_ZONE = 120;
      const HIDE_DELAY = 1800;
      const CLICK_GRACE = 450;
      let hideTimer=null, graceTimer=null;
      
      /* Pin State */
      let isPinned = false;

      let activeMenu=0;
      let activeBottom="home";

      /* track view for workspace */
      let currentViewUrl = "";
      let currentViewTitleMain = "";
      let currentViewTitleSub  = "";

      /* Map menu:sub -> iframe URL */
      const FEED_247_URL    = "https://kuantara112.github.io/Kuantara_Terminal_Charts/news_feeds_247.html";
      const MINI_CHART_URL  = "https://kuantara112.github.io/Kuantara_Terminal_Charts/xauusd_tradingview.html";
      const KUANTARA_AI_URL = "https://kuantara112.github.io/Kuantara_Terminal_Charts/kuantara_ai.html";

      const IFRAME_MAP = {
        // Markets
        "0:0":"https://kuantara112.github.io/Kuantara_Terminal_Charts/overview_markets.html",
        "0:1":"https://kuantara112.github.io/Kuantara_Terminal_Charts/markets_forex.html",
        "0:2":"https://kuantara112.github.io/Kuantara_Terminal_Charts/markets_fixed.html",
        "0:3":"https://kuantara112.github.io/Kuantara_Terminal_Charts/markets_commodities.html",
        "0:4":"https://kuantara112.github.io/Kuantara_Terminal_Charts/markets_equities.html",
        "0:5":"https://kuantara112.github.io/Kuantara_Terminal_Charts/markets_crypto.html",

        // News
        "1:0":FEED_247_URL,
        "1:1":"https://kuantara112.github.io/Kuantara_Terminal_Charts/news_insights.html",
        "1:2":"https://kuantara112.github.io/Kuantara_Terminal_Charts/news_calendar.html",
        "1:3":"https://44e53ad6-8cf6-4090-9e60-c9e985282fe0.filesusr.com/html/5e69ae_59c85b29326635aadaac1f2286d8f292.html",
        "1:4":"", 
        "1:5":"", 

        // Macroeconomic
        "2:0":"https://kuantara112.github.io/Kuantara_Terminal_Charts/usmacro.html",
        "2:1":"", 
        "2:3":"https://kuantara112.github.io/Kuantara_Terminal_Charts/macroeconomic_countries.html",

        // Charts
        "6:0":"https://kuantara112.github.io/Kuantara_Terminal_Charts/technical_charts.html"
      };

      function injectIframe(url){
        if(!url){ iframeLayer.innerHTML=""; return; }
        iframeLayer.innerHTML = '<iframe title="embedded" loading="lazy" src="'+url+'"></iframe>';
        updateIframeInteractivity();
      }

      function updateIframeInteractivity(){
        iframeLayer.style.pointerEvents = "auto";
      }

      function renderContent(menuIndex, subIndex){
        const key = menuIndex+":"+subIndex;
        const url = IFRAME_MAP[key] || "";
        injectIframe(url);
        currentViewUrl = url;
        currentViewTitleMain = breadcrumbMain.textContent || "";
        currentViewTitleSub  = breadcrumbSub.textContent || "";
        
        if(!isPinned){
          statusMsg.textContent = url ? "EMBED: "+url : "READY (No content)";
        }
      }

      function setActiveMenu(menuIndex){
        activeMenu = menuIndex;
        document.querySelectorAll(".kt-mainmenu-btn").forEach(btn=>{
          btn.classList.toggle("active", Number(btn.getAttribute("data-menu"))===menuIndex);
        });
        submenuGroups.forEach(group=>{
          group.classList.toggle("active", Number(group.getAttribute("data-menu-sub"))===menuIndex);
        });
        const activeMain = document.querySelector('.kt-mainmenu-btn[data-menu="'+menuIndex+'"] span:nth-child(2)');
        if(activeMain) breadcrumbMain.textContent = menuIndex+" · "+activeMain.textContent.trim();

        const firstSub = document.querySelector('.kt-submenu-btn[data-menu="'+menuIndex+'"][data-sub-index="0"]');
        if(firstSub){ setActiveSub(menuIndex,0); } else { breadcrumbSub.textContent=""; renderContent(menuIndex,-1); }

        if(!isPinned) statusMsg.textContent = "ACTIVE MENU: "+menuIndex;
      }

      function setActiveSub(menuIndex, subIndex){
        submenuButtons.forEach(btn=>{
          const m=Number(btn.getAttribute("data-menu"));
          const s=Number(btn.getAttribute("data-sub-index"));
          btn.classList.toggle("active", m===menuIndex && s===subIndex);
        });
        const sub = document.querySelector('.kt-submenu-btn[data-menu="'+menuIndex+'"][data-sub-index="'+subIndex+'"]');
        if(sub){ 
          breadcrumbSub.textContent=sub.textContent.trim(); 
          if(!isPinned) statusMsg.textContent="ACTIVE: "+menuIndex+" · "+breadcrumbSub.textContent; 
        }
        else { 
          breadcrumbSub.textContent=""; 
          if(!isPinned) statusMsg.textContent="ACTIVE MENU: "+menuIndex+" · (no sub)"; 
        }

        renderContent(menuIndex, subIndex);
      }

      function setBottomActive(role){
        activeBottom = role;
        bottomItems.forEach(item=>{
          item.classList.toggle("active", item.getAttribute("data-bottom-role")===role);
        });
      }

      function showProfilePage(){
        profilePage.style.display="block";
      }
      function hideProfilePage(){
        profilePage.style.display="none";
      }

      function showWorkspacePage(){
        workspacePage.style.display="block";
      }
      function hideWorkspacePage(){
        workspacePage.style.display="none";
      }

      function setupEventListeners() {
        /* Main menu */
        mainButtons.forEach(btn => {
          btn.addEventListener('click', (e) => {
            e.stopPropagation();
            if(activeBottom!=="home"){
              setBottomActive("home");
              hideProfilePage();
              hideWorkspacePage();
            }
            setActiveMenu(Number(btn.getAttribute("data-menu")));
            if(!isPinned) { showAllBars(); scheduleHide(); }
          });
        });

        /* Submenu */
        submenuButtons.forEach(btn => {
          btn.addEventListener('click', (e) => {
            e.stopPropagation();
            if(activeBottom!=="home"){
              setBottomActive("home");
              hideProfilePage();
              hideWorkspacePage();
            }
            const menuIndex = Number(btn.getAttribute("data-menu"));
            const subIndex = Number(btn.getAttribute("data-sub-index"));
            setActiveSub(menuIndex, subIndex);
            if(!isPinned) { showAllBars(); scheduleHide(); }
          });
        });

        /* Bottom bar behaviour */
        bottomItems.forEach(item=>{
          item.addEventListener("click",(e)=>{
            e.stopPropagation();
            const role = item.getAttribute("data-bottom-role");

            if(role==="home"){
              setBottomActive("home");
              hideProfilePage();
              hideWorkspacePage();
              setActiveMenu(0);
              setActiveSub(0,0);
              if(!isPinned) { showAllBars(); scheduleHide(); }
            }
            else if(role==="workspace"){
              setBottomActive("workspace");
              hideProfilePage();
              hideAllBars();
              injectIframe("");
              showWorkspacePage();
            }
            else if(role==="profile"){
              setBottomActive("profile");
              hideWorkspacePage();
              hideAllBars();
              injectIframe("");
              showProfilePage();
            }
          });
        });

        /* Workspace buttons */
        if(workspaceAddBtn){
          workspaceAddBtn.addEventListener("click",(e)=>{
            e.stopPropagation();
            addCurrentViewToWorkspace();
          });
        }
        if(workspaceClearBtn){
          workspaceClearBtn.addEventListener("click",(e)=>{
            e.stopPropagation();
            clearWorkspace();
          });
        }

        /* Pin/Unpin Double Click on Topbar */
        topbar.addEventListener("dblclick", (e) => {
          isPinned = !isPinned;
          document.body.classList.toggle("kt-pinned", isPinned);
          
          if(isPinned){
            clearTimeout(hideTimer);
            statusMsg.textContent = "Autohide disabled";
            showAllBars();
          } else {
            statusMsg.textContent = currentViewUrl ? "EMBED: "+currentViewUrl : "READY";
            if(activeBottom==="home") scheduleHide();
          }
        });
      }

      /* SEARCH */
      function buildSearchIndex(){
        const idx=[];
        document.querySelectorAll(".kt-mainmenu-btn").forEach(btn=>{
          const menuIdx=Number(btn.getAttribute("data-menu"));
          const name=btn.querySelector("span:nth-child(2)")?.textContent?.trim()||"";
          idx.push({label:name,menu:menuIdx,sub:null,type:"menu"});
        });
        document.querySelectorAll(".kt-submenu-btn").forEach(btn=>{
          const menuIdx=Number(btn.getAttribute("data-menu"));
          const subIdx=Number(btn.getAttribute("data-sub-index"));
          const name=btn.textContent.trim();
          idx.push({label:name,menu:menuIdx,sub:subIdx,type:"sub"});
        });
        return idx;
      }
      function findBestMatch(index,qRaw){
        const q=qRaw.toLowerCase();
        return index.find(it=>it.label.toLowerCase()===q)
            || index.find(it=>it.label.toLowerCase().startsWith(q))
            || index.find(it=>it.label.toLowerCase().includes(q))
            || null;
      }

      let searchIndex=buildSearchIndex();
      function openOverlay(el){ el.style.display="flex"; updateIframeInteractivity(); }
      function closeOverlay(el){ el.style.display="none"; updateIframeInteractivity(); }

      function openSearch(){
        searchIndex=buildSearchIndex();
        openOverlay(searchOvl);
        setTimeout(()=>searchInput.focus(),10);
        if(!isPinned) statusMsg.textContent="SEARCH: active";
        if(activeBottom==="home"){
          showAllBars();
        }
      }
      function closeSearch(){ 
        closeOverlay(searchOvl); 
        if(!isPinned) statusMsg.textContent="SEARCH: closed"; 
        if(activeBottom==="home" && !isPinned) scheduleHide(); 
      }

      searchClose.addEventListener("click", closeSearch);
      searchOvl.addEventListener("click",(e)=>{ if(e.target===searchOvl) closeSearch(); });
      searchInput.addEventListener("keydown",(e)=>{
        if(e.key==="Escape"){ e.preventDefault(); closeSearch(); return; }
        if(e.key==="Enter"){
          e.preventDefault();
          const q=(searchInput.value||"").trim();
          if(!q){ 
            if(!isPinned) statusMsg.textContent="SEARCH: empty"; 
            closeSearch(); 
            return; 
          }
          const match=findBestMatch(searchIndex,q);
          if(match){
            if(activeBottom!=="home"){
              setBottomActive("home");
              hideProfilePage();
              hideWorkspacePage();
            }
            setActiveMenu(match.menu);
            if(match.sub!==null) setActiveSub(match.menu,match.sub);
            if(!isPinned) statusMsg.textContent=`SEARCH goto: ${match.label} (${match.type})`;
          }
          else{
            if(!isPinned) statusMsg.textContent=`SEARCH: "${q}" not found`;
          }
          closeSearch();
        }
      });

      /* AUTOHIDE BARS – hanya aktif di HOME */
      function showTopBars(){
        if(activeBottom!=="home") return;
        mainmenuStrip.classList.remove("kt-hide-top");
        contentHeader.classList.remove("kt-hide-top");
        clearTimeout(graceTimer);
        graceTimer=setTimeout(()=>{},CLICK_GRACE);
        updateIframeInteractivity();
      }

      function hideTopBars(){
        if(isPinned) return;
        mainmenuStrip.classList.add("kt-hide-top");
        contentHeader.classList.add("kt-hide-top");
        updateIframeInteractivity();
      }

      function showBottomBars(){
        if(activeBottom!=="home") return;
        submenuStrip.classList.remove("kt-hide-bottom");
        statusbar.classList.remove("kt-hide-bottom");
        clearTimeout(graceTimer);
        graceTimer=setTimeout(()=>{},CLICK_GRACE);
        updateIframeInteractivity();
      }

      function hideBottomBars(){
        if(isPinned) return;
        submenuStrip.classList.add("kt-hide-bottom");
        statusbar.classList.add("kt-hide-bottom");
        updateIframeInteractivity();
      }

      function showAllBars(){
        showTopBars();
        showBottomBars();
      }

      function hideAllBars(){
        if(isPinned) return;
        hideTopBars();
        hideBottomBars();
      }

      function scheduleHide(){
        if(activeBottom!=="home" || isPinned) return;
        clearTimeout(hideTimer);
        hideTimer=setTimeout(()=>{ hideAllBars(); }, HIDE_DELAY);
      }

      function handleMouseMove(e){
        if(activeBottom!=="home" || isPinned) return;
        const y = e.clientY;
        const h = window.innerHeight;
        const nearTop = y <= TOP_TRIGGER_ZONE;
        const nearBottom = y >= (h - BOTTOM_TRIGGER_ZONE);

        if (nearTop) {
          showTopBars();
          scheduleHide();
        } else if (nearBottom) {
          showBottomBars();
          scheduleHide();
        }
      }

      window.addEventListener("mousemove", handleMouseMove, {passive:true});

      window.addEventListener("touchstart",(e)=>{
        if(activeBottom!=="home" || isPinned) return;
        const y=e.touches[0]?.clientY??0, h=window.innerHeight;
        const nearTop = y <= TOP_TRIGGER_ZONE;
        const nearBottom = y >= (h - BOTTOM_TRIGGER_ZONE);

        if(nearTop) showTopBars();
        if(nearBottom) showBottomBars();
        scheduleHide();
      },{passive:true});

      [mainmenuStrip, contentHeader, submenuStrip, statusbar, bottomNav].forEach(el=>{
        el.addEventListener("mouseenter", ()=>{
          if(activeBottom!=="home" && el!==bottomNav) return;
          clearTimeout(hideTimer);
          if (el === mainmenuStrip || el === contentHeader) {
            showTopBars();
          } else if (el !== bottomNav) {
            showBottomBars();
          }
        });
        el.addEventListener("mouseleave", ()=>{
          if(el===bottomNav) return;
          scheduleHide();
        });
        el.addEventListener("pointerdown", ()=>{ clearTimeout(hideTimer); });
        el.addEventListener("click", (e)=>{ e.stopPropagation(); });
      });

      document.querySelectorAll('.kt-mainmenu-btn, .kt-submenu-btn').forEach(btn=>{
        btn.addEventListener('pointerdown', (e)=>{
          e.stopPropagation();
          showAllBars();
          updateIframeInteractivity();
        });
        btn.addEventListener('click', (e)=>{ e.stopPropagation(); });
      });

      /* FLOATING MENU LOGIC */
      function toggleAiMenu(force){
        const isOpen = aiMenu.style.display==="flex";
        const next = typeof force==="boolean" ? force : !isOpen;
        aiMenu.style.display = next ? "flex" : "none";
      }

      function openAiPane(mode){
        if(mode==="ai"){
          aiTitle.textContent = "Kuantara AI Assistant";
          aiSubtitle.textContent = "Kuantara AI terintegrasi langsung di dalam panel ini.";
          aiBody.innerHTML =
            '<iframe src="'+KUANTARA_AI_URL+'" ' +
            'title="Kuantara AI" loading="lazy" ' +
            'style="width:100%;height:100%;border:0;display:block;"></iframe>';
          aiFooter.innerHTML = '';
          aiPanel.style.display="flex";
          if(activeBottom==="home") showAllBars();
        }else if(mode==="mini"){
          aiTitle.textContent = "Mini Chart";
          aiSubtitle.textContent = "Chart kecil untuk quick view XAUUSD.";
          aiBody.innerHTML =
            '<iframe src="'+MINI_CHART_URL+'" ' +
            'title="Mini Chart" loading="lazy" ' +
            'style="width:100%;height:100%;border:0;display:block;"></iframe>';
          aiFooter.innerHTML = '';
          aiPanel.style.display="flex";
          if(activeBottom==="home") showAllBars();
        }else if(mode==="notes"){
          aiTitle.textContent = "Notes";
          aiSubtitle.textContent = "Catatan cepat untuk ide trade dan macro view.";
          aiBody.innerHTML =
            '<textarea id="kt-notes-area" ' +
            'style="width:100%;height:100%;background:#111;border:none;border-radius:0;' +
            'color:var(--text-main);padding:6px;font-size:11px;resize:none;box-sizing:border-box;outline:none;overflow:auto;" ' +
            'placeholder="Tulis catatan di sini..."></textarea>';
          aiFooter.innerHTML = '';

          const notesArea = document.getElementById("kt-notes-area");
          if(window.localStorage){
            const saved = localStorage.getItem("kuantara_notes");
            if(saved) notesArea.value = saved;
            notesArea.addEventListener("input", ()=>localStorage.setItem("kuantara_notes", notesArea.value));
          }
          aiPanel.style.display="flex";
          if(activeBottom==="home") showAllBars();
        }else if(mode==="signals"){
          aiTitle.textContent = "Signals";
          aiSubtitle.textContent = "Ringkasan sinyal trading & alert utama.";
          aiBody.innerHTML =
            '<div style="width:100%;height:100%;padding:8px 10px;box-sizing:border-box;font-size:10px;line-height:1.5;color:var(--text-muted);overflow:auto;">' +
            'Panel ini akan menampilkan sinyal dari sistem Kuantara (algo, screener, atau alert eksternal). ' +
            'Integrasi backend bisa diarahkan untuk push sinyal terbaru ke area ini secara realtime.' +
            '</div>';
          aiFooter.innerHTML = '';
          aiPanel.style.display="flex";
          if(activeBottom==="home") showAllBars();
        }else if(mode==="group"){
          aiTitle.textContent = "Group Chat";
          aiSubtitle.textContent = "Chat antar user Kuantara Terminal (prototype).";
          aiBody.innerHTML =
            '<div style="width:100%;height:100%;padding:8px 10px;box-sizing:border-box;font-size:10px;line-height:1.5;color:var(--text-muted);overflow:auto;">' +
              'Fitur ini didesain sebagai ruang obrolan realtime antar pengguna Kuantara Terminal. ' +
              'Integrasi backend (Telegram/Discord/WebSocket) bisa dihubungkan ke panel ini di tahap berikutnya.' +
              '<div style="margin-top:8px;padding:6px 8px;border-radius:6px;border:1px dashed var(--border-soft);font-size:10px;color:var(--text-muted);">' +
              'Prototype: belum terhubung ke server chat. Di versi production, area ini akan menampilkan pesan, daftar user online, dan input box untuk mengirim chat.' +
              '</div>' +
            '</div>';
          aiFooter.innerHTML = '';
          aiPanel.style.display="flex";
          if(activeBottom==="home") showAllBars();
        }
      }

      aiFab.addEventListener("click", (e)=>{
        e.stopPropagation();
        toggleAiMenu();
        if(activeBottom==="home") showAllBars();
      });

      aiMenuButtons.forEach(btn=>{
        btn.addEventListener("click",(e)=>{
          e.stopPropagation();
          const pane = btn.getAttribute("data-pane");
          toggleAiMenu(false);
          openAiPane(pane);
        });
      });

      aiClose.addEventListener("click", ()=>{
        aiPanel.style.display="none";
      });

      window.addEventListener("click",(e)=>{
        if(!aiFab.contains(e.target) && !aiMenu.contains(e.target) && !aiPanel.contains(e.target)){
          toggleAiMenu(false);
        }
      });

      aiPanel.addEventListener("click",(e)=>{ e.stopPropagation(); });

      /* WORKSPACE LOGIC */
      function ensureWorkspacePlaceholder(){
        if(!workspaceBoard) return;
        if(!workspaceBoard.querySelector(".kt-workspace-window")){
          workspaceBoard.innerHTML =
            '<div class="kt-workspace-placeholder">' +
            'Belum ada window di Workspace.<br>' +
            'Pergi ke Home, pilih view yang kamu suka, lalu klik <b>Add current view</b>.' +
            '</div>';
        }
      }

      function createWorkspaceWindow(url, titleMain, titleSub){
        if(!workspaceBoard || !url) return;
        const placeholder = workspaceBoard.querySelector(".kt-workspace-placeholder");
        if(placeholder) placeholder.remove();

        const win = document.createElement("div");
        win.className = "kt-workspace-window";
        const count = workspaceBoard.querySelectorAll(".kt-workspace-window").length;
        const offset = count * 24;

        win.style.left = (20 + offset) + "px";
        win.style.top  = (20 + offset) + "px";
        win.style.width = "380px";
        win.style.height = "240px";

        const title = (titleMain || "View") + (titleSub ? " · " + titleSub : "");

        win.innerHTML = `
          <div class="kt-workspace-window-header">
            <span class="kt-workspace-window-title">${title}</span>
            <button class="kt-workspace-window-close" title="Close">✕</button>
          </div>
          <div class="kt-workspace-window-body">
            <iframe src="${url}" loading="lazy" title="Workspace view" frameborder="0"></iframe>
          </div>
          <div class="kt-workspace-resizer" title="Drag to resize"></div>
        `;

        workspaceBoard.appendChild(win);

        const closeBtn = win.querySelector(".kt-workspace-window-close");
        if(closeBtn){
          closeBtn.addEventListener("click", ()=>{
            win.remove();
            ensureWorkspacePlaceholder();
          });
        }

        attachDragHandlers(win);
        attachResizeHandlers(win);
      }

      function addCurrentViewToWorkspace(){
        if(!currentViewUrl){
          if(!isPinned) statusMsg.textContent = "WORKSPACE: no active view to add";
          return;
        }
        createWorkspaceWindow(currentViewUrl, currentViewTitleMain, currentViewTitleSub);
        if(!isPinned) statusMsg.textContent = "WORKSPACE: view added";
      }

      function clearWorkspace(){
        if(!workspaceBoard) return;
        workspaceBoard.innerHTML = "";
        ensureWorkspacePlaceholder();
        if(!isPinned) statusMsg.textContent = "WORKSPACE: cleared";
      }

      function attachDragHandlers(win){
        const header = win.querySelector(".kt-workspace-window-header");
        if(!header || !workspaceBoard) return;
        let isDragging=false, startX=0,startY=0,startLeft=0,startTop=0;

        header.addEventListener("pointerdown",(e)=>{
          e.preventDefault();
          isDragging=true;
          const rect = win.getBoundingClientRect();
          const boardRect = workspaceBoard.getBoundingClientRect();
          startX = e.clientX;
          startY = e.clientY;
          startLeft = rect.left - boardRect.left;
          startTop  = rect.top  - boardRect.top;

          win.setPointerCapture(e.pointerId);

          const onMove = (ev)=>{
            if(!isDragging) return;
            const dx = ev.clientX - startX;
            const dy = ev.clientY - startY;

            let newLeft = startLeft + dx;
            let newTop  = startTop + dy;

            const maxLeft = workspaceBoard.clientWidth - win.offsetWidth;
            const maxTop  = workspaceBoard.clientHeight - 40;

            if(newLeft < 0) newLeft = 0;
            if(newTop  < 0) newTop  = 0;
            if(newLeft > maxLeft) newLeft = maxLeft;
            if(newTop  > maxTop)  newTop  = maxTop;

            win.style.left = newLeft + "px";
            win.style.top  = newTop  + "px";
          };

          const onUp = (ev)=>{
            isDragging=false;
            try { win.releasePointerCapture(ev.pointerId); } catch(e){}
            window.removeEventListener("pointermove", onMove);
            window.removeEventListener("pointerup", onUp);
          };

          window.addEventListener("pointermove", onMove);
          window.addEventListener("pointerup", onUp);
        });
      }

      function attachResizeHandlers(win){
        const handle = win.querySelector(".kt-workspace-resizer");
        if(!handle || !workspaceBoard) return;

        let isResizing=false, startX=0,startY=0,startW=0,startH=0;

        handle.addEventListener("pointerdown",(e)=>{
          e.preventDefault();
          e.stopPropagation();
          isResizing=true;
          const rect = win.getBoundingClientRect();
          startX = e.clientX;
          startY = e.clientY;
          startW = rect.width;
          startH = rect.height;

          win.setPointerCapture(e.pointerId);

          const onMove = (ev)=>{
            if(!isResizing) return;
            const dx = ev.clientX - startX;
            const dy = ev.clientY - startY;
            let newW = startW + dx;
            let newH = startH + dy;

            const minW = 220;
            const minH = 140;
            const boardRect = workspaceBoard.getBoundingClientRect();
            const winRect = win.getBoundingClientRect();

            if(newW < minW) newW = minW;
            if(newH < minH) newH = minH;
            if(winRect.left + newW > boardRect.right) newW = boardRect.right - winRect.left;
            if(winRect.top + newH > boardRect.bottom) newH = boardRect.bottom - winRect.top;

            win.style.width  = newW + "px";
            win.style.height = newH + "px";
          };

          const onUp = (ev)=>{
            isResizing=false;
            try { win.releasePointerCapture(ev.pointerId); } catch(e){}
            window.removeEventListener("pointermove", onMove);
            window.removeEventListener("pointerup", onUp);
          };

          window.addEventListener("pointermove", onMove);
          window.addEventListener("pointerup", onUp);
        });
      }

      /* Keyboard */
      window.addEventListener("keydown",(e)=>{
        if(e.ctrlKey && (e.key==="f"||e.key==="F")){ e.preventDefault(); openSearch(); return; }
        if(e.altKey && !e.ctrlKey && !e.shiftKey){
          const k=e.key; if(k>="0"&&k<="9"){
            e.preventDefault();
            if(activeBottom!=="home"){
              setBottomActive("home");
              hideProfilePage();
              hideWorkspacePage();
            }
            setActiveMenu(Number(k));
            if(!isPinned) { showAllBars(); scheduleHide(); }
            return;
          }
        }
        if(e.ctrlKey && !e.altKey){
          const k=e.key; if(k>="1"&&k<="9"){
            e.preventDefault();
            if(activeBottom!=="home"){
              setBottomActive("home");
              hideProfilePage();
              hideWorkspacePage();
            }
            setActiveSub(activeMenu, Number(k)-1);
            if(!isPinned) { showAllBars(); scheduleHide(); }
            return;
          }
        }
        if(e.key==="Escape"){
          e.preventDefault();
          setBottomActive("home");
          hideProfilePage();
          hideWorkspacePage();
          setActiveMenu(0);
          setActiveSub(0,0);
          if(!isPinned) { showAllBars(); scheduleHide(); }
          return;
        }
        if(e.key==="Tab"){
          e.preventDefault();
          setBottomActive("profile");
          hideWorkspacePage();
          hideAllBars();
          injectIframe("");
          showProfilePage();
          return;
        }
        if(e.key==="Shift" && !e.repeat && !e.ctrlKey && !e.altKey){
          const cheats=document.getElementById("kt-cheatsheet");
          cheats.style.display="block"; setTimeout(()=>{cheats.style.display="none";},2000);
          if(activeBottom==="home" && !isPinned){ showAllBars(); scheduleHide(); }
          return;
        }
      });

      /* Clocks */
      function pad2(n){return n<10?"0"+n:""+n}
      function updateSessions(){
        const now=new Date();
        const utc=Date.UTC(now.getUTCFullYear(),now.getUTCMonth(),now.getUTCDate(),now.getUTCHours(),now.getUTCMinutes(),now.getUTCSeconds());
        sessionTimes.forEach(el=>{
          const offset=Number(el.getAttribute("data-tz"))||0;
          const d=new Date(utc+offset*3600*1000);
          el.textContent=pad2(d.getUTCHours())+":"+pad2(d.getUTCMinutes());
        });
      }
      updateSessions(); setInterval(updateSessions,1000);

      /* Init */
      setupEventListeners();
      setActiveMenu(0);
      setBottomActive("home");
      hideProfilePage();
      hideWorkspacePage();
      ensureWorkspacePlaceholder();
      showAllBars();
      setTimeout(()=>{ hideAllBars(); }, 1000);
      updateIframeInteractivity();
    })();
  </script>
</body>
</html>
