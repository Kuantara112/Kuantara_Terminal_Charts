<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Market Research â€“ Kuantara</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500;600&display=swap"/>

  <style>
    :root {
      /* KUANTARA TERMINAL THEME */
      --bg-root: #000000;
      --bg-main: #111111;
      --bg-element: #111111;
      --bg-hover: #1a1a1a;
      --border-main: #2b2b2b;
      --border-soft: #2b2b2b;
      --text-main: #f5f5f5;
      --text-muted: #9b9b9b;
      --accent: #ffbf00;
      --accent-dim: rgba(255, 191, 0, 0.15);

      --fs-title: 14px;
      --fs-subtitle: 12px;
      --fs-body: 11px;
      --fs-small: 10px;

      --toolbar-height: 44px;
    }

    *{
      box-sizing:border-box;
      margin:0;
      padding:0;
      font-family:"Fira Code",monospace !important;
      -webkit-tap-highlight-color:transparent;
      scrollbar-width:thin;
      scrollbar-color:#000000 #000000;
    }

    /* WebKit scrollbar */
    ::-webkit-scrollbar{width:8px;height:8px;}
    ::-webkit-scrollbar-track{background:#000000;}
    ::-webkit-scrollbar-thumb{background:#000000;border-radius:4px;}

    html,body{
      width:100%;
      height:100%;
      background:var(--bg-root);
      color:var(--text-main);
      overflow:hidden;
    }

    /* LAYOUT */
    .app-shell{
      display:flex;
      width:100vw;
      height:100vh;
      position:relative;
      background:var(--bg-root);
      padding:16px;
    }

    /* SIDEBAR */
    .sidebar{
      flex:0 0 25%;
      max-width:360px;
      min-width:260px;
      background:var(--bg-main);
      border:1px solid var(--border-main);
      border-radius:4px;
      display:flex;
      flex-direction:column;
      z-index:20;
      transition:transform .3s ease;
    }

    .sidebar-content{
      padding:16px;
      display:flex;
      flex-direction:column;
      gap:12px;
      height:100%;
      overflow-y:auto;
    }

    .brand-label{
      font-weight:600;
      color:var(--accent);
      font-size:var(--fs-title);
      letter-spacing:.5px;
    }

    .form-group{
      display:flex;
      flex-direction:column;
      gap:4px;
    }

    .form-label{
      font-size:var(--fs-small);
      color:var(--text-muted);
      letter-spacing:.5px;
      font-weight:500;
      text-transform:uppercase;
    }

    .kt-input{
      background:#000000;
      border:1px solid var(--border-main);
      color:var(--text-main);
      padding:8px 10px;
      border-radius:4px;
      font-size:var(--fs-body);
      width:100%;
      outline:none;
    }

    .kt-input:focus{
      border-color:var(--accent);
    }

    .list-header{
      margin-top:6px;
      display:flex;
      justify-content:space-between;
      color:var(--text-muted);
      font-size:var(--fs-small);
    }

    #docList{margin-top:6px;}

    .doc-item{
      padding:10px 10px;
      margin-bottom:6px;
      background:var(--bg-element);
      border:1px solid transparent;
      border-radius:4px;
      cursor:pointer;
      transition:.15s;
    }

    .doc-item:hover{
      background:var(--bg-hover);
    }

    .doc-item.active{
      background:var(--accent-dim);
      border-color:var(--accent);
    }

    .doc-title{
      font-size:var(--fs-body);
      font-weight:500;
      margin-bottom:2px;
      color:var(--text-main);
    }

    .doc-meta{
      font-size:var(--fs-small);
      color:var(--text-muted);
      display:flex;
      justify-content:space-between;
    }

    /* MAIN CONTENT */
    .main-content{
      flex:1;
      display:flex;
      flex-direction:column;
      position:relative;
      min-width:0;
      margin-left:12px;
    }

    .toolbar{
      height:var(--toolbar-height);
      background:var(--bg-main);
      border:1px solid var(--border-main);
      border-radius:4px;
      display:flex;
      align-items:center;
      padding:0 10px;
      gap:8px;
      overflow-x:auto;
      margin-bottom:12px;
    }

    .toolbar-group{
      display:flex;
      gap:4px;
      padding-right:10px;
      border-right:1px solid var(--border-main);
      align-items:center;
    }

    .toolbar-group:last-child{
      border-right:none;
    }

    .tool-btn{
      width:30px;
      height:30px;
      background:transparent;
      border:1px solid transparent;
      color:var(--text-muted);
      border-radius:4px;
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:center;
      flex-shrink:0;
      font-size:var(--fs-body);
    }

    .tool-btn:hover{
      background:var(--bg-hover);
      color:var(--text-main);
    }

    .tool-btn.active{
      background:var(--bg-hover);
      color:var(--accent);
      border-color:var(--border-soft);
    }

    svg{
      width:16px;
      height:16px;
      stroke-width:2;
    }

    /* VIEWER */
    .viewer-viewport{
      flex:1;
      position:relative;
      background:#000000;
      border:1px solid var(--border-main);
      border-radius:4px;
      overflow-y:auto;
      overflow-x:auto;
      display:block;
      text-align:center;
      padding:16px;
    }

    .pdf-wrapper{
      display:inline-block;
      position:relative;
      background:#111111;
      box-shadow:0 8px 30px rgba(0,0,0,0.7);
      transform-origin:top center;
      /* width/height di-set via JS untuk responsive */
    }

    iframe{
      width:100%;
      height:100%;
      border:none;
      display:block;
      background:#ffffff;
      /* penting: biarkan pointer events aktif agar scroll di dalam pdf berfungsi */
      pointer-events:auto;
    }

    canvas{
      position:absolute;
      top:0;
      left:0;
      width:100%;
      height:100%;
      touch-action:none;
    }

    /* Mode PAN / DRAW */
    .viewer-viewport.mode-pan canvas{
      pointer-events:none;
      cursor:grab;
    }
    .viewer-viewport.mode-draw canvas{
      pointer-events:auto;
      cursor:crosshair;
    }

    /* MOBILE */
    @media (max-width:768px){
      .app-shell{
        padding:8px;
      }

      .sidebar{
        position:fixed;
        left:0;
        top:0;
        height:100%;
        width:82%;
        transform:translateX(-100%);
        box-shadow:4px 0 20px #000;
        border-radius:0 4px 4px 0;
      }

      .sidebar.open{
        transform:translateX(0);
      }

      .sidebar-backdrop{
        position:fixed;
        inset:0;
        background:rgba(0,0,0,0.8);
        z-index:15;
        opacity:0;
        pointer-events:none;
        transition:.25s;
      }

      .sidebar-backdrop.open{
        opacity:1;
        pointer-events:auto;
      }

      .main-content{
        margin-left:0;
      }

      .viewer-viewport{
        padding:8px;
      }

      .btn-menu{
        display:flex !important;
      }
    }

    .btn-menu{
      display:none;
      margin-right:4px;
      background:var(--accent);
      border:none;
      border-radius:4px;
      padding:6px 10px;
      font-weight:600;
      font-size:var(--fs-small);
      color:#000;
      cursor:pointer;
    }
  </style>
</head>
<body>

<div class="app-shell">
  <div class="sidebar-backdrop" id="backdrop"></div>

  <aside class="sidebar" id="sidebar">
    <div class="sidebar-content">
      <div class="brand-label">MARKET RESEARCH</div>

      <div class="form-group" style="margin-top:8px;">
        <label class="form-label">Topic</label>
        <select class="kt-input" id="topicFilter">
          <option value="all">All Topics</option>
          <option value="fx">FX Strategy</option>
          <option value="macro">Global Macro</option>
        </select>
      </div>

      <div class="list-header">
        <span>AVAILABLE DOCS</span>
        <span id="docCount">0</span>
      </div>

      <div id="docList"></div>
    </div>
  </aside>

  <main class="main-content">
    <div class="toolbar">
      <button class="btn-menu" id="menuToggle">MENU</button>

      <div class="toolbar-group">
        <button class="tool-btn active" id="btnPan" title="Pan / Scroll">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
            <path d="M7 11l5-5 5 5"/>
            <path d="M7 13l5 5 5-5"/>
          </svg>
        </button>
        <button class="tool-btn" id="btnPen" title="Pen">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
            <path d="M12 19l7-7 3 3-7 7-3-3z"/>
            <path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"/>
          </svg>
        </button>
        <button class="tool-btn" id="btnHigh" title="Highlighter">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
            <path d="M9 11l-6 6v3h9l3-3"/>
            <line x1="22" y1="12" x2="17.4" y2="16.6"/>
          </svg>
        </button>
        <button class="tool-btn" id="btnErase" title="Eraser">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 4H8l-7 8 7 8h13a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2z"/>
            <line x1="18" y1="9" x2="12" y2="15"/>
            <line x1="12" y1="9" x2="18" y2="15"/>
          </svg>
        </button>
        <button class="tool-btn" id="btnClear" title="Clear All">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="3 6 5 6 21 6"/>
            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
          </svg>
        </button>
      </div>
    </div>

    <div class="viewer-viewport mode-pan" id="viewport">
      <div class="pdf-wrapper" id="wrapper">
        <iframe id="pdfFrame" src=""></iframe>
        <canvas id="pdfCanvas"></canvas>
      </div>
    </div>
  </main>
</div>

<script>
  // --- DATA DEMO ---
  const BASE_PDF_URL = "https://mozilla.github.io/pdf.js/web/compressed.tracemonkey-pldi-09.pdf";
  const docs = [
    { id:1, title:"FX Strategy: USD Outlook",     date:"2025-11-21", topic:"fx",    url:BASE_PDF_URL },
    { id:2, title:"Global Macro: Recession Risk", date:"2025-11-20", topic:"macro", url:BASE_PDF_URL },
    { id:3, title:"Commodities: Gold Rally",      date:"2025-11-19", topic:"macro", url:BASE_PDF_URL },
  ];

  const viewport = document.getElementById('viewport');
  const wrapper  = document.getElementById('wrapper');
  const canvas   = document.getElementById('pdfCanvas');
  const ctx      = canvas.getContext('2d');
  const pdfFrame = document.getElementById('pdfFrame');

  let currentTool = 'pan';
  let isDrawing   = false;
  let lastX = 0, lastY = 0;

  // Rasio A4 kasar
  const BASE_RATIO = 1200 / 900; // 4:3 kurang lebih

  function init(){
    renderList();
    resizeCanvas();
    if(docs.length > 0) loadDoc(docs[0]);
    window.addEventListener('resize', resizeCanvas);
  }

  function renderList(){
    const container = document.getElementById('docList');
    container.innerHTML = '';
    docs.forEach(d=>{
      const el = document.createElement('div');
      el.className = 'doc-item';
      el.innerHTML = `
        <div class="doc-title">${d.title}</div>
        <div class="doc-meta">
          <span>${d.date}</span>
          <span style="color:var(--accent)">${d.topic}</span>
        </div>`;
      el.onclick = () => loadDoc(d, el);
      container.appendChild(el);
    });
    document.getElementById('docCount').textContent = docs.length;
  }

  function loadDoc(doc, elBtn){
    document.querySelectorAll('.doc-item').forEach(b=>b.classList.remove('active'));
    if(elBtn) elBtn.classList.add('active');
    else if(document.querySelector('.doc-item')) document.querySelector('.doc-item').classList.add('active');

    ctx.clearRect(0,0,canvas.width,canvas.height);

    const googleProxy = `https://docs.google.com/viewer?url=${encodeURIComponent(doc.url)}&embedded=true`;
    pdfFrame.src = googleProxy;

    toggleSidebar(false);
  }

  // RESPONSIVE CANVAS & WRAPPER
  function resizeCanvas(){
    const padding = 32; // ruang kiri-kanan di viewport
    const available = Math.max(320, viewport.clientWidth - padding);
    const width  = available;
    const height = Math.round(width * BASE_RATIO);

    wrapper.style.width  = width + 'px';
    wrapper.style.height = height + 'px';

    canvas.width  = width;
    canvas.height = height;

    wrapper.style.margin = '0 auto';

    ctx.lineCap = 'round';
    ctx.lineJoin = 'round';
  }

  // TOOLS
  const tools = { btnPan:'pan', btnPen:'pen', btnHigh:'high', btnErase:'erase' };

  Object.keys(tools).forEach(id=>{
    document.getElementById(id).onclick = () => setTool(tools[id]);
  });

  document.getElementById('btnClear').onclick = () => {
    if(confirm('Clear annotations?')){
      ctx.clearRect(0,0,canvas.width,canvas.height);
    }
  };

  function setTool(t){
    currentTool = t;
    document.querySelectorAll('.tool-btn').forEach(b=>b.classList.remove('active'));
    const btnId = Object.keys(tools).find(key => tools[key] === t);
    if(btnId) document.getElementById(btnId).classList.add('active');

    viewport.className = 'viewer-viewport mode-' + (t === 'pan' ? 'pan' : 'draw');
  }

  // DRAWING
  function getPos(e){
    const rect = canvas.getBoundingClientRect();
    let clientX = e.clientX;
    let clientY = e.clientY;

    if(e.touches && e.touches.length > 0){
      clientX = e.touches[0].clientX;
      clientY = e.touches[0].clientY;
    }

    // scaling CSS -> canvas resolusi
    const scaleX = canvas.width  / rect.width;
    const scaleY = canvas.height / rect.height;

    return {
      x:(clientX - rect.left) * scaleX,
      y:(clientY - rect.top)  * scaleY
    };
  }

  function startDraw(e){
    if(currentTool === 'pan') return;
    if(e.type !== 'mousedown') isDrawing = true;
    if(e.type === 'mousedown' && e.button === 0) isDrawing = true;

    const pos = getPos(e);
    lastX = pos.x;
    lastY = pos.y;
  }

  function draw(e){
    if(!isDrawing || currentTool === 'pan') return;

    if(e.cancelable) e.preventDefault();

    const pos = getPos(e);

    ctx.beginPath();
    ctx.moveTo(lastX, lastY);
    ctx.lineTo(pos.x, pos.y);

    if(currentTool === 'pen'){
      ctx.globalCompositeOperation = 'source-over';
      ctx.strokeStyle = '#ffbf00';
      ctx.lineWidth = 2;
      ctx.globalAlpha = 1.0;
    }else if(currentTool === 'high'){
      ctx.globalCompositeOperation = 'multiply';
      ctx.strokeStyle = '#ffeb3b';
      ctx.lineWidth = 14;
      ctx.globalAlpha = 0.4;
    }else if(currentTool === 'erase'){
      ctx.globalCompositeOperation = 'destination-out';
      ctx.lineWidth = 24;
      ctx.globalAlpha = 1.0;
    }

    ctx.stroke();
    lastX = pos.x;
    lastY = pos.y;
  }

  function endDraw(){
    isDrawing = false;
  }

  canvas.addEventListener('mousedown', startDraw);
  canvas.addEventListener('mousemove', draw);
  canvas.addEventListener('mouseup', endDraw);
  canvas.addEventListener('mouseout', endDraw);

  canvas.addEventListener('touchstart', startDraw, { passive:false });
  canvas.addEventListener('touchmove', draw,  { passive:false });
  canvas.addEventListener('touchend', endDraw);

  // MOBILE SIDEBAR
  const sidebar  = document.getElementById('sidebar');
  const backdrop = document.getElementById('backdrop');

  function toggleSidebar(show){
    if(show){
      sidebar.classList.add('open');
      backdrop.classList.add('open');
    }else{
      sidebar.classList.remove('open');
      backdrop.classList.remove('open');
    }
  }

  document.getElementById('menuToggle').onclick = () => toggleSidebar(true);
  backdrop.onclick = () => toggleSidebar(false);

  init();
</script>
</body>
</html>