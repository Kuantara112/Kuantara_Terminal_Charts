<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Kuantara – Geo Risk Monitor</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Fira Code -->
  <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500;700&display=swap"/>

  <style>
    :root{
      --bg-root:#000000;
      --bg-main:#111111;
      --border-soft:#2b2b2b;
      --text-main:#f5f5f5;
      --text-muted:#9b9b9b;
      --accent:#ffbf00;

      --fs-title:14px;
      --fs-subtitle:12px;
      --fs-body:11px;
      --fs-small:9.5px;
    }

    *{
      box-sizing:border-box;
      margin:0;
      padding:0;
      font-family:"Fira Code",monospace;
      scrollbar-width:thin;
      scrollbar-color:#333 #000;
    }
    *::-webkit-scrollbar{
      width:6px;
      height:6px;
    }
    *::-webkit-scrollbar-track{
      background:#000;
    }
    *::-webkit-scrollbar-thumb{
      background:#333;
      border-radius:3px;
    }

    html,body{
      width:100%;
      height:100%;
      background-color:var(--bg-root);
      color:var(--text-main);
      overflow:hidden; /* batasi 1 page */
    }

    body{
      display:flex;
      padding:16px;
    }

    .page{
      width:100%;
      max-width:1200px;
      margin:0 auto;
      display:flex;
      flex-direction:column;
      gap:12px;
      flex:1 1 auto;
      min-height:0; /* penting supaya tidak nambah tinggi */
    }

    /* Tab bar langsung di top page */
    .tab-bar{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      flex:0 0 auto;
    }

    .tab-btn{
      font-size:var(--fs-body);
      padding:6px 10px;
      border-radius:4px;
      border:1px solid var(--border-soft);
      background:#111111;
      color:var(--text-muted);
      cursor:pointer;
      display:flex;
      align-items:center;
      gap:6px;
      transition:background 0.15s ease,border-color 0.15s ease,color 0.15s ease;
    }
    .tab-btn span.label{
      white-space:nowrap;
    }
    .tab-btn span.badge{
      font-size:var(--fs-small);
      padding:1px 5px;
      border-radius:999px;
      background:#1a1a1a;
      border:1px solid #333333;
      color:var(--accent);
    }
    .tab-btn.active{
      background:#181818;
      border-color:var(--accent);
      color:var(--text-main);
    }

    .content{
      display:flex;
      flex-direction:column;
      gap:10px;
      flex:1 1 auto;
      min-height:0; /* biar muat di viewport */
    }

    .panel{
      display:none;
      flex-direction:column;
      gap:10px;
      flex:1 1 auto;
      min-height:0;
    }
    .panel.active{
      display:flex;
    }

    .panel-header{
      display:flex;
      flex-wrap:wrap;
      justify-content:space-between;
      gap:6px;
      align-items:flex-end;
      flex:0 0 auto;
    }

    .panel-title{
      font-size:var(--fs-subtitle);
      font-weight:500;
    }

    .panel-meta{
      font-size:var(--fs-small);
      color:var(--text-muted);
      display:flex;
      gap:10px;
      flex-wrap:wrap;
    }

    .panel-grid{
      display:flex;
      flex-direction:column;
      gap:10px;
      flex:1 1 auto;
      min-height:0;
    }

    .card{
      background:var(--bg-main);
      border:1px solid var(--border-soft);
      border-radius:4px;
      padding:12px;
      display:flex;
      flex-direction:column;
      gap:8px;
      flex:1 1 0;
      min-height:0;
    }

    .card-header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:6px;
      flex:0 0 auto;
    }
    .card-title{
      font-size:var(--fs-body);
      font-weight:500;
    }
    .card-subtitle{
      font-size:var(--fs-small);
      color:var(--text-muted);
    }
    .card-tag{
      font-size:var(--fs-small);
      color:var(--accent);
      border:1px solid #3a3000;
      background:#171107;
      padding:2px 6px;
      border-radius:999px;
      white-space:nowrap;
    }

    .card-body{
      font-size:var(--fs-small);
      color:var(--text-main);
      flex:1 1 auto;
      min-height:0;
      overflow-x:auto;
      overflow-y:auto; /* scroll internal */
    }

    /* Tables – horizontal scroll friendly */
    table{
      width:100%;
      min-width:600px;
      border-collapse:collapse;
      font-size:var(--fs-small);
    }
    thead{
      position:sticky;
      top:0;
      background:#111111;
      z-index:1;
    }
    th,td{
      padding:4px 6px;
      border-bottom:1px solid #1d1d1d;
      white-space:nowrap;
      text-overflow:ellipsis;
      overflow:hidden;
    }
    th{
      text-align:left;
      color:var(--accent);
      font-weight:500;
      font-size:var(--fs-small);
      border-bottom:1px solid var(--border-soft);
    }
    tr:nth-child(even) td{
      background:#121212;
    }

    .muted{
      color:var(--text-muted);
    }

    .status-pill{
      font-size:var(--fs-small);
      padding:1px 6px;
      border-radius:999px;
      border:1px solid #333333;
      background:#151515;
      color:var(--text-muted);
    }
    .status-pill.ok{
      border-color:#166534;
      color:#22c55e;
    }
    .status-pill.warn{
      border-color:#92400e;
      color:#facc15;
    }
    .status-pill.risk{
      border-color:#7f1d1d;
      color:#f97373;
    }

    .loader{
      font-size:var(--fs-small);
      color:var(--text-muted);
    }

    .error{
      font-size:var(--fs-small);
      color:#f97373;
    }

    .event-item{
      border-bottom:1px solid #1b1b1b;
      padding:4px 0;
    }
    .event-item:last-child{
      border-bottom:none;
    }
    .event-title{
      font-size:var(--fs-small);
      margin-bottom:2px;
    }
    .event-meta{
      font-size:var(--fs-small);
      color:var(--text-muted);
      display:flex;
      gap:8px;
      flex-wrap:wrap;
    }
    .event-desc{
      margin-top:2px;
      font-size:var(--fs-small);
      color:var(--text-main);
    }

    .hint-row{
      font-size:var(--fs-small);
      color:var(--text-muted);
      margin-top:2px;
    }

    /* Desktop layout: 2 kiri (atas/bawah) + 1 kanan setinggi 2x */
    @media(min-width:900px){
      .panel-grid{
        display:grid;
        grid-template-columns:minmax(0,1.05fr) minmax(0,1.3fr);
        grid-template-rows:minmax(0,1fr) minmax(0,1fr);
        grid-template-areas:
          "snap news"
          "prev news";
        gap:10px;
      }

      .card-snapshot{
        grid-area:snap;
      }
      .card-previous{
        grid-area:prev;
      }
      .card-events{
        grid-area:news;
      }
    }
  </style>
</head>
<body>
  <div class="page">
    <!-- Hanya tab, tanpa header/title/subtitle -->
    <div class="tab-bar">
      <button class="tab-btn active" data-panel="geopolitics">
        <span class="label">Geopolitical Risk</span>
        <span class="badge">GEO</span>
      </button>
      <button class="tab-btn" data-panel="tariffs">
        <span class="label">Tariffs</span>
        <span class="badge">TARIF</span>
      </button>
      <button class="tab-btn" data-panel="sanctions">
        <span class="label">Sanctions</span>
        <span class="badge">SAN</span>
      </button>
      <button class="tab-btn" data-panel="wars">
        <span class="label">Wars &amp; Conflicts</span>
        <span class="badge">WAR</span>
      </button>
    </div>

    <main class="content">
      <!-- GEOPOLITICS -->
      <section class="panel active" id="panel-geopolitics">
        <div class="panel-header">
          <div class="panel-title">Geopolitical Risk – Country &amp; Region Focus</div>
          <div class="panel-meta">
            <span class="status-pill ok">Live feed</span>
          </div>
        </div>

        <div class="panel-grid">
          <!-- Snapshot (left top) -->
          <div class="card card-snapshot">
            <div class="card-header">
              <div>
                <div class="card-title">Geo Risk Snapshot</div>
                <div class="card-subtitle">Latest table (levels &amp; rankings)</div>
              </div>
              <span class="card-tag">LATEST TABLE</span>
            </div>
            <div class="card-body" id="geo-latest-table">
              <div class="loader">Loading latest geopolitical table…</div>
            </div>
          </div>

          <!-- Previous Week (left bottom) -->
          <div class="card card-previous">
            <div class="card-header">
              <div>
                <div class="card-title">Previous Week Change</div>
                <div class="card-subtitle">Week-on-week movement by entity</div>
              </div>
              <span class="card-tag">PREVIOUS WEEK</span>
            </div>
            <div class="card-body" id="geo-previous-week">
              <div class="loader">Loading previous week geopolitical shifts…</div>
            </div>
          </div>

          <!-- Events / News (right, tall) -->
          <div class="card card-events">
            <div class="card-header">
              <div>
                <div class="card-title">Key Events</div>
                <div class="card-subtitle">Recent headlines &amp; triggers</div>
              </div>
              <span class="card-tag">LATEST EVENTS</span>
            </div>
            <div class="card-body" id="geo-latest-events">
              <div class="loader">Loading geopolitical events…</div>
            </div>
          </div>
        </div>
      </section>

      <!-- TARIFFS -->
      <section class="panel" id="panel-tariffs">
        <div class="panel-header">
          <div class="panel-title">Tariffs &amp; Trade Barriers</div>
          <div class="panel-meta">
            <span class="status-pill warn">Watch for trade disruptions</span>
          </div>
        </div>

        <div class="panel-grid">
          <!-- Snapshot -->
          <div class="card card-snapshot">
            <div class="card-header">
              <div>
                <div class="card-title">Tariff Snapshot</div>
                <div class="card-subtitle">Current tariff risk by country/sector</div>
              </div>
              <span class="card-tag">LATEST TABLE</span>
            </div>
            <div class="card-body" id="tariff-latest-table">
              <div class="loader">Loading tariff snapshot…</div>
            </div>
          </div>

          <!-- Previous Week -->
          <div class="card card-previous">
            <div class="card-header">
              <div>
                <div class="card-title">Previous Week Change</div>
                <div class="card-subtitle">Tariff risk week-on-week</div>
              </div>
              <span class="card-tag">PREVIOUS WEEK</span>
            </div>
            <div class="card-body" id="tariff-previous-week">
              <div class="loader">Loading previous week tariff data…</div>
            </div>
          </div>

          <!-- Events / News -->
          <div class="card card-events">
            <div class="card-header">
              <div>
                <div class="card-title">New / Escalating Tariffs</div>
                <div class="card-subtitle">Recent announcements &amp; proposals</div>
              </div>
              <span class="card-tag">LATEST EVENTS</span>
            </div>
            <div class="card-body" id="tariff-latest-events">
              <div class="loader">Loading tariff events…</div>
            </div>
          </div>
        </div>
      </section>

      <!-- SANCTIONS -->
      <section class="panel" id="panel-sanctions">
        <div class="panel-header">
          <div class="panel-title">Sanctions &amp; Restrictions</div>
          <div class="panel-meta">
            <span class="status-pill risk">High impact on flows</span>
          </div>
        </div>

        <div class="panel-grid">
          <!-- Snapshot -->
          <div class="card card-snapshot">
            <div class="card-header">
              <div>
                <div class="card-title">Sanctions Snapshot</div>
                <div class="card-subtitle">Entities, sectors, and severity</div>
              </div>
              <span class="card-tag">LATEST TABLE</span>
            </div>
            <div class="card-body" id="sanctions-latest-table">
              <div class="loader">Loading sanctions snapshot…</div>
            </div>
          </div>

          <!-- Previous Week -->
          <div class="card card-previous">
            <div class="card-header">
              <div>
                <div class="card-title">Previous Week Change</div>
                <div class="card-subtitle">Sanctions landscape week-on-week</div>
              </div>
              <span class="card-tag">PREVIOUS WEEK</span>
            </div>
            <div class="card-body" id="sanctions-previous-week">
              <div class="loader">Loading previous week sanctions data…</div>
            </div>
          </div>

          <!-- Events / News -->
          <div class="card card-events">
            <div class="card-header">
              <div>
                <div class="card-title">New Sanctions Events</div>
                <div class="card-subtitle">New designations &amp; policy moves</div>
              </div>
              <span class="card-tag">LATEST EVENTS</span>
            </div>
            <div class="card-body" id="sanctions-latest-events">
              <div class="loader">Loading sanctions events…</div>
            </div>
          </div>
        </div>
      </section>

      <!-- WARS -->
      <section class="panel" id="panel-wars">
        <div class="panel-header">
          <div class="panel-title">Wars &amp; Armed Conflicts</div>
          <div class="panel-meta">
            <span class="status-pill risk">Critical geopolitical risk</span>
          </div>
        </div>

        <div class="panel-grid">
          <!-- Snapshot -->
          <div class="card card-snapshot">
            <div class="card-header">
              <div>
                <div class="card-title">Conflict Snapshot</div>
                <div class="card-subtitle">Status by country &amp; region</div>
              </div>
              <span class="card-tag">LATEST TABLE</span>
            </div>
            <div class="card-body" id="wars-latest-table">
              <div class="loader">Loading conflict snapshot…</div>
            </div>
          </div>

          <!-- Previous Week -->
          <div class="card card-previous">
            <div class="card-header">
              <div>
                <div class="card-title">Previous Week Change</div>
                <div class="card-subtitle">Conflict intensity week-on-week</div>
              </div>
              <span class="card-tag">PREVIOUS WEEK</span>
            </div>
            <div class="card-body" id="wars-previous-week">
              <div class="loader">Loading previous week conflict data…</div>
            </div>
          </div>

          <!-- Events / News -->
          <div class="card card-events">
            <div class="card-header">
              <div>
                <div class="card-title">Conflict Events</div>
                <div class="card-subtitle">Escalations &amp; de-escalations</div>
              </div>
              <span class="card-tag">LATEST EVENTS</span>
            </div>
            <div class="card-body" id="wars-latest-events">
              <div class="loader">Loading wars events…</div>
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <script>
    const DATA_CONFIG = {
      geopolitics: {
        latestTable: "https://permutable-public-web.s3.us-east-1.amazonaws.com/live-insights/geo-latest-table.csv",
        latestEvents: "https://permutable-public-web.s3.us-east-1.amazonaws.com/live-insights/geo-latest-events.csv",
        previousWeek: "https://permutable-public-web.s3.us-east-1.amazonaws.com/live-insights/geo-previous-week.csv",
        dom: {
          table: "geo-latest-table",
          events: "geo-latest-events",
          prev: "geo-previous-week"
        }
      },
      tariffs: {
        latestTable: "https://permutable-public-web.s3.us-east-1.amazonaws.com/live-insights/tariff-latest-table.csv",
        latestEvents: "https://permutable-public-web.s3.us-east-1.amazonaws.com/live-insights/tariff-latest-events.csv",
        previousWeek: "https://permutable-public-web.s3.us-east-1.amazonaws.com/live-insights/tariff-previous-week.csv",
        dom: {
          table: "tariff-latest-table",
          events: "tariff-latest-events",
          prev: "tariff-previous-week"
        }
      },
      sanctions: {
        latestTable: "https://permutable-public-web.s3.us-east-1.amazonaws.com/live-insights/sanctions-latest-table.csv",
        latestEvents: "https://permutable-public-web.s3.us-east-1.amazonaws.com/live-insights/sanctions-latest-events.csv",
        previousWeek: "https://permutable-public-web.s3.us-east-1.amazonaws.com/live-insights/sanctions-previous-week.csv",
        dom: {
          table: "sanctions-latest-table",
          events: "sanctions-latest-events",
          prev: "sanctions-previous-week"
        }
      },
      wars: {
        latestTable: "https://permutable-public-web.s3.us-east-1.amazonaws.com/live-insights/wars-latest-table.csv",
        latestEvents: "https://permutable-public-web.s3.us-east-1.amazonaws.com/live-insights/wars-latest-events.csv",
        previousWeek: "https://permutable-public-web.s3.us-east-1.amazonaws.com/live-insights/wars-previous-week.csv",
        dom: {
          table: "wars-latest-table",
          events: "wars-latest-events",
          prev: "wars-previous-week"
        }
      }
    };

    function parseCSV(text){
      const rows = [];
      const lines = text.split(/\r?\n/).filter(l => l.trim().length > 0);
      if (!lines.length) return { headers: [], rows: [] };

      const headers = splitCsvLine(lines[0]);
      for (let i = 1; i < lines.length; i++){
        const cols = splitCsvLine(lines[i]);
        if (cols.length === 1 && cols[0] === "") continue;
        const row = {};
        headers.forEach((h, idx) => {
          row[h] = cols[idx] !== undefined ? cols[idx] : "";
        });
        rows.push(row);
      }
      return { headers, rows };
    }

    function splitCsvLine(line){
      const result = [];
      let current = "";
      let inQuotes = false;

      for (let i = 0; i < line.length; i++){
        const ch = line[i];
        if (ch === '"'){
          if (inQuotes && line[i+1] === '"'){
            current += '"';
            i++;
          } else {
            inQuotes = !inQuotes;
          }
        } else if (ch === "," && !inQuotes){
          result.push(current);
          current = "";
        } else {
          current += ch;
        }
      }
      result.push(current);
      return result;
    }

    async function fetchCSV(url){
      const res = await fetch(url);
      if (!res.ok) throw new Error("HTTP " + res.status);
      const text = await res.text();
      return parseCSV(text);
    }

    function renderTable(containerId, data, maxRows = 50){
      const el = document.getElementById(containerId);
      if (!el) return;
      const { headers, rows } = data;
      if (!headers.length || !rows.length){
        el.innerHTML = '<div class="muted">No data available.</div>';
        return;
      }
      const limitedRows = rows.slice(0, maxRows);
      let thead = "<tr>" + headers.map(h => `<th>${escapeHtml(h)}</th>`).join("") + "</tr>";
      let tbody = limitedRows.map(row => {
        return "<tr>" + headers.map(h => `<td title="${escapeHtml(row[h] ?? "")}">${escapeHtml(row[h] ?? "")}</td>`).join("") + "</tr>";
      }).join("");
      el.innerHTML = `<table><thead>${thead}</thead><tbody>${tbody}</tbody></table>` +
                     (rows.length > maxRows
                      ? `<div class="hint-row">Showing ${maxRows} of ${rows.length} rows…</div>`
                      : "");
    }

    function renderEvents(containerId, data, maxItems = 40){
      const el = document.getElementById(containerId);
      if (!el) return;
      const { headers, rows } = data;
      if (!headers.length || !rows.length){
        el.innerHTML = '<div class="muted">No events available.</div>';
        return;
      }
      const lower = headers.map(h => h.toLowerCase());
      const idxDate = lower.findIndex(h => h.includes("date"));
      const idxTime = lower.findIndex(h => h.includes("time"));
      const idxTitle = lower.findIndex(h => h.includes("title") || h.includes("headline") || h.includes("event"));
      const idxRegion = lower.findIndex(h => h.includes("region") || h.includes("country"));
      const idxScore = lower.findIndex(h => h.includes("score") || h.includes("level") || h.includes("risk"));
      const idxDesc = lower.findIndex(h => h.includes("summary") || h.includes("description"));

      const items = rows.slice(0, maxItems).map(row => {
        const get = (idx) => idx >= 0 ? row[headers[idx]] || "" : "";
        const title = get(idxTitle) || get(idxDesc) || get(idxRegion) || "Event";
        const date = get(idxDate);
        const time = get(idxTime);
        const region = get(idxRegion);
        const score = get(idxScore);
        const desc = get(idxDesc);
        let metaParts = [];
        if (date) metaParts.push(date);
        if (time) metaParts.push(time);
        if (region) metaParts.push(region);
        if (score) metaParts.push("Score: " + score);

        return `
          <div class="event-item">
            <div class="event-title">${escapeHtml(title)}</div>
            ${metaParts.length ? `<div class="event-meta">${metaParts.map(m => `<span>${escapeHtml(m)}</span>`).join("")}</div>` : ""}
            ${desc && desc !== title ? `<div class="event-desc">${escapeHtml(desc)}</div>` : ""}
          </div>
        `;
      }).join("");

      el.innerHTML = items || '<div class="muted">No events available.</div>';
    }

    function escapeHtml(str){
      return String(str ?? "")
        .replace(/&/g,"&amp;")
        .replace(/</g,"&lt;")
        .replace(/>/g,"&gt;")
        .replace(/"/g,"&quot;");
    }

    async function loadBlock(key){
      const cfg = DATA_CONFIG[key];
      if (!cfg) return;

      if (cfg.latestTable && cfg.dom.table){
        const el = document.getElementById(cfg.dom.table);
        if (el) el.innerHTML = '<div class="loader">Loading…</div>';
        try{
          const data = await fetchCSV(cfg.latestTable);
          renderTable(cfg.dom.table, data, 60);
        }catch(err){
          if (el) el.innerHTML = `<div class="error">Failed to load table: ${escapeHtml(err.message)}</div>`;
        }
      }

      if (cfg.latestEvents && cfg.dom.events){
        const el = document.getElementById(cfg.dom.events);
        if (el) el.innerHTML = '<div class="loader">Loading…</div>';
        try{
          const data = await fetchCSV(cfg.latestEvents);
          renderEvents(cfg.dom.events, data, 40);
        }catch(err){
          if (el) el.innerHTML = `<div class="error">Failed to load events: ${escapeHtml(err.message)}</div>`;
        }
      }

      if (cfg.previousWeek && cfg.dom.prev){
        const el = document.getElementById(cfg.dom.prev);
        if (el) el.innerHTML = '<div class="loader">Loading…</div>';
        try{
          const data = await fetchCSV(cfg.previousWeek);
          renderTable(cfg.dom.prev, data, 80);
        }catch(err){
          if (el) el.innerHTML = `<div class="error">Failed to load previous week data: ${escapeHtml(err.message)}</div>`;
        }
      }
    }

    function initTabs(){
      const tabs = Array.from(document.querySelectorAll(".tab-btn"));
      const panels = {
        geopolitics: document.getElementById("panel-geopolitics"),
        tariffs: document.getElementById("panel-tariffs"),
        sanctions: document.getElementById("panel-sanctions"),
        wars: document.getElementById("panel-wars")
      };

      tabs.forEach(btn => {
        btn.addEventListener("click", () => {
          const key = btn.getAttribute("data-panel");
          if (!key) return;

          tabs.forEach(b => b.classList.toggle("active", b === btn));

          Object.entries(panels).forEach(([k, panel]) => {
            if (!panel) return;
            panel.classList.toggle("active", k === key);
          });

          loadBlock(key);
        });
      });
    }

    document.addEventListener("DOMContentLoaded", () => {
      initTabs();
      loadBlock("geopolitics");
    });
  </script>
</body>
</html>
